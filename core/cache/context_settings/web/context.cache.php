<?php  return array (
  'config' => 
  array (
  ),
  'aliasMap' => 
  array (
    'index.html' => 1,
    '403.html' => 2,
    '404.html' => 3,
    'ajax.html' => 4,
    'sitemap.xml' => 5,
    'search.html' => 6,
    'cart.html' => 8,
    'checkout.html' => 9,
    'privacy.html' => 10,
    'personal/' => 11,
    'personal/registration.html' => 12,
    'personal/activation.html' => 13,
    'personal/edit.html' => 14,
    'personal/password-change.html' => 15,
    'personal/password-remind.html' => 16,
    'personal/order-list.html' => 17,
    'novosti.html' => 23,
    'personal/favorite.html' => 18,
    'old.html' => 22,
    'compare.html' => 19,
    'contacts.html' => 20,
    'system/' => 21,
    '410.html' => 24,
    'brands.html' => 25,
    'reviews.html' => 27,
    'uslugi.html' => 28,
    'stranicza-503.html' => 29,
    'cacheclear.html' => 30,
    'normativno-pravovaya-baza.html' => 31,
    'portfolio.html' => 32,
    'rabotyi-uchashhixsya.html' => 33,
    'blog.html' => 34,
  ),
  'resourceMap' => 
  array (
    0 => 
    array (
      0 => 1,
      1 => 23,
      2 => 20,
      3 => 21,
      4 => 25,
      5 => 27,
      6 => 28,
      7 => 31,
      8 => 32,
      9 => 33,
      10 => 34,
    ),
    21 => 
    array (
      0 => 2,
      1 => 3,
      2 => 4,
      3 => 5,
      4 => 6,
      5 => 8,
      6 => 9,
      7 => 10,
      8 => 11,
      9 => 22,
      10 => 19,
      11 => 24,
      12 => 29,
      13 => 30,
    ),
    11 => 
    array (
      0 => 12,
      1 => 13,
      2 => 14,
      3 => 15,
      4 => 16,
      5 => 17,
      6 => 18,
    ),
  ),
  'webLinkMap' => 
  array (
  ),
  'eventMap' => 
  array (
    'msOnAddToCart' => 
    array (
      63 => '63',
    ),
    'msOnBeforeAddToCart' => 
    array (
      52 => '52',
      63 => '63',
    ),
    'msOnBeforeChangeInCart' => 
    array (
      52 => '52',
    ),
    'msOnBeforeCreateOrder' => 
    array (
      63 => '63',
    ),
    'msOnBeforeCreateOrderProduct' => 
    array (
      52 => '52',
    ),
    'msOnBeforeRemoveFromCart' => 
    array (
      63 => '63',
    ),
    'msOnBeforeRemoveOrderProduct' => 
    array (
      52 => '52',
    ),
    'msOnBeforeUpdateOrderProduct' => 
    array (
      52 => '52',
    ),
    'msOnChangeOrderStatus' => 
    array (
      50 => '50',
      52 => '52',
    ),
    'msOnGetProductPrice' => 
    array (
      52 => '52',
      63 => '63',
    ),
    'msOnGetProductWeight' => 
    array (
      52 => '52',
    ),
    'msOnRemoveOrder' => 
    array (
      52 => '52',
    ),
    'msOnSaveOrder' => 
    array (
      52 => '52',
    ),
    'OnBeforeChunkFormSave' => 
    array (
      28 => '28',
    ),
    'OnBeforeCommentSave' => 
    array (
      64 => '64',
    ),
    'OnBeforeDocFormSave' => 
    array (
      9 => '9',
      28 => '28',
      36 => '36',
      69 => '69',
    ),
    'OnBeforeEmptyTrash' => 
    array (
      9 => '9',
      65 => '65',
      69 => '69',
      71 => '71',
    ),
    'OnBeforePluginFormSave' => 
    array (
      28 => '28',
    ),
    'OnBeforeRegisterClientScripts' => 
    array (
      7 => '7',
    ),
    'OnBeforeSaveWebPageCache' => 
    array (
      10 => '10',
    ),
    'OnBeforeSnipFormSave' => 
    array (
      28 => '28',
    ),
    'OnBeforeTempFormSave' => 
    array (
      28 => '28',
    ),
    'OnBeforeTVFormSave' => 
    array (
      28 => '28',
    ),
    'OnChunkFormPrerender' => 
    array (
      1 => '1',
      8 => '8',
      28 => '28',
    ),
    'OnChunkFormSave' => 
    array (
      8 => '8',
    ),
    'OnCommentDelete' => 
    array (
      51 => '51',
    ),
    'OnCommentRemove' => 
    array (
      51 => '51',
    ),
    'OnCommentSave' => 
    array (
      51 => '51',
    ),
    'OnDocFormPrerender' => 
    array (
      1 => '1',
      3 => '3',
      5 => '5',
      8 => '8',
      9 => '9',
      28 => '28',
      67 => '67',
      46 => '46',
      48 => '48',
      49 => '49',
      52 => '52',
      63 => '63',
    ),
    'OnDocFormRender' => 
    array (
      9 => '9',
      19 => '19',
      60 => '60',
      69 => '69',
      71 => '71',
    ),
    'OnDocFormSave' => 
    array (
      6 => '6',
      8 => '8',
      12 => '12',
      28 => '28',
      33 => '33',
      49 => '49',
      57 => '57',
      66 => '66',
      51 => '51',
      52 => '52',
    ),
    'OnDocPublished' => 
    array (
      6 => '6',
    ),
    'OnDocUnPublished' => 
    array (
      6 => '6',
    ),
    'OnEmptyTrash' => 
    array (
      12 => '12',
      67 => '67',
      52 => '52',
    ),
    'OnFileCreateFormPrerender' => 
    array (
      1 => '1',
    ),
    'OnFileEditFormPrerender' => 
    array (
      1 => '1',
    ),
    'OnFileManagerFileCreate' => 
    array (
      40 => '40',
    ),
    'OnFileManagerFileUpdate' => 
    array (
      40 => '40',
    ),
    'OnFileManagerUpload' => 
    array (
      31 => '31',
      26 => '26',
      29 => '29',
    ),
    'OnHandleRequest' => 
    array (
      7 => '7',
      25 => '25',
      50 => '50',
      56 => '56',
    ),
    'OnLoadWebDocument' => 
    array (
      12 => '12',
      24 => '24',
      41 => '41',
      48 => '48',
      49 => '49',
      50 => '50',
      61 => '61',
      69 => '69',
    ),
    'OnMODXInit' => 
    array (
      10 => '10',
      49 => '49',
      25 => '25',
      39 => '39',
      48 => '48',
      50 => '50',
      53 => '53',
      62 => '62',
    ),
    'OnPageNotFound' => 
    array (
      12 => '12',
      54 => '54',
    ),
    'OnPluginFormPrerender' => 
    array (
      1 => '1',
      28 => '28',
    ),
    'OnResourceBeforeSort' => 
    array (
      9 => '9',
    ),
    'OnResourceDelete' => 
    array (
      6 => '6',
      51 => '51',
    ),
    'OnResourceDuplicate' => 
    array (
      6 => '6',
      9 => '9',
      52 => '52',
    ),
    'OnResourceToolbarLoad' => 
    array (
      60 => '60',
    ),
    'OnResourceTVFormRender' => 
    array (
      59 => '59',
    ),
    'OnResourceUndelete' => 
    array (
      6 => '6',
      51 => '51',
    ),
    'OnRichTextBrowserInit' => 
    array (
      2 => '2',
      70 => '70',
    ),
    'OnRichTextEditorInit' => 
    array (
      2 => '2',
      70 => '70',
    ),
    'OnRichTextEditorRegister' => 
    array (
      1 => '1',
      2 => '2',
      70 => '70',
    ),
    'OnSiteRefresh' => 
    array (
      10 => '10',
      12 => '12',
      39 => '39',
      66 => '66',
      30 => '30',
    ),
    'OnSnipFormPrerender' => 
    array (
      1 => '1',
      8 => '8',
      28 => '28',
    ),
    'OnTempFormPrerender' => 
    array (
      1 => '1',
      8 => '8',
      28 => '28',
      49 => '49',
    ),
    'OnTempFormSave' => 
    array (
      8 => '8',
    ),
    'OnTVFormPrerender' => 
    array (
      28 => '28',
    ),
    'OnTVFormSave' => 
    array (
      20 => '20',
    ),
    'OnTVInputPropertiesList' => 
    array (
      3 => '3',
      5 => '5',
      20 => '20',
      45 => '45',
      46 => '46',
      48 => '48',
    ),
    'OnTVInputRenderList' => 
    array (
      1 => '1',
      5 => '5',
      20 => '20',
      45 => '45',
      46 => '46',
      48 => '48',
      3 => '3',
    ),
    'OnTVOutputRenderList' => 
    array (
      5 => '5',
      20 => '20',
      45 => '45',
      48 => '48',
    ),
    'OnTVOutputRenderPropertiesList' => 
    array (
      5 => '5',
      20 => '20',
      45 => '45',
      48 => '48',
    ),
    'OnUserSave' => 
    array (
      12 => '12',
      50 => '50',
    ),
    'OnWebPageComplete' => 
    array (
      7 => '7',
      12 => '12',
    ),
    'OnWebPageInit' => 
    array (
      50 => '50',
    ),
    'OnWebPagePrerender' => 
    array (
      10 => '10',
      12 => '12',
      33 => '33',
      43 => '43',
      39 => '39',
    ),
    'pdoToolsOnFenomInit' => 
    array (
      25 => '25',
      43 => '43',
      44 => '44',
    ),
  ),
  'pluginCache' => 
  array (
    1 => 
    array (
      'id' => '1',
      'source' => '0',
      'property_preprocess' => '0',
      'name' => 'Ace',
      'description' => 'Ace code editor plugin for MODx Revolution',
      'editor_type' => '0',
      'category' => '0',
      'cache_type' => '0',
      'plugincode' => '/**
 * Ace Source Editor Plugin
 *
 * Events: OnManagerPageBeforeRender, OnRichTextEditorRegister, OnSnipFormPrerender,
 * OnTempFormPrerender, OnChunkFormPrerender, OnPluginFormPrerender,
 * OnFileCreateFormPrerender, OnFileEditFormPrerender, OnDocFormPrerender
 *
 * @author Danil Kostin <danya.postfactum(at)gmail.com>
 *
 * @package ace
 *
 * @var array $scriptProperties
 * @var Ace $ace
 */
if ($modx->event->name == \'OnRichTextEditorRegister\') {
    $modx->event->output(\'Ace\');
    return;
}

if ($modx->getOption(\'which_element_editor\', null, \'Ace\') !== \'Ace\') {
    return;
}

$corePath = $modx->getOption(\'ace.core_path\', null, $modx->getOption(\'core_path\').\'components/ace/\');
$ace = $modx->getService(\'ace\', \'Ace\', $corePath.\'model/ace/\');
$ace->initialize();

$extensionMap = array(
    \'tpl\'   => \'text/x-smarty\',
    \'htm\'   => \'text/html\',
    \'html\'  => \'text/html\',
    \'css\'   => \'text/css\',
    \'scss\'  => \'text/x-scss\',
    \'less\'  => \'text/x-less\',
    \'svg\'   => \'image/svg+xml\',
    \'xml\'   => \'application/xml\',
    \'xsl\'   => \'application/xml\',
    \'js\'    => \'application/javascript\',
    \'json\'  => \'application/json\',
    \'php\'   => \'application/x-php\',
    \'sql\'   => \'text/x-sql\',
    \'md\'    => \'text/x-markdown\',
    \'txt\'   => \'text/plain\',
    \'twig\'  => \'text/x-twig\'
);

// Define default mime for html elements(templates, chunks and html resources)
$html_elements_mime=$modx->getOption(\'ace.html_elements_mime\',null,false);
if(!$html_elements_mime){
    // this may deprecated in future because components may set ace.html_elements_mime option now
    switch (true) {
        case $modx->getOption(\'twiggy_class\'):
            $html_elements_mime = \'text/x-twig\';
            break;
        case $modx->getOption(\'pdotools_fenom_parser\'):
            $html_elements_mime = \'text/x-smarty\';
            break;
        default:
            $html_elements_mime = \'text/html\';
    }
}

// Defines wether we should highlight modx tags
$modxTags = false;
switch ($modx->event->name) {
    case \'OnSnipFormPrerender\':
        $field = \'modx-snippet-snippet\';
        $mimeType = \'application/x-php\';
        break;
    case \'OnTempFormPrerender\':
        $field = \'modx-template-content\';
        $modxTags = true;
        $mimeType = $html_elements_mime;
        break;
    case \'OnChunkFormPrerender\':
        $field = \'modx-chunk-snippet\';
        if ($modx->controller->chunk && $modx->controller->chunk->isStatic()) {
            $extension = pathinfo($modx->controller->chunk->name, PATHINFO_EXTENSION);
            if(!$extension||!isset($extensionMap[$extension])){
                $extension = pathinfo($modx->controller->chunk->getSourceFile(), PATHINFO_EXTENSION);
            }
            $mimeType = isset($extensionMap[$extension]) ? $extensionMap[$extension] : \'text/plain\';
        } else {
            $mimeType = $html_elements_mime;
        }
        $modxTags = true;
        break;
    case \'OnPluginFormPrerender\':
        $field = \'modx-plugin-plugincode\';
        $mimeType = \'application/x-php\';
        break;
    case \'OnFileCreateFormPrerender\':
        $field = \'modx-file-content\';
        $mimeType = \'text/plain\';
        break;
    case \'OnFileEditFormPrerender\':
        $field = \'modx-file-content\';
        $extension = pathinfo($scriptProperties[\'file\'], PATHINFO_EXTENSION);
        $mimeType = isset($extensionMap[$extension])
            ? $extensionMap[$extension]
            : (\'@FILE:\'.pathinfo($scriptProperties[\'file\'], PATHINFO_BASENAME));
        $modxTags = $extension == \'tpl\';
        break;
    case \'OnDocFormPrerender\':
        if (!$modx->controller->resourceArray) {
            return;
        }
        $field = \'ta\';
        $mimeType = $modx->getObject(\'modContentType\', $modx->controller->resourceArray[\'content_type\'])->get(\'mime_type\');

        if($mimeType == \'text/html\')$mimeType = $html_elements_mime;

        if ($modx->getOption(\'use_editor\')){
            $richText = $modx->controller->resourceArray[\'richtext\'];
            $classKey = $modx->controller->resourceArray[\'class_key\'];
            if ($richText || in_array($classKey, array(\'modStaticResource\',\'modSymLink\',\'modWebLink\',\'modXMLRPCResource\'))) {
                $field = false;
            }
        }
        $modxTags = true;
        break;
    case \'OnTVInputRenderList\':
        $modx->event->output($corePath . \'elements/tv/input/\');
        break;
    default:
        return;
}

$modxTags = (int) $modxTags;
$script = \'\';
if (!empty($field)) {
    $script .= "MODx.ux.Ace.replaceComponent(\'$field\', \'$mimeType\', $modxTags);";
}

if ($modx->event->name == \'OnDocFormPrerender\' && !$modx->getOption(\'use_editor\')) {
    $script .= "MODx.ux.Ace.replaceTextAreas(Ext.query(\'.modx-richtext\'));";
}

if ($script) {
    $modx->controller->addHtml(\'<script>Ext.onReady(function() {\' . $script . \'});</script>\');
}',
      'locked' => '0',
      'properties' => 'a:0:{}',
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => 'ace/elements/plugins/ace.plugin.php',
    ),
    2 => 
    array (
      'id' => '2',
      'source' => '0',
      'property_preprocess' => '0',
      'name' => 'TinyMCE',
      'description' => 'TinyMCE 4.3.4-pl plugin for MODx Revolution',
      'editor_type' => '0',
      'category' => '0',
      'cache_type' => '0',
      'plugincode' => '/**
 * TinyMCE RichText Editor Plugin
 *
 * Events: OnRichTextEditorInit, OnRichTextEditorRegister,
 * OnBeforeManagerPageInit, OnRichTextBrowserInit
 *
 * @author Jeff Whitfield <jeff@collabpad.com>
 * @author Shaun McCormick <shaun@collabpad.com>
 *
 * @var modX $modx
 * @var array $scriptProperties
 *
 * @package tinymce
 * @subpackage build
 */
if ($modx->event->name == \'OnRichTextEditorRegister\') {
    $modx->event->output(\'TinyMCE\');
    return;
}
require_once $modx->getOption(\'tiny.core_path\',null,$modx->getOption(\'core_path\').\'components/tinymce/\').\'tinymce.class.php\';
$tiny = new TinyMCE($modx,$scriptProperties);

$useEditor = $tiny->context->getOption(\'use_editor\',false);
$whichEditor = $tiny->context->getOption(\'which_editor\',\'\');

/* Handle event */
switch ($modx->event->name) {
    case \'OnRichTextEditorInit\':
        if ($useEditor && $whichEditor == \'TinyMCE\') {
            unset($scriptProperties[\'chunk\']);
            if (isset($forfrontend) || $modx->context->get(\'key\') != \'mgr\') {
                $def = $tiny->context->getOption(\'cultureKey\',$tiny->context->getOption(\'manager_language\',\'en\'));
                $tiny->properties[\'language\'] = $modx->getOption(\'fe_editor_lang\',array(),$def);
                $tiny->properties[\'frontend\'] = true;
                unset($def);
            }
            /* commenting these out as it causes problems with richtext tvs */
            //if (isset($scriptProperties[\'resource\']) && !$resource->get(\'richtext\')) return;
            //if (!isset($scriptProperties[\'resource\']) && !$modx->getOption(\'richtext_default\',null,false)) return;
            $tiny->setProperties($scriptProperties);
            $html = $tiny->initialize();
            $modx->event->output($html);
            unset($html);
        }
        break;
    case \'OnRichTextBrowserInit\':
        if ($useEditor && $whichEditor == \'TinyMCE\') {
            $inRevo20 = (boolean)version_compare($modx->version[\'full_version\'],\'2.1.0-rc1\',\'<\');
            $modx->getVersionData();
            $source = $tiny->context->getOption(\'default_media_source\',null,1);
            
            $modx->controller->addHtml(\'<script type="text/javascript">var inRevo20 = \'.($inRevo20 ? 1 : 0).\';MODx.source = "\'.$source.\'";</script>\');
            
            $modx->controller->addJavascript($tiny->config[\'assetsUrl\'].\'jscripts/tiny_mce/tiny_mce_popup.js\');
            if (file_exists($tiny->config[\'assetsPath\'].\'jscripts/tiny_mce/langs/\'.$tiny->properties[\'language\'].\'.js\')) {
                $modx->controller->addJavascript($tiny->config[\'assetsUrl\'].\'jscripts/tiny_mce/langs/\'.$tiny->properties[\'language\'].\'.js\');
            } else {
                $modx->controller->addJavascript($tiny->config[\'assetsUrl\'].\'jscripts/tiny_mce/langs/en.js\');
            }
            $modx->controller->addJavascript($tiny->config[\'assetsUrl\'].\'tiny.browser.js\');
            $modx->event->output(\'Tiny.browserCallback\');
        }
        return \'\';
        break;

   default: break;
}
return;',
      'locked' => '0',
      'properties' => 'a:39:{s:22:"accessibility_warnings";a:7:{s:4:"name";s:22:"accessibility_warnings";s:4:"desc";s:315:"If this option is set to true some accessibility warnings will be presented to the user if they miss specifying that information. This option is set to true by default, since we should all try to make this world a better place for disabled people. But if you are annoyed with the warnings, set this option to false.";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:1;s:7:"lexicon";N;s:4:"area";s:0:"";}s:23:"apply_source_formatting";a:7:{s:4:"name";s:23:"apply_source_formatting";s:4:"desc";s:229:"This option enables you to tell TinyMCE to apply some source formatting to the output HTML code. With source formatting, the output HTML code is indented and formatted. Without source formatting, the output HTML is more compact. ";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:1;s:7:"lexicon";N;s:4:"area";s:0:"";}s:15:"button_tile_map";a:7:{s:4:"name";s:15:"button_tile_map";s:4:"desc";s:338:"If this option is set to true TinyMCE will use tiled images instead of individual images for most of the editor controls. This produces faster loading time since only one GIF image needs to be loaded instead of a GIF for each individual button. This option is set to false by default since it doesn\'t work with some DOCTYPE declarations. ";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:0;s:7:"lexicon";N;s:4:"area";s:0:"";}s:7:"cleanup";a:7:{s:4:"name";s:7:"cleanup";s:4:"desc";s:331:"This option enables or disables the built-in clean up functionality. TinyMCE is equipped with powerful clean up functionality that enables you to specify what elements and attributes are allowed and how HTML contents should be generated. This option is set to true by default, but if you want to disable it you may set it to false.";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:1;s:7:"lexicon";N;s:4:"area";s:0:"";}s:18:"cleanup_on_startup";a:7:{s:4:"name";s:18:"cleanup_on_startup";s:4:"desc";s:135:"If you set this option to true, TinyMCE will perform a HTML cleanup call when the editor loads. This option is set to false by default.";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:0;s:7:"lexicon";N;s:4:"area";s:0:"";}s:22:"convert_fonts_to_spans";a:7:{s:4:"name";s:22:"convert_fonts_to_spans";s:4:"desc";s:348:"If you set this option to true, TinyMCE will convert all font elements to span elements and generate span elements instead of font elements. This option should be used in order to get more W3C compatible code, since font elements are deprecated. How sizes get converted can be controlled by the font_size_classes and font_size_style_values options.";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:1;s:7:"lexicon";N;s:4:"area";s:0:"";}s:23:"convert_newlines_to_brs";a:7:{s:4:"name";s:23:"convert_newlines_to_brs";s:4:"desc";s:128:"If you set this option to true, newline characters codes get converted into br elements. This option is set to false by default.";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:0;s:7:"lexicon";N;s:4:"area";s:0:"";}s:12:"convert_urls";a:7:{s:4:"name";s:12:"convert_urls";s:4:"desc";s:495:"This option enables you to control whether TinyMCE is to be clever and restore URLs to their original values. URLs are automatically converted (messed up) by default because the built-in browser logic works this way. There is no way to get the real URL unless you store it away. If you set this option to false it will try to keep these URLs intact. This option is set to true by default, which means URLs will be forced to be either absolute or relative depending on the state of relative_urls.";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:1;s:7:"lexicon";N;s:4:"area";s:0:"";}s:11:"dialog_type";a:7:{s:4:"name";s:11:"dialog_type";s:4:"desc";s:246:"This option enables you to specify how dialogs/popups should be opened. Possible values are "window" and "modal", where the window option opens a normal window and the dialog option opens a modal dialog. This option is set to "window" by default.";s:4:"type";s:4:"list";s:7:"options";a:2:{i:0;a:2:{i:0;s:6:"window";s:4:"text";s:6:"Window";}i:1;a:2:{i:0;s:5:"modal";s:4:"text";s:5:"Modal";}}s:5:"value";s:6:"window";s:7:"lexicon";N;s:4:"area";s:0:"";}s:14:"directionality";a:7:{s:4:"name";s:14:"directionality";s:4:"desc";s:261:"This option specifies the default writing direction. Some languages (Like Hebrew, Arabic, Urdu...) write from right to left instead of left to right. The default value of this option is "ltr" but if you want to use from right to left mode specify "rtl" instead.";s:4:"type";s:4:"list";s:7:"options";a:2:{i:0;a:2:{s:5:"value";s:3:"ltr";s:4:"text";s:13:"Left to Right";}i:1;a:2:{s:5:"value";s:3:"rtl";s:4:"text";s:13:"Right to Left";}}s:5:"value";s:3:"ltr";s:7:"lexicon";N;s:4:"area";s:0:"";}s:14:"element_format";a:7:{s:4:"name";s:14:"element_format";s:4:"desc";s:210:"This option enables control if elements should be in html or xhtml mode. xhtml is the default state for this option. This means that for example &lt;br /&gt; will be &lt;br&gt; if you set this option to "html".";s:4:"type";s:4:"list";s:7:"options";a:2:{i:0;a:2:{s:5:"value";s:5:"xhtml";s:4:"text";s:5:"XHTML";}i:1;a:2:{s:5:"value";s:4:"html";s:4:"text";s:4:"HTML";}}s:5:"value";s:5:"xhtml";s:7:"lexicon";N;s:4:"area";s:0:"";}s:15:"entity_encoding";a:7:{s:4:"name";s:15:"entity_encoding";s:4:"desc";s:70:"This option controls how entities/characters get processed by TinyMCE.";s:4:"type";s:4:"list";s:7:"options";a:4:{i:0;a:2:{s:5:"value";s:0:"";s:4:"text";s:4:"None";}i:1;a:2:{s:5:"value";s:5:"named";s:4:"text";s:5:"Named";}i:2;a:2:{s:5:"value";s:7:"numeric";s:4:"text";s:7:"Numeric";}i:3;a:2:{s:5:"value";s:3:"raw";s:4:"text";s:3:"Raw";}}s:5:"value";s:0:"";s:7:"lexicon";N;s:4:"area";s:0:"";}s:16:"force_p_newlines";a:7:{s:4:"name";s:16:"force_p_newlines";s:4:"desc";s:147:"This option enables you to disable/enable the creation of paragraphs on return/enter in Mozilla/Firefox. The default value of this option is true. ";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:1;s:7:"lexicon";N;s:4:"area";s:0:"";}s:22:"force_hex_style_colors";a:7:{s:4:"name";s:22:"force_hex_style_colors";s:4:"desc";s:277:"This option enables you to control TinyMCE to force the color format to use hexadecimal instead of rgb strings. It converts for example "color: rgb(255, 255, 0)" to "#FFFF00". This option is set to true by default since otherwice MSIE and Firefox would differ in this behavior.";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:1;s:7:"lexicon";N;s:4:"area";s:0:"";}s:6:"height";a:7:{s:4:"name";s:6:"height";s:4:"desc";s:38:"Sets the height of the TinyMCE editor.";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:5:"400px";s:7:"lexicon";N;s:4:"area";s:0:"";}s:11:"indentation";a:7:{s:4:"name";s:11:"indentation";s:4:"desc";s:139:"This option allows specification of the indentation level for indent/outdent buttons in the UI. This defaults to 30px but can be any value.";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:4:"30px";s:7:"lexicon";N;s:4:"area";s:0:"";}s:16:"invalid_elements";a:7:{s:4:"name";s:16:"invalid_elements";s:4:"desc";s:163:"This option should contain a comma separated list of element names to exclude from the content. Elements in this list will removed when TinyMCE executes a cleanup.";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:0:"";s:7:"lexicon";N;s:4:"area";s:0:"";}s:6:"nowrap";a:7:{s:4:"name";s:6:"nowrap";s:4:"desc";s:212:"This nowrap option enables you to control how whitespace is to be wordwrapped within the editor. This option is set to false by default, but if you enable it by setting it to true editor contents will never wrap.";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:0;s:7:"lexicon";N;s:4:"area";s:0:"";}s:15:"object_resizing";a:7:{s:4:"name";s:15:"object_resizing";s:4:"desc";s:148:"This option gives you the ability to turn on/off the inline resizing controls of tables and images in Firefox/Mozilla. These are enabled by default.";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:1;s:7:"lexicon";N;s:4:"area";s:0:"";}s:12:"path_options";a:7:{s:4:"name";s:12:"path_options";s:4:"desc";s:119:"Sets a group of options. Note: This will override the relative_urls, document_base_url and remove_script_host settings.";s:4:"type";s:9:"textfield";s:7:"options";a:3:{i:0;a:2:{s:5:"value";s:11:"docrelative";s:4:"text";s:17:"Document Relative";}i:1;a:2:{s:5:"value";s:12:"rootrelative";s:4:"text";s:13:"Root Relative";}i:2;a:2:{s:5:"value";s:11:"fullpathurl";s:4:"text";s:13:"Full Path URL";}}s:5:"value";s:11:"docrelative";s:7:"lexicon";N;s:4:"area";s:0:"";}s:28:"plugin_insertdate_dateFormat";a:7:{s:4:"name";s:28:"plugin_insertdate_dateFormat";s:4:"desc";s:53:"Formatting of dates when using the InsertDate plugin.";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:8:"%Y-%m-%d";s:7:"lexicon";N;s:4:"area";s:0:"";}s:28:"plugin_insertdate_timeFormat";a:7:{s:4:"name";s:28:"plugin_insertdate_timeFormat";s:4:"desc";s:53:"Formatting of times when using the InsertDate plugin.";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:8:"%H:%M:%S";s:7:"lexicon";N;s:4:"area";s:0:"";}s:12:"preformatted";a:7:{s:4:"name";s:12:"preformatted";s:4:"desc";s:231:"If you enable this feature, whitespace such as tabs and spaces will be preserved. Much like the behavior of a &lt;pre&gt; element. This can be handy when integrating TinyMCE with webmail clients. This option is disabled by default.";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:1;s:7:"lexicon";N;s:4:"area";s:0:"";}s:13:"relative_urls";a:7:{s:4:"name";s:13:"relative_urls";s:4:"desc";s:231:"If this option is set to true, all URLs returned from the file manager will be relative from the specified document_base_url. If it is set to false all URLs will be converted to absolute URLs. This option is set to true by default.";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:1;s:7:"lexicon";N;s:4:"area";s:0:"";}s:17:"remove_linebreaks";a:7:{s:4:"name";s:17:"remove_linebreaks";s:4:"desc";s:531:"This option controls whether line break characters should be removed from output HTML. This option is enabled by default because there are differences between browser implementations regarding what to do with white space in the DOM. Gecko and Safari place white space in text nodes in the DOM. IE and Opera remove them from the DOM and therefore the line breaks will automatically be removed in those. This option will normalize this behavior when enabled (true) and all browsers will have a white-space-stripped DOM serialization.";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:0;s:7:"lexicon";N;s:4:"area";s:0:"";}s:18:"remove_script_host";a:7:{s:4:"name";s:18:"remove_script_host";s:4:"desc";s:221:"If this option is enabled the protocol and host part of the URLs returned from the file manager will be removed. This option is only used if the relative_urls option is set to false. This option is set to true by default.";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:1;s:7:"lexicon";N;s:4:"area";s:0:"";}s:20:"remove_trailing_nbsp";a:7:{s:4:"name";s:20:"remove_trailing_nbsp";s:4:"desc";s:392:"This option enables you to specify that TinyMCE should remove any traling &nbsp; characters in block elements if you start to write inside them. Paragraphs are default padded with a &nbsp; and if you write text into such paragraphs the space will remain. Setting this option to true will remove the space. This option is set to false by default since the cursor jumps a bit in Gecko browsers.";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:0;s:7:"lexicon";N;s:4:"area";s:0:"";}s:4:"skin";a:7:{s:4:"name";s:4:"skin";s:4:"desc";s:330:"This option enables you to specify what skin you want to use with your theme. A skin is basically a CSS file that gets loaded from the skins directory inside the theme. The advanced theme that TinyMCE comes with has two skins, these are called "default" and "o2k7". We added another skin named "cirkuit" that is chosen by default.";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:7:"cirkuit";s:7:"lexicon";N;s:4:"area";s:0:"";}s:12:"skin_variant";a:7:{s:4:"name";s:12:"skin_variant";s:4:"desc";s:403:"This option enables you to specify a variant for the skin, for example "silver" or "black". "default" skin does not offer any variant, whereas "o2k7" default offers "silver" or "black" variants to the default one. For the "cirkuit" skin there\'s one variant named "silver". When creating a skin, additional variants may also be created, by adding ui_[variant_name].css files alongside the default ui.css.";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:0:"";s:7:"lexicon";N;s:4:"area";s:0:"";}s:20:"table_inline_editing";a:7:{s:4:"name";s:20:"table_inline_editing";s:4:"desc";s:231:"This option gives you the ability to turn on/off the inline table editing controls in Firefox/Mozilla. According to the TinyMCE documentation, these controls are somewhat buggy and not redesignable, so they are disabled by default.";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:1;s:7:"lexicon";N;s:4:"area";s:0:"";}s:22:"theme_advanced_disable";a:7:{s:4:"name";s:22:"theme_advanced_disable";s:4:"desc";s:111:"This option should contain a comma separated list of controls to disable from any toolbar row/panel in TinyMCE.";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:0:"";s:7:"lexicon";N;s:4:"area";s:0:"";}s:19:"theme_advanced_path";a:7:{s:4:"name";s:19:"theme_advanced_path";s:4:"desc";s:331:"This option gives you the ability to enable/disable the element path. This option is only useful if the theme_advanced_statusbar_location option is set to "top" or "bottom". This option is set to "true" by default. Setting this option to "false" will effectively hide the path tool, though it still takes up room in the Status Bar.";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:1;s:7:"lexicon";N;s:4:"area";s:0:"";}s:32:"theme_advanced_resize_horizontal";a:7:{s:4:"name";s:32:"theme_advanced_resize_horizontal";s:4:"desc";s:319:"This option gives you the ability to enable/disable the horizontal resizing. This option is only useful if the theme_advanced_statusbar_location option is set to "top" or "bottom" and when the theme_advanced_resizing is set to true. This option is set to true by default, allowing both resizing horizontal and vertical.";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:1;s:7:"lexicon";N;s:4:"area";s:0:"";}s:23:"theme_advanced_resizing";a:7:{s:4:"name";s:23:"theme_advanced_resizing";s:4:"desc";s:216:"This option gives you the ability to enable/disable the resizing button. This option is only useful if the theme_advanced_statusbar_location option is set to "top" or "bottom". This option is set to false by default.";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:1;s:7:"lexicon";N;s:4:"area";s:0:"";}s:33:"theme_advanced_statusbar_location";a:7:{s:4:"name";s:33:"theme_advanced_statusbar_location";s:4:"desc";s:257:"This option enables you to specify where the element statusbar with the path and resize tool should be located. This option can be set to "top" or "bottom". The default value is set to "top". This option can only be used when the theme is set to "advanced".";s:4:"type";s:4:"list";s:7:"options";a:2:{i:0;a:2:{s:5:"value";s:3:"top";s:4:"text";s:3:"Top";}i:1;a:2:{s:5:"value";s:6:"bottom";s:4:"text";s:6:"Bottom";}}s:5:"value";s:6:"bottom";s:7:"lexicon";N;s:4:"area";s:0:"";}s:28:"theme_advanced_toolbar_align";a:7:{s:4:"name";s:28:"theme_advanced_toolbar_align";s:4:"desc";s:187:"This option enables you to specify the alignment of the toolbar, this value can be "left", "right" or "center" (the default). This option can only be used when theme is set to "advanced".";s:4:"type";s:9:"textfield";s:7:"options";a:3:{i:0;a:2:{s:5:"value";s:6:"center";s:4:"text";s:6:"Center";}i:1;a:2:{s:5:"value";s:4:"left";s:4:"text";s:4:"Left";}i:2;a:2:{s:5:"value";s:5:"right";s:4:"text";s:5:"Right";}}s:5:"value";s:4:"left";s:7:"lexicon";N;s:4:"area";s:0:"";}s:31:"theme_advanced_toolbar_location";a:7:{s:4:"name";s:31:"theme_advanced_toolbar_location";s:4:"desc";s:191:"
This option enables you to specify where the toolbar should be located. This option can be set to "top" or "bottom" (the defualt). This option can only be used when theme is set to advanced.";s:4:"type";s:4:"list";s:7:"options";a:2:{i:0;a:2:{s:5:"value";s:3:"top";s:4:"text";s:3:"Top";}i:1;a:2:{s:5:"value";s:6:"bottom";s:4:"text";s:6:"Bottom";}}s:5:"value";s:3:"top";s:7:"lexicon";N;s:4:"area";s:0:"";}s:5:"width";a:7:{s:4:"name";s:5:"width";s:4:"desc";s:32:"The width of the TinyMCE editor.";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:3:"95%";s:7:"lexicon";N;s:4:"area";s:0:"";}s:33:"template_selected_content_classes";a:7:{s:4:"name";s:33:"template_selected_content_classes";s:4:"desc";s:234:"Specify a list of CSS class names for the template plugin. They must be separated by spaces. Any template element with one of the specified CSS classes will have its content replaced by the selected editor content when first inserted.";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:0:"";s:7:"lexicon";N;s:4:"area";s:0:"";}}',
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => '',
    ),
    3 => 
    array (
      'id' => '3',
      'source' => '0',
      'property_preprocess' => '0',
      'name' => 'MIGX',
      'description' => '',
      'editor_type' => '0',
      'category' => '3',
      'cache_type' => '0',
      'plugincode' => '$corePath = $modx->getOption(\'migx.core_path\',null,$modx->getOption(\'core_path\').\'components/migx/\');
$assetsUrl = $modx->getOption(\'migx.assets_url\', null, $modx->getOption(\'assets_url\') . \'components/migx/\');
switch ($modx->event->name) {
    case \'OnTVInputRenderList\':
        $modx->event->output($corePath.\'elements/tv/input/\');
        break;
    case \'OnTVInputPropertiesList\':
        $modx->event->output($corePath.\'elements/tv/inputoptions/\');
        break;

        case \'OnDocFormPrerender\':
        $modx->controller->addCss($assetsUrl.\'css/mgr.css\');
        break; 
 
    /*          
    case \'OnTVOutputRenderList\':
        $modx->event->output($corePath.\'elements/tv/output/\');
        break;
    case \'OnTVOutputRenderPropertiesList\':
        $modx->event->output($corePath.\'elements/tv/properties/\');
        break;
    
    case \'OnDocFormPrerender\':
        $assetsUrl = $modx->getOption(\'colorpicker.assets_url\',null,$modx->getOption(\'assets_url\').\'components/colorpicker/\'); 
        $modx->regClientStartupHTMLBlock(\'<script type="text/javascript">
        Ext.onReady(function() {
            
        });
        </script>\');
        $modx->regClientStartupScript($assetsUrl.\'sources/ColorPicker.js\');
        $modx->regClientStartupScript($assetsUrl.\'sources/ColorMenu.js\');
        $modx->regClientStartupScript($assetsUrl.\'sources/ColorPickerField.js\');		
        $modx->regClientCSS($assetsUrl.\'resources/css/colorpicker.css\');
        break;
     */
}
return;',
      'locked' => '0',
      'properties' => 'a:0:{}',
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => '',
    ),
    5 => 
    array (
      'id' => '5',
      'source' => '0',
      'property_preprocess' => '0',
      'name' => 'GalleryCustomTV',
      'description' => '',
      'editor_type' => '0',
      'category' => '5',
      'cache_type' => '0',
      'plugincode' => '/**
 * Handles plugin events for Gallery\'s Custom TV
 *
 * @package gallery
 */
/** @noinspection PhpUndefinedVariableInspection */
$corePath = $modx->getOption(\'gallery.core_path\',null,$modx->getOption(\'core_path\').\'components/gallery/\');
switch ($modx->event->name) {
    case \'OnTVInputRenderList\':
        $modx->event->output($corePath.\'elements/tv/input/\');
        break;
    case \'OnTVOutputRenderList\':
        $modx->event->output($corePath.\'elements/tv/output/\');
        break;
    case \'OnTVInputPropertiesList\':
        $modx->event->output($corePath.\'elements/tv/inputoptions/\');
        break;
    case \'OnTVOutputRenderPropertiesList\':
        $modx->event->output($corePath.\'elements/tv/properties/\');
        break;
    case \'OnManagerPageBeforeRender\':
        /** @noinspection PhpUndefinedVariableInspection */
        $gallery = $modx->getService(\'gallery\',\'Gallery\',$modx->getOption(\'gallery.core_path\',null,$modx->getOption(\'core_path\').\'components/gallery/\').\'model/gallery/\',$scriptProperties);
        if (!($gallery instanceof Gallery)) return \'\';

        $snippetIds = \'\';
        $gallerySnippet = $modx->getObject(\'modSnippet\',array(\'name\' => \'Gallery\'));
        if ($gallerySnippet) {
            $snippetIds .= \'GAL.snippetGallery = "\'.$gallerySnippet->get(\'id\').\'";\'."\\n";
        }
        $galleryItemSnippet = $modx->getObject(\'modSnippet\',array(\'name\' => \'GalleryItem\'));
        if ($galleryItemSnippet) {
            $snippetIds .= \'GAL.snippetGalleryItem = "\'.$galleryItemSnippet->get(\'id\').\'";\'."\\n";
        }

        $jsDir = $modx->getOption(\'gallery.assets_url\',null,$modx->getOption(\'assets_url\').\'components/gallery/\').\'js/mgr/\';
        $modx->controller->addLexiconTopic(\'gallery:default\');
        $modx->controller->addJavascript($jsDir.\'gallery.js\');
        $modx->controller->addJavascript($jsDir.\'tree.js\');
        $modx->controller->addHtml(\'<script type="text/javascript">
        Ext.onReady(function() {
            GAL.config.connector_url = "\'.$gallery->config[\'connectorUrl\'].\'";
            \'.$snippetIds.\'
        });
        </script>\');
        break;
    case \'OnDocFormPrerender\':
        /** @noinspection PhpUndefinedVariableInspection */
        $gallery = $modx->getService(\'gallery\',\'Gallery\',$modx->getOption(\'gallery.core_path\',null,$modx->getOption(\'core_path\').\'components/gallery/\').\'model/gallery/\',$scriptProperties);
        if (!($gallery instanceof Gallery)) return \'\';

        /* assign gallery lang to JS */
        $modx->controller->addLexiconTopic(\'gallery:tv\');

        /* @var modAction $action */
        $action = null;
        if ($modx->getVersionData()[\'version\'] < 3){
            //V2
            $action = $modx->getObject(\'modAction\',array(
                \'namespace\' => \'gallery\',
                \'controller\' => \'index\',
            ));
        }

        $modx->controller->addHtml(\'<script type="text/javascript">
        Ext.onReady(function() {
            GAL.config = {};
            GAL.config.connector_url = "\'.$gallery->config[\'connectorUrl\'].\'";
            GAL.action = "\'.($action ? $action->get(\'id\') : 0).\'";
        });
        </script>\');
        $modx->controller->addJavascript($gallery->config[\'assetsUrl\'].\'js/mgr/tv/Spotlight.js\');
        $modx->controller->addJavascript($gallery->config[\'assetsUrl\'].\'js/mgr/gallery.js\');
        $modx->controller->addJavascript($gallery->config[\'assetsUrl\'].\'js/mgr/widgets/album/album.items.view.js\');
        $modx->controller->addJavascript($gallery->config[\'assetsUrl\'].\'js/mgr/widgets/album/album.tree.js\');
        $modx->controller->addJavascript($gallery->config[\'assetsUrl\'].\'js/mgr/tv/gal.browser.js\');
        $modx->controller->addJavascript($gallery->config[\'assetsUrl\'].\'js/mgr/tv/galtv.js\');
        $modx->controller->addCss($gallery->config[\'cssUrl\'].\'mgr.css\');
        break;
}
return;',
      'locked' => '0',
      'properties' => 'a:0:{}',
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => '',
    ),
    6 => 
    array (
      'id' => '6',
      'source' => '0',
      'property_preprocess' => '0',
      'name' => 'SimpleSearchIndexer',
      'description' => 'Automatically indexes Resources into Solr.',
      'editor_type' => '0',
      'category' => '0',
      'cache_type' => '0',
      'plugincode' => '/**
 * SimpleSearch
 *
 * Copyright 2010-11 by Shaun McCormick <shaun+sisea@modx.com>
 *
 * This file is part of SimpleSearch, a simple search component for MODx
 * Revolution. It is loosely based off of AjaxSearch for MODx Evolution by
 * coroico/kylej, minus the ajax.
 *
 * SimpleSearch is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License as published by the Free Software
 * Foundation; either version 2 of the License, or (at your option) any later
 * version.
 *
 * SimpleSearch is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE. See the GNU General Public License for more
 * details.
 *
 * You should have received a copy of the GNU General Public License along with
 * SimpleSearch; if not, write to the Free Software Foundation, Inc., 59 Temple Place,
 * Suite 330, Boston, MA 02111-1307 USA
 *
 * @package simplesearch
 */
/**
 * Plugin to index Resources whenever they are changed, published, unpublished,
 * deleted, or undeleted.
 *
 * @var modX $modx
 * @var SimpleSearch $search
 *
 * @package simplesearch
 */

require_once $modx->getOption(\'sisea.core_path\',null,$modx->getOption(\'core_path\').\'components/simplesearch/\').\'model/simplesearch/simplesearch.class.php\';
$search = new SimpleSearch($modx,$scriptProperties);

$search->loadDriver($scriptProperties);
if (!$search->driver || (!($search->driver instanceof SimpleSearchDriverSolr) && !($search->driver instanceof SimpleSearchDriverElastic))) return;

/**
 * helper method for missing params in events
 * @param modX $modx
 * @param array $children
 * @param int $parent
 * @return boolean
 */
if (!function_exists(\'SimpleSearchGetChildren\')) {
    function SimpleSearchGetChildren(&$modx,&$children,$parent) {
        $success = false;
        $kids = $modx->getCollection(\'modResource\',array(
            \'parent\' => $parent,
        ));
        if (!empty($kids)) {
            /** @var modResource $kid */
            foreach ($kids as $kid) {
                $children[] = $kid->toArray();
                SimpleSearchGetChildren($modx,$children,$kid->get(\'id\'));
            }
        }
        return $success;
    }
}

$action = \'index\';
$resourcesToIndex = array();
switch ($modx->event->name) {
    case \'OnDocFormSave\':
        $action = \'index\';
        $resourceArray = $scriptProperties[\'resource\']->toArray();

        if ($resourceArray[\'published\'] == 1 && $resourceArray[\'deleted\'] == 0) {
            $action = \'index\';
            foreach ($_POST as $k => $v) {
                if (substr($k,0,2) == \'tv\') {
                    $id = str_replace(\'tv\',\'\',$k);
                    /** @var modTemplateVar $tv */
                    $tv = $modx->getObject(\'modTemplateVar\',$id);
                    if ($tv) {
                        $resourceArray[$tv->get(\'name\')] = $tv->renderOutput($resource->get(\'id\'));
                        $modx->log(modX::LOG_LEVEL_DEBUG,\'Indexing \'.$tv->get(\'name\').\': \'.$resourceArray[$tv->get(\'name\')]);
                    }
                    unset($resourceArray[$k]);
                }
            }
        } else {
            $action = \'removeIndex\';
        }

        unset($resourceArray[\'ta\'],$resourceArray[\'action\'],$resourceArray[\'tiny_toggle\'],$resourceArray[\'HTTP_MODAUTH\'],$resourceArray[\'modx-ab-stay\'],$resourceArray[\'resource_groups\']);
        $resourcesToIndex[] = $resourceArray;
        break;
    case \'OnDocPublished\':
        $action = \'index\';
        $resourceArray = $scriptProperties[\'resource\']->toArray();
        unset($resourceArray[\'ta\'],$resourceArray[\'action\'],$resourceArray[\'tiny_toggle\'],$resourceArray[\'HTTP_MODAUTH\'],$resourceArray[\'modx-ab-stay\'],$resourceArray[\'resource_groups\']);
        $resourcesToIndex[] = $resourceArray;
        break;
    case \'OnDocUnpublished\':
    case \'OnDocUnPublished\':
        $action = \'removeIndex\';
        $resourceArray = $scriptProperties[\'resource\']->toArray();
        unset($resourceArray[\'ta\'],$resourceArray[\'action\'],$resourceArray[\'tiny_toggle\'],$resourceArray[\'HTTP_MODAUTH\'],$resourceArray[\'modx-ab-stay\'],$resourceArray[\'resource_groups\']);
        $resourcesToIndex[] = $resourceArray;
        break;
    case \'OnResourceDuplicate\':
        $action = \'index\';
        /** @var modResource $newResource */
        $resourcesToIndex[] = $newResource->toArray();
        $children = array();
        SimpleSearchGetChildren($modx,$children,$newResource->get(\'id\'));
        foreach ($children as $child) {
            $resourcesToIndex[] = $child;
        }
        break;
    case \'OnResourceDelete\':
        $action = \'removeIndex\';
        $resourcesToIndex[] = $resource->toArray();
        $children = array();
        SimpleSearchGetChildren($modx,$children,$resource->get(\'id\'));
        foreach ($children as $child) {
            $resourcesToIndex[] = $child;
        }
        break;
    case \'OnResourceUndelete\':
        $action = \'index\';
        $resourcesToIndex[] = $resource->toArray();
        $children = array();
        SimpleSearchGetChildren($modx,$children,$resource->get(\'id\'));
        foreach ($children as $child) {
            $resourcesToIndex[] = $child;
        }
        break;
}

foreach ($resourcesToIndex as $resourceArray) {
    if (!empty($resourceArray[\'id\'])) {
        if ($action == \'index\') {
            $search->driver->index($resourceArray);
        } else if ($action == \'removeIndex\') {
            $search->driver->removeIndex($resourceArray[\'id\']);
        }
    }
}
return;',
      'locked' => '0',
      'properties' => NULL,
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => '',
    ),
    7 => 
    array (
      'id' => '7',
      'source' => '1',
      'property_preprocess' => '0',
      'name' => 'controlErrorLog',
      'description' => '',
      'editor_type' => '0',
      'category' => '27',
      'cache_type' => '0',
      'plugincode' => '/** @var modX $modx */
switch ($modx->event->name) {
    case \'OnManagerPageBeforeRender\':
        if ($modx->getOption(\'controlerrorlog.enable\', null, true) && $modx->hasPermission(\'error_log_view\')) {
            $modx->controller->addLexiconTopic(\'controlerrorlog:default\');
            $assetsUrl = $modx->getOption(\'controlerrorlog_assets_url\', null, $modx->getOption(\'assets_url\') . \'components/controlerrorlog/\') ;
            $modx->controller->addCss($assetsUrl . \'css/mgr/main.css\');
            $modx->controller->addJavascript($assetsUrl . \'js/mgr/cel.default.js\');


            $path = $modx->getOption(\'controlerrorlog_core_path\', null, $modx->getOption(\'core_path\') . \'components/controlerrorlog/\') . \'processors/\';
            $response = $modx->runProcessor(\'mgr/get\', [\'includeContent\' => false], [\'processors_path\' => $path]);
            $resObj = $response->getObject();
            $_html = "<script>	controlErrorLog.config = " . $modx->toJSON($resObj) . ";</script>";
            $modx->controller->addHtml($_html);
        }
        break;
    case \'OnBeforeRegisterClientScripts\':
        $isAuth = $modx->user->isAuthenticated(\'mgr\') && $modx->user->isAuthenticated($modx->context->key);
        if ($isAuth && $modx->getOption(\'controlerrorlog.control_frontend\', null, true) && $modx->hasPermission(\'error_log_view\')) {
            $modx->lexicon->load(\'controlerrorlog:default\');
            $modx->regClientHTMLBlock($modx->getChunk(\'errorLogPanel.tpl\'));

            $assetsUrl = $modx->getOption(\'controlerrorlog_assets_url\', null, $modx->getOption(\'assets_url\') . \'components/controlerrorlog/\') ;
            if ($css = $modx->getOption(\'controlerrorlog.css_file\', null, $assetsUrl . \'css/web/default.css\')) {
                $modx->regClientCSS($css);
            }
            if ($js = $modx->getOption(\'controlerrorlog.js_file\', null, $assetsUrl . \'js/web/default.js\')) {
                $modx->regClientScript($js);
            }

            if (!isset($_SESSION[\'controlerrorlog\'][\'token\'])) {
                $_SESSION[\'controlerrorlog\'][\'token\'] = md5(MODX_HTTP_HOST . time() . mt_rand(1, 1000));
            }
            $path = $modx->getOption(\'controlerrorlog_core_path\', null, $modx->getOption(\'core_path\') . \'components/controlerrorlog/\') . \'processors/\';
            $response = $modx->runProcessor(\'web/get\', [\'includeContent\' => false, \'token\' => @$_SESSION[\'controlerrorlog\'][\'token\']], [\'processors_path\' => $path]);
            $rObject = $response->getObject();
            $config = json_encode($rObject[\'config\']);
            $connectorUrl = $assetsUrl . \'api.php\';
            $rObject["tooLarge"] = $rObject["tooLarge"] ? \'true\' : \'false\';
            $rObject["empty"] = $rObject["empty"] ? \'true\' : \'false\';
            $resObj = "{
                token: \'{$_SESSION[\'controlerrorlog\'][\'token\']}\',
                config: {$config},
                collapsed: false,
                connectorUrl: \'{$connectorUrl}\',
                tooLarge: {$rObject["tooLarge"]},
                size: \'{$rObject["size"]}\',
                empty: {$rObject["empty"]},
                log: \'{$rObject["log"]}\',
                messages_count: {$rObject["messages_count"]}
            }";
            $_html = "<script>\\r\\n\\tlet controlErrorLog = " . $resObj . ";\\r\\n</script>";
            $modx->regClientStartupHTMLBlock($_html);
        }
        break;
}',
      'locked' => '0',
      'properties' => NULL,
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => 'core/components/controlerrorlog/elements/plugins/plugin.controlerrorlog.php',
    ),
    8 => 
    array (
      'id' => '8',
      'source' => '1',
      'property_preprocess' => '0',
      'name' => 'modDevTools',
      'description' => '',
      'editor_type' => '0',
      'category' => '28',
      'cache_type' => '0',
      'plugincode' => '/**
 * modDevTools
 *
 * Copyright 2014 by Vitaly Kireev <kireevvit@gmail.com>
 *
 * @package moddevtools
 *
 * @var modX $modx
 * @var int $id
 * @var string $mode
 */

/**
 * @var modx $modx
 */
$path = $modx->getOption(\'moddevtools_core_path\',null,$modx->getOption(\'core_path\').\'components/moddevtools/\').\'model/moddevtools/\';
/**
 * @var modDevTools $devTools
 */
$devTools = $modx->getService(\'devTools\',\'modDevTools\',$path);
$eventName = $modx->event->name;

switch($eventName) {
    case \'OnDocFormSave\':
        $devTools->debug(\'Start OnDocFormSave\');
        $devTools->parseContent($resource);
        break;
    case \'OnTempFormSave\':
        $devTools->debug(\'Start OnTempFormSave\');
        $devTools->parseContent($template);
        break;
    case \'OnTVFormSave\':

        break;
    case \'OnChunkFormSave\':
        $devTools->debug(\'Start OnChunkFormSave\');
        $devTools->parseContent($chunk);

        $parent = $modx->getOption(\'parent\', $_REQUEST);
        $link_type = $modx->getOption(\'link_type\', $_REQUEST);
        $devTools->parseParent($parent, $link_type);
        break;
    case \'OnSnipFormSave\':

        break;
    /* Add tabs */
    case \'OnDocFormPrerender\':
        if ($modx->event->name == \'OnDocFormPrerender\') {
            $devTools->getBreadCrumbs($scriptProperties);
            $devTools->showTemplate($scriptProperties);
            return;
        }
        break;

    case \'OnTempFormPrerender\':
        if ($mode == modSystemEvent::MODE_UPD) {
            $result = $devTools->outputTab(\'Template\');
        }
        break;

    case \'OnTVFormPrerender\':
        break;


    case \'OnChunkFormPrerender\':
        if ($mode == modSystemEvent::MODE_UPD) {
            $result = $devTools->outputTab(\'Chunk\');
        }
        break;

    case \'OnSnipFormPrerender\':
        if ($mode == modSystemEvent::MODE_UPD) {
            $result = $devTools->outputTab(\'Snippet\');
        }
        break;


}

if (isset($result) && $result === true)
    return;
elseif (isset($result)) {
    $modx->log(modX::LOG_LEVEL_ERROR,\'[modDevTools] An error occured. Event: \'.$eventName.\' - Error: \'.($result === false) ? \'undefined error\' : $result);
    return;
}',
      'locked' => '0',
      'properties' => NULL,
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => 'core/components/moddevtools/elements/plugins/plugin.moddevtools.php',
    ),
    9 => 
    array (
      'id' => '9',
      'source' => '0',
      'property_preprocess' => '0',
      'name' => 'Collections',
      'description' => '',
      'editor_type' => '0',
      'category' => '30',
      'cache_type' => '0',
      'plugincode' => '/**
 * Collections
 *
 * DESCRIPTION
 *
 * This plugin inject JS to handle proper working of close buttons in Resource\'s panel (OnDocFormPrerender)
 * This plugin handles setting proper show_in_tree parameter (OnBeforeDocFormSave, OnResourceSort)
 *
 * @var modX $modx
 * @var array $scriptProperties
 */
$corePath = $modx->getOption(\'collections.core_path\', null, $modx->getOption(\'core_path\', null, MODX_CORE_PATH) . \'components/collections/\');
/** @var Collections $collections */
$collections = $modx->getService(
    \'collections\',
    \'Collections\',
    $corePath . \'model/collections/\',
    array(
        \'core_path\' => $corePath
    )
);

if (!($collections instanceof Collections)) return \'\';

$className = "\\\\Collections\\\\Events\\\\{$modx->event->name}";
if (class_exists($className)) {
    /** @var \\Collections\\Events\\Event $handler */
    $handler = new $className($modx, $scriptProperties);
    $handler->run();
}

return;',
      'locked' => '0',
      'properties' => 'a:0:{}',
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => '',
    ),
    10 => 
    array (
      'id' => '10',
      'source' => '1',
      'property_preprocess' => '0',
      'name' => 'pdoTools',
      'description' => '',
      'editor_type' => '0',
      'category' => '4',
      'cache_type' => '0',
      'plugincode' => '/** @var modX $modx */
switch ($modx->event->name) {

    case \'OnMODXInit\':
        $fqn = $modx->getOption(\'pdoTools.class\', null, \'pdotools.pdotools\', true);
        $path = $modx->getOption(\'pdotools_class_path\', null, MODX_CORE_PATH . \'components/pdotools/model/\', true);
        $modx->loadClass($fqn, $path, false, true);

        $fqn = $modx->getOption(\'pdoFetch.class\', null, \'pdotools.pdofetch\', true);
        $path = $modx->getOption(\'pdofetch_class_path\', null, MODX_CORE_PATH . \'components/pdotools/model/\', true);
        $modx->loadClass($fqn, $path, false, true);
        break;

    case \'OnSiteRefresh\':
        /** @var pdoTools $pdoTools */
        if ($pdoTools = $modx->getService(\'pdoTools\')) {
            if ($pdoTools->clearFileCache()) {
                $modx->log(modX::LOG_LEVEL_INFO, $modx->lexicon(\'refresh_default\') . \': pdoTools\');
            }
        }
        break;

    case \'OnWebPagePrerender\':
        $parser = $modx->getParser();
        if ($parser instanceof pdoParser) {
            foreach ($parser->pdoTools->ignores as $key => $val) {
                $modx->resource->_output = str_replace($key, $val, $modx->resource->_output);
            }
        }
        break;
}',
      'locked' => '0',
      'properties' => NULL,
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => 'core/components/pdotools/elements/plugins/plugin.pdotools.php',
    ),
    31 => 
    array (
      'id' => '31',
      'source' => '1',
      'property_preprocess' => '0',
      'name' => 'fileTranslit',
      'description' => '',
      'editor_type' => '0',
      'category' => '8',
      'cache_type' => '0',
      'plugincode' => 'switch ($modx->event->name) {
    case \'OnFileManagerUpload\':
        $generator = $modx->newObject(\'modResource\');
        $bases = $source->getBases($directory);
        $fullPath = $bases[\'pathAbsolute\'].ltrim($directory,\'/\');
        $directory = $source->fileHandler->make($fullPath);
        foreach ($files as $file) {
            $ext = pathinfo($file[\'name\'],PATHINFO_EXTENSION);
            $name = str_replace(\'.\'.$ext,\'\',$file[\'name\']);
            rename($directory->getPath().$file[\'name\'], $directory->getPath() .$generator->cleanAlias($name).\'.\'.$ext);
        }
        break;
    default: break;
}',
      'locked' => '0',
      'properties' => 'a:0:{}',
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => '',
    ),
    12 => 
    array (
      'id' => '12',
      'source' => '1',
      'property_preprocess' => '0',
      'name' => 'Tickets',
      'description' => '',
      'editor_type' => '0',
      'category' => '40',
      'cache_type' => '0',
      'plugincode' => '/** @var modX $modx */
switch ($modx->event->name) {

    case \'OnSiteRefresh\':
        if ($modx->cacheManager->refresh(array(\'default/tickets\' => array()))) {
            $modx->log(modX::LOG_LEVEL_INFO, $modx->lexicon(\'refresh_default\') . \': Tickets\');
        }
        break;

    case \'OnDocFormSave\':
        /** @var Ticket $resource */
        if ($mode == \'new\' && $resource->class_key == "Ticket") {
            $modx->cacheManager->delete(\'tickets/latest.tickets\');
        }
        break;

    case \'OnWebPagePrerender\':
        $output = &$modx->resource->_output;
        $output = str_replace(
            array(\'*(*(*(*(*(*\', \'*)*)*)*)*)*\', \'~(~(~(~(~(~\', \'~)~)~)~)~)~\'),
            array(\'[\', \']\', \'{\', \'}\'),
            $output
        );
        break;

    case \'OnPageNotFound\':
        // It is working only with friendly urls enabled
        $q = trim(@$_REQUEST[$modx->context->getOption(\'request_param_alias\', \'q\')]);
        $matches = explode(\'/\', rtrim($q, \'/\'));
        if (count($matches) < 2) {
            return;
        }

        $ticket_uri = array_pop($matches);
        $section_uri = implode(\'/\', $matches) . \'/\';

        if ($section_id = $modx->findResource($section_uri)) {
            /** @var TicketsSection $section */
            if ($section = $modx->getObject(\'TicketsSection\', array(\'id\' => $section_id))) {
                if (is_numeric($ticket_uri)) {
                    $ticket_id = $ticket_uri;
                } elseif (preg_match(\'#^\\d+#\', $ticket_uri, $tmp)) {
                    $ticket_id = $tmp[0];
                } else {
                    $properties = $section->getProperties(\'tickets\');
                    if (!empty($properties[\'uri\']) && strpos($properties[\'uri\'], \'%id\') !== false) {
                        $pcre = str_replace(\'%id\', \'([0-9]+)\', $properties[\'uri\']);
                        $pcre = preg_replace(\'#(\\%[a-z]+)#\', \'(?:.*?)\', $pcre);
                        if (@preg_match(\'#\' . trim($pcre, \'/\') . \'#\', $ticket_uri, $matches)) {
                            $ticket_id = $matches[1];
                        }
                    }
                }
                if (!empty($ticket_id)) {
                    if ($ticket = $modx->getObject(\'Ticket\', array(\'id\' => $ticket_id, \'deleted\' => 0))) {
                        if ($ticket->published) {
                            $modx->sendRedirect($modx->makeUrl($ticket_id),
                                array(\'responseCode\' => \'HTTP/1.1 301 Moved Permanently\'));
                        } elseif ($unp_id = $modx->getOption(\'tickets.unpublished_ticket_page\')) {
                            $modx->sendForward($unp_id, \'HTTP/1.1 403 Forbidden\');
                        }
                    }
                }
            }
        }
        break;

    case \'OnLoadWebDocument\':
        $authenticated = $modx->user->isAuthenticated($modx->context->get(\'key\'));
        $key = \'Tickets_User\';

        if (!$authenticated && !$modx->getOption(\'tickets.count_guests\')) {
            return;
        }

        if (empty($_COOKIE[$key])) {
            if (!empty($_SESSION[$key])) {
                $guest_key = $_SESSION[$key];
            } else {
                $guest_key = $_SESSION[$key] = md5(rand() . time() . rand());
            }
            setcookie($key, $guest_key, time() + (86400 * 365), \'/\');
        } else {
            $guest_key = $_COOKIE[$key];
        }

        if (empty($_SESSION[$key])) {
            $_SESSION[$key] = $guest_key;
        }

        if ($authenticated) {
            /** @var TicketAuthor $profile */
            if (!$profile = $modx->user->getOne(\'AuthorProfile\')) {
                $profile = $modx->newObject(\'TicketAuthor\');
                $modx->user->addOne($profile);
            }
            $profile->set(\'visitedon\', time());
            $profile->save();
        }
        break;

    case \'OnWebPageComplete\':
        /** @var Tickets $Tickets */
        $Tickets = $modx->getService(\'tickets\');
        $Tickets->logView($modx->resource->get(\'id\'));
        break;

    case \'OnUserSave\':
        /** @var modUser $user */
        if ($mode == \'new\' && $user && !$user->getOne(\'AuthorProfile\')) {
            $profile = $modx->newObject(\'TicketAuthor\');
            $user->addOne($profile);
            $profile->save();
        }
        break;

}',
      'locked' => '0',
      'properties' => NULL,
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => 'core/components/tickets/elements/plugins/plugin.tickets.php',
    ),
    19 => 
    array (
      'id' => '19',
      'source' => '1',
      'property_preprocess' => '0',
      'name' => 'AutoTemplate',
      'description' => 'Set the template of a new resource automatically to the one it\'s siblings have or, if it has no siblings, to the one it\'s parent has.',
      'editor_type' => '0',
      'category' => '4',
      'cache_type' => '0',
      'plugincode' => '/**
 * AutoTemplate for MODx Revolution
 *
 * This plugin sets a new document\'s template automatically to the one it\'s siblings
 * have or, if it has no siblings, to the one it\'s parent has.
 *
 * AutoTemplate is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License as published by the Free Software
 * Foundation; either version 2 of the License, or (at your option) any later
 * version.
 *
 * AutoTemplate is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE. See the GNU General Public License for more
 * details.
 *
 * You should have received a copy of the GNU General Public License along with
 * Inherit Template; if not, write to the Free Software Foundation, Inc., 59 Temple
 * Place, Suite 330, Boston, MA 02111-1307 USA
 *
 * @author      Maarten     <@maarten>
 * @copyright   Copyright (c) 2009, Magnatron
 * @license     GPL v2
 *
 * @package     AutoTemplate
 * @subpackage  plugin
 */


if ($modx->event->name === \'OnDocFormRender\') {
	
	// Only when new
	if (empty($scriptProperties[\'mode\']) || $scriptProperties[\'mode\'] !== \'new\') return;
	
	// Siblings
	$c = $modx->newQuery(\'modResource\', array(\'parent\'=>$_REQUEST[\'parent\']));
	$c->sortby(\'id\', \'desc\'); // Reference last added sibling
	$siblings = $modx->getCollection(\'modResource\', $c);
	if(count($siblings)>0){
		$bro = array_shift($siblings);
		$modx->controller->setProperty(\'template\', $bro->get(\'template\'));
		return;
	}
	// No siblings, use parent
	if((int)$_REQUEST[\'parent\']!=0){
		$dad = $modx->getObject(\'modResource\', $_REQUEST[\'parent\']);
		$modx->controller->setProperty(\'template\', $dad->get(\'template\'));
		return;
	}
}

return;',
      'locked' => '0',
      'properties' => 'a:0:{}',
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => '',
    ),
    20 => 
    array (
      'id' => '20',
      'source' => '0',
      'property_preprocess' => '0',
      'name' => 'DynamicDropdownTV',
      'description' => 'Tell MODX to check these directories for DynamicDropdownTV files and save parents and childrens of DynamicDropdownTVs to the TV options.',
      'editor_type' => '0',
      'category' => '50',
      'cache_type' => '0',
      'plugincode' => '/**
 * DynamicDropdownTV
 *
 * Copyright 2012-2013 by Bruno Perner <b.perner@gmx.de>
 *
 * DynamicDropdownTV is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License as published by the Free
 * Software Foundation; either version 2 of the License, or (at your option) any
 * later version.
 *
 * DynamicDropdownTV is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more
 * details.
 *
 * You should have received a copy of the GNU General Public License along with
 * DynamicDropdownTV; if not, write to the Free Software Foundation, Inc., 59
 * Temple Place, Suite 330, Boston, MA 02111-1307 USA
 *
 * @package dynamicdropdowntv
 * @subpackage plugin
 *
 * Plugins for DynamicDropdownTV
 */
if (!function_exists(\'ddSetParentChilds\')) {

	function ddSetParentChilds($tvName, $parentTvName, $ddTvArr) {
		if (!empty($parentTvName) && array_key_exists($parentTvName, $ddTvArr)) {
			$ddTvArr[$parentTvName][\'childs\'][$tvName] = $tvName;
			if (!empty($ddTvArr[$parentTvName][\'properties\'][\'parent\'])) {
				$ddTvArr = ddSetParentChilds($tvName, $ddTvArr[$parentTvName][\'properties\'][\'parent\'], $ddTvArr);
			}
		}
		return $ddTvArr;
	}

}

$corePath = $modx->getOption(\'dynamicdropdowntv.core_path\', null, $modx->getOption(\'core_path\') . \'components/dynamicdropdowntv/\');

switch ($modx->event->name) {
	case \'OnTVInputRenderList\':
		$modx->event->output($corePath . \'tv/input/\');
		break;
	case \'OnTVOutputRenderList\':
		$modx->event->output($corePath . \'tv/output/\');
		break;
	case \'OnTVInputPropertiesList\':
		$modx->event->output($corePath . \'tv/inputoptions/\');
		break;
	case \'OnTVOutputRenderPropertiesList\':
		$modx->event->output($corePath . \'tv/properties/\');
		break;
	case \'OnManagerPageBeforeRender\':
		break;
	case \'OnTVFormSave\':
		$tv = &$scriptProperties[\'tv\'];
		$tvName = $tv->get(\'name\');
		$tvType = $tv->get(\'type\');
		if ($tvType == \'dynamicdropdown\' || $tvType == \'dynamicdropdown_multiple\') {
			$tvInputProperties = $tv->get(\'input_properties\');
			// get all DynamicDropdownTVs
			$c = $modx->newQuery(\'modTemplateVar\');
			$c->where(array(\'type:LIKE\' => \'dynamicdropdown%\'));
			$ddTvs = $modx->getCollection(\'modTemplateVar\', $c);

			$ddTvArr = array();
			foreach ($ddTvs as $key => $ddTv) {
				$ddTvInputProperties = $ddTv->get(\'input_properties\');
				// work only with them in the same dd-group
				if ($ddTvInputProperties[\'group\'] == $tvInputProperties[\'group\']) {
					$ddTvArr[$ddTv->get(\'name\')][\'properties\'] = $ddTv->get(\'input_properties\');
				} else {
					unset($ddTvs[$key]);
				}
			}
			$ddTvResult = $ddTvArr;
			foreach ($ddTvArr as $tvName => $ddTv) {
				$ddTvInputProperties = $ddTv[\'properties\'];
				$ddTvResult = ddSetParentChilds($tvName, $ddTvInputProperties[\'parent\'], $ddTvResult);
			}
			$ddTvArr = $ddTvResult;
			foreach ($ddTvArr as $tvName => $ddTv) {
				$ddTvInputProperties = $ddTv[\'properties\'];
				if (count($ddTv[\'childs\'] > 0)) {
					foreach ($ddTv[\'childs\'] as $child) {
						$ddTvResult[$child][\'parents\'][$tvName] = $tvName;
					}
				}
			}
			foreach ($ddTvs as $key => $ddTv) {
				$ddTvInputProperties = $ddTv->get(\'input_properties\');
				$ddTvInputProperties[\'childs\'] = isset($ddTvResult[$ddTv->get(\'name\')][\'childs\']) ? implode(\',\', $ddTvResult[$ddTv->get(\'name\')][\'childs\']) : \'\';
				$ddTvInputProperties[\'parents\'] = isset($ddTvResult[$ddTv->get(\'name\')][\'parents\']) ? implode(\',\', $ddTvResult[$ddTv->get(\'name\')][\'parents\']) : \'\';
				$ddTv->set(\'input_properties\', $ddTvInputProperties);
				$ddTv->save();
			}
		}
		break;
}
return;',
      'locked' => '0',
      'properties' => NULL,
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => '',
    ),
    24 => 
    array (
      'id' => '24',
      'source' => '1',
      'property_preprocess' => '0',
      'name' => 'AjaxSnippet',
      'description' => '',
      'editor_type' => '0',
      'category' => '53',
      'cache_type' => '0',
      'plugincode' => 'switch ($modx->event->name) {

	case \'OnLoadWebDocument\':
		if (empty($_SERVER[\'HTTP_X_REQUESTED_WITH\']) || $_SERVER[\'HTTP_X_REQUESTED_WITH\'] != \'XMLHttpRequest\') {
			return;
		}
		/** @var xPDOFileCache $cache */
		$cache = $modx->cacheManager;
		$cache_key = \'/ajaxsnippet/\';

		if (!empty($_REQUEST[\'as_action\']) && $scriptProperties = $cache->get($cache_key . $_REQUEST[\'as_action\'])) {
			$output = \'\';
			/** @var modSnippet $object */
			if ($object = $modx->getObject(\'modSnippet\', array(\'name\' => $scriptProperties[\'snippet\']))) {
				$properties = $object->getProperties();
				if (!empty($scriptProperties[\'propertySet\'])) {
					$properties = array_merge($properties, $object->getPropertySet($scriptProperties[\'propertySet\']));
				}
				$scriptProperties = array_merge($properties, $scriptProperties);

				$output = $object->process($scriptProperties);
				if (strpos($output, \'[[\') !== false) {
					$maxIterations = intval($modx->getOption(\'parser_max_iterations\', $options, 10));
					$modx->parser->processElementTags(\'\', $output, true, false, \'[[\', \']]\', array(), $maxIterations);
					$modx->parser->processElementTags(\'\', $output, true, true, \'[[\', \']]\', array(), $maxIterations);
				}
			}

			$response = array(
				\'output\' => $output,
				\'key\' => $_REQUEST[\'as_action\'],
				\'snippet\' => $scriptProperties[\'snippet\'],
			);
			if (!empty($scriptProperties[\'totalVar\'])) {
				$response[\'total\'] = $modx->getPlaceholder($scriptProperties[\'totalVar\']);
			}
			if (!empty($scriptProperties[\'pageNavVar\'])) {
				$response[\'pagination\'] = $modx->getPlaceholder($scriptProperties[\'pageNavVar\']);
			}

			echo $modx->toJSON($response);
			@session_write_close();
			exit;
		}
		break;

}',
      'locked' => '0',
      'properties' => NULL,
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => 'core/components/ajaxsnippet/elements/plugins/plugin.ajaxsnippet.php',
    ),
    25 => 
    array (
      'id' => '25',
      'source' => '0',
      'property_preprocess' => '0',
      'name' => 'ClientConfig',
      'description' => 'Sets system settings from the Client Config CMP.',
      'editor_type' => '0',
      'category' => '0',
      'cache_type' => '0',
      'plugincode' => '/**
 * ClientConfig
 *
 * Copyright 2011-2014 by Mark Hamstra <hello@markhamstra.com>
 *
 * ClientConfig is free software; you can redistribute it and/or modify it under the
 * terms of the GNU General Public License as published by the Free Software
 * Foundation; either version 2 of the License, or (at your option) any later
 * version.
 *
 * ClientConfig is distributed in the hope that it will be useful, but WITHOUT ANY
 * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
 * A PARTICULAR PURPOSE. See the GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with
 * ClientConfig; if not, write to the Free Software Foundation, Inc., 59 Temple
 * Place, Suite 330, Boston, MA 02111-1307 USA
 *
 * @package clientconfig
 *
 * @var modX $modx
 * @var int $id
 * @var string $mode
 * @var modResource $resource
 * @var modTemplate $template
 * @var modTemplateVar $tv
 * @var modChunk $chunk
 * @var modSnippet $snippet
 * @var modPlugin $plugin
*/

$eventName = $modx->event->name;

switch($eventName) {
    case \'OnMODXInit\':
    case \'OnHandleRequest\':
    case \'pdoToolsOnFenomInit\':
        // Measure to guard against pdoTools fenom parser loop bug: https://github.com/modmore/ClientConfig/issues/192
        // Here we only allow the pdoToolsOnFenomInit event to trigger the first time.
        if ($eventName === \'pdoToolsOnFenomInit\') {
            if ($modx->getOption(\'clientconfig.fenom_initialized\')) {
                return;
            }
            $modx->setOption(\'clientconfig.fenom_initialized\', true);
        }

        /* Grab the class */
        $path = $modx->getOption(\'clientconfig.core_path\', null, $modx->getOption(\'core_path\') . \'components/clientconfig/\');
        $path .= \'model/clientconfig/\';
        $clientConfig = $modx->getService(\'clientconfig\',\'ClientConfig\', $path);

        /* If we got the class (gotta be careful of failed migrations), grab settings and go! */
        if ($clientConfig instanceof ClientConfig) {
            $contextKey = $modx->context instanceof modContext || $modx->context instanceof \\MODX\\Revolution\\modContext
                ? $modx->context->get(\'key\') : \'web\';
            $settings = $clientConfig->getSettings($contextKey);

            /* Make settings available as [[++tags]] */
            $modx->setPlaceholders($settings, \'+\');

            /* Make settings available for $modx->getOption() */
            foreach ($settings as $key => $value) {
                $modx->setOption($key, $value);
            }
        }
        break;
}

return;',
      'locked' => '0',
      'properties' => NULL,
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => '',
    ),
    26 => 
    array (
      'id' => '26',
      'source' => '0',
      'property_preprocess' => '0',
      'name' => 'migxResizeOnUpload',
      'description' => '',
      'editor_type' => '0',
      'category' => '3',
      'cache_type' => '0',
      'plugincode' => '/**
 * migxResizeOnUpload Plugin
 *
 * Events: OnFileManagerUpload
 * Author: Bruno Perner <b.perner@gmx.de>
 * Modified to read multiple configs from mediasource-property
 * 
 * First Author: Vasiliy Naumkin <bezumkin@yandex.ru>
 * Required: PhpThumbOf snippet for resizing images
 * 
 * Example: mediasource - property \'resizeConfig\':
 * [{"alias":"origin","w":"500","h":"500","far":1},{"alias":"thumb","w":"150","h":"150","far":1}]
 */

if ($modx->event->name != \'OnFileManagerUpload\') {
    return;
}


$file = $modx->event->params[\'files\'][\'file\'];
$directory = $modx->event->params[\'directory\'];

if ($file[\'error\'] != 0) {
    return;
}

$name = $file[\'name\'];
//$extensions = explode(\',\', $modx->getOption(\'upload_images\'));

$source = $modx->event->params[\'source\'];

if ($source instanceof modMediaSource) {
    //$dirTree = $modx->getOption(\'dirtree\', $_REQUEST, \'\');
    //$modx->setPlaceholder(\'docid\', $resource_id);
    $source->initialize();
    $basePath = str_replace(\'/./\', \'/\', $source->getBasePath());
    //$cachepath = $cachepath . $dirTree;
    $baseUrl = $modx->getOption(\'site_url\') . $source->getBaseUrl();
    //$baseUrl = $baseUrl . $dirTree;
    $sourceProperties = $source->getPropertyList();

    //echo \'<pre>\' . print_r($sourceProperties, 1) . \'</pre>\';
    //$allowedExtensions = $modx->getOption(\'allowedFileTypes\', $sourceProperties, \'\');
    //$allowedExtensions = empty($allowedExtensions) ? \'jpg,jpeg,png,gif\' : $allowedExtensions;
    //$maxFilesizeMb = $modx->getOption(\'maxFilesizeMb\', $sourceProperties, \'8\');
    //$maxFiles = $modx->getOption(\'maxFiles\', $sourceProperties, \'0\');
    //$thumbX = $modx->getOption(\'thumbX\', $sourceProperties, \'100\');
    //$thumbY = $modx->getOption(\'thumbY\', $sourceProperties, \'100\');
    $resizeConfigs = $modx->getOption(\'resizeConfigs\', $sourceProperties, \'\');
    $resizeConfigs = $modx->fromJson($resizeConfigs);
    $thumbscontainer = $modx->getOption(\'thumbscontainer\', $sourceProperties, \'thumbs/\');
    $imageExtensions = $modx->getOption(\'imageExtensions\', $sourceProperties, \'jpg,jpeg,png,gif,JPG\');
    $imageExtensions = explode(\',\', $imageExtensions);
    //$uniqueFilenames = $modx->getOption(\'uniqueFilenames\', $sourceProperties, false);
    //$onImageUpload = $modx->getOption(\'onImageUpload\', $sourceProperties, \'\');
    //$onImageRemove = $modx->getOption(\'onImageRemove\', $sourceProperties, \'\');
    $cleanalias = $modx->getOption(\'cleanFilename\', $sourceProperties, false);

}

if (is_array($resizeConfigs) && count($resizeConfigs) > 0) {
    foreach ($resizeConfigs as $rc) {
        if (isset($rc[\'alias\'])) {
            $filePath = $basePath . $directory;
            $filePath = str_replace(\'//\',\'/\',$filePath);
            if ($rc[\'alias\'] == \'origin\') {
                $thumbPath = $filePath;
            } else {
                $thumbPath = $filePath . $rc[\'alias\'] . \'/\';
                $permissions = octdec(\'0\' . (int)($modx->getOption(\'new_folder_permissions\', null, \'755\', true)));
                if (!@mkdir($thumbPath, $permissions, true)) {
                    $modx->log(MODX_LOG_LEVEL_ERROR, sprintf(\'[migxResourceMediaPath]: could not create directory %s).\', $thumbPath));
                } else {
                    chmod($thumbPath, $permissions);
                }

            }


            $filename = $filePath . $name;
            $thumbname = $thumbPath . $name;
            $ext = substr(strrchr($name, \'.\'), 1);
            if (in_array($ext, $imageExtensions)) {
                $sizes = getimagesize($filename);
                echo $sizes[0]; 
                //$format = substr($sizes[\'mime\'], 6);
                if ($sizes[0] > $rc[\'w\'] || $sizes[1] > $rc[\'h\']) {
                    if ($sizes[0] < $rc[\'w\']) {
                        $rc[\'w\'] = $sizes[0];
                    }
                    if ($sizes[1] < $rc[\'h\']) {
                        $rc[\'h\'] = $sizes[1];
                    }
                    $type = $sizes[0] > $sizes[1] ? \'landscape\' : \'portrait\';
                    if (isset($rc[\'far\']) && $rc[\'far\'] == \'1\' && isset($rc[\'w\']) && isset($rc[\'h\'])) {
                        if ($type = \'landscape\') {
                            unset($rc[\'h\']);
                        }else {
                            unset($rc[\'w\']);
                        }
                    }

                    $options = \'\';
                    foreach ($rc as $k => $v) {
                        if ($k != \'alias\') {
                            $options .= \'&\' . $k . \'=\' . $v;
                        }
                    }
                    $resized = $modx->runSnippet(\'phpthumbof\', array(\'input\' => $filePath . $name, \'options\' => $options));
                    rename(MODX_BASE_PATH . substr($resized, 1), $thumbname);
                }
            }


        }
    }
}',
      'locked' => '0',
      'properties' => 'a:0:{}',
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => '',
    ),
    30 => 
    array (
      'id' => '30',
      'source' => '0',
      'property_preprocess' => '0',
      'name' => 'imageSlimCacheManager',
      'description' => 'Handles remote images cache cleaning when clearing the site cache.',
      'editor_type' => '0',
      'category' => '64',
      'cache_type' => '0',
      'plugincode' => '/**
 * imageSlim
 * Copyright 2013 Jason Grant
 *
 * Documentation, bug reports, etc.
 * https://github.com/oo12/imageSlim
 *
 * imageSlim is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License as published by the Free
 * Software Foundation; either version 2 of the License, or (at your option) any
 * later version.
 *
 * imageSlim is distributed in the hope that it will be useful, but WITHOUT ANY
 * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
 * A PARTICULAR PURPOSE. See the GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with
 * imageSlim; if not, write to the Free Software Foundation, Inc., 59 Temple
 * Place, Suite 330, Boston, MA 02111-1307 USA
 *
 * @package imageslim
 */
/**
 * Handles cache management for imageSlim
 *
 * @var modX $modx
 *
 * @package imageslim
 */

if ($modx->event->name !== \'OnSiteRefresh\') {
	return;
}

$cachePath = MODX_ASSETS_PATH . \'components/imageslim/cache/\';

if (!is_writable($cachePath)) {  // check that the cache directory is writable
	if (!$modx->cacheManager->writeTree($cachePath)) {
		$modx->log(modX::LOG_LEVEL_ERROR, \'[imageSlim] Cache path not writable: \' . $cachePath);
		return;
	}
}

$cache_maxage = $modx->getOption(\'phpthumb_cache_maxage\', NULL, 30) * 86400;
$cache_maxsize = $modx->getOption(\'phpthumb_cache_maxsize\', NULL, 100) * 1048576;
$cache_maxfiles = (int) $modx->getOption(\'phpthumb_cache_maxfiles\', NULL, 10000);
$modx->log(modX::LOG_LEVEL_INFO, \'imageSlimCacheManager: Cleaning imageSlim remote images cache...\');
$modx->log(modX::LOG_LEVEL_INFO, ":: Max Age: $cache_maxage seconds || Max Size: $cache_maxsize bytes || Max Files: $cache_maxfiles");

if (!($cache_maxage || $cache_maxsize || $cache_maxfiles)) {
	return;
}

$DeletedKeys = array();
$AllFilesInCacheDirectory = array();
$dirname = rtrim(realpath($cachePath), \'/\\\\\');
if ($dirhandle = @opendir($dirname)) {
	while (($file = readdir($dirhandle)) !== FALSE) {
		$fullfilename = $dirname . DIRECTORY_SEPARATOR . $file;
		if (is_file($fullfilename) && preg_match(\'/(jpe?g|png|gif)$/\', $file)) {
			$AllFilesInCacheDirectory[] = $fullfilename;
		}
	}
	closedir($dirhandle);
}
$totalimages = count($AllFilesInCacheDirectory);
$modx->log(modX::LOG_LEVEL_INFO, ":: $totalimages image" . ($totalimages !== 1 ? \'s\':\'\') . \' in the cache\');

if (empty($AllFilesInCacheDirectory)) {
	return;
}

$CacheDirOldFilesAge  = array();
$CacheDirOldFilesSize = array();
foreach ($AllFilesInCacheDirectory as $fullfilename) {
	$CacheDirOldFilesAge[$fullfilename] = @fileatime($fullfilename);
	if ($CacheDirOldFilesAge[$fullfilename] == 0) {
		$CacheDirOldFilesAge[$fullfilename] = @filemtime($fullfilename);
	}
	$CacheDirOldFilesSize[$fullfilename] = @filesize($fullfilename);
}
$DeletedKeys[\'zerobyte\'] = array();
foreach ($CacheDirOldFilesSize as $fullfilename => $filesize) {
	// purge all zero-size files more than an hour old (to prevent trying to delete just-created and/or in-use files)
	$cutofftime = time() - 3600;
	if (($filesize == 0) && ($CacheDirOldFilesAge[$fullfilename] < $cutofftime)) {
		if (@unlink($fullfilename)) {
			$DeletedKeys[\'zerobyte\'][] = $fullfilename;
			unset($CacheDirOldFilesSize[$fullfilename]);
			unset($CacheDirOldFilesAge[$fullfilename]);
		}
	}
}
$modx->log(modX::LOG_LEVEL_INFO, \':: Purged \' . count($DeletedKeys[\'zerobyte\']) . \' zero-byte images\');
asort($CacheDirOldFilesAge);

if ($cache_maxfiles) {
	$TotalCachedFiles = count($CacheDirOldFilesAge);
	$DeletedKeys[\'maxfiles\'] = array();
	foreach ($CacheDirOldFilesAge as $fullfilename => $filedate) {
		if ($TotalCachedFiles > $cache_maxfiles) {
			if (@unlink($fullfilename)) {
				--$TotalCachedFiles;
				$DeletedKeys[\'maxfiles\'][] = $fullfilename;
			}
		} else {  // there are few enough files to keep the rest
			break;
		}
	}
	$modx->log(modX::LOG_LEVEL_INFO, \':: Purged \' . count($DeletedKeys[\'maxfiles\']) . " images based on (cache_maxfiles=$cache_maxfiles)");
	foreach ($DeletedKeys[\'maxfiles\'] as $fullfilename) {
		unset($CacheDirOldFilesAge[$fullfilename]);
		unset($CacheDirOldFilesSize[$fullfilename]);
	}
}

if ($cache_maxage) {
	$mindate = time() - $cache_maxage;
	$DeletedKeys[\'maxage\'] = array();
	foreach ($CacheDirOldFilesAge as $fullfilename => $filedate) {
		if ($filedate) {
			if ($filedate < $mindate) {
				if (@unlink($fullfilename)) {
					$DeletedKeys[\'maxage\'][] = $fullfilename;
				}
			} else {  // the rest of the files are new enough to keep
				break;
			}
		}
	}
	$modx->log(modX::LOG_LEVEL_INFO, \':: Purged \' . count($DeletedKeys[\'maxage\']) . \' images based on (cache_maxage=\'. $cache_maxage / 86400 .\' days)\');
	foreach ($DeletedKeys[\'maxage\'] as $fullfilename) {
		unset($CacheDirOldFilesAge[$fullfilename]);
		unset($CacheDirOldFilesSize[$fullfilename]);
	}
}

if ($cache_maxsize) {
	$TotalCachedFileSize = array_sum($CacheDirOldFilesSize);
	$DeletedKeys[\'maxsize\'] = array();
	foreach ($CacheDirOldFilesAge as $fullfilename => $filedate) {
		if ($TotalCachedFileSize > $cache_maxsize) {
			if (@unlink($fullfilename)) {
				$TotalCachedFileSize -= $CacheDirOldFilesSize[$fullfilename];
				$DeletedKeys[\'maxsize\'][] = $fullfilename;
			}
		} else {  // the total filesizes are small enough to keep the rest of the files
			break;
		}
	}
	$modx->log(modX::LOG_LEVEL_INFO, \':: Purged \' . count($DeletedKeys[\'maxsize\']) . \' images based on (cache_maxsize=\' . $cache_maxsize / 1048576 . \' MB)\');
	foreach ($DeletedKeys[\'maxsize\'] as $fullfilename) {
		unset($CacheDirOldFilesAge[$fullfilename]);
		unset($CacheDirOldFilesSize[$fullfilename]);
	}
}

$totalpurged = 0;
foreach ($DeletedKeys as $key => $value) {
	$totalpurged += count($value);
}
$modx->log(modX::LOG_LEVEL_INFO, ":: Purged $totalpurged images out of $totalimages");',
      'locked' => '0',
      'properties' => NULL,
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => '',
    ),
    28 => 
    array (
      'id' => '28',
      'source' => '0',
      'property_preprocess' => '0',
      'name' => 'CacheMaster',
      'description' => 'Clears the cache for a single resource when minor changes are made',
      'editor_type' => '0',
      'category' => '62',
      'cache_type' => '0',
      'plugincode' => '/**
* CacheMaster plugin for CacheMaster extra
*
* Copyright 2012-2022 Bob Ray <https://bobsguides.com>
 * Created on 12-09-2012
 *
 * CacheMaster is free software; you can redistribute it and/or modify it under the
 * terms of the GNU General Public License as published by the Free Software
 * Foundation; either version 2 of the License, or (at your option) any later
 * version.
 *
 * CacheMaster is distributed in the hope that it will be useful, but WITHOUT ANY
 * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
 * A PARTICULAR PURPOSE. See the GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with
 * CacheMaster; if not, write to the Free Software Foundation, Inc., 59 Temple
 * Place, Suite 330, Boston, MA 02111-1307 USA
 *
 * @package cachemaster
 */

/**
 * Description
 * -----------
 * Clears the cache for a single resource when minor changes are made
 *
 * Variables
 * ---------
 * @var $modx modX
 * @var $scriptProperties array
 *
 * @package cachemaster
 **/

/* Properties

 * @property &doChunks combo-boolean -- Execute for Chunks; Default: No.
 * @property &doPlugins combo-boolean -- Execute for Plugins; Default: No.
 * @property &doResources combo-boolean -- Execute for Resources; Default: Yes.
 * @property &doSnippets combo-boolean -- Execute for Snippets; Default: No.
 * @property &doTVs combo-boolean -- Execute for Template Variables; Default: No.
 * @property &doTemplates combo-boolean -- Execute for Templates; Default: No.
 * @property &uncheckEmptyCache combo-boolean -- If set to Yes, unchecks the Empty Cache checkbox when the Create/Edit Resource panel is loaded; Default: Yes.

 */


/**
    @var $modx modX
    @var $resource modResource
    @var $scriptProperties array
    @var $mode int
*/

$doDebug = false;

if (!function_exists("my_debug")) {
    function my_debug($message, $clear = false)
    {
        global $modx;
        $prefix = $modx->getVersionData()[\'version\'] >= 3
                ? \'MODX\\Revolution\\\\\'
                : \'\';
        $content = \'\';
        $chunk = $modx->getObject($prefix . \'modChunk\', array(\'name\' => \'Debug\'));
        if (!$chunk) {
            $chunk = $modx->newObject($prefix . \'modChunk\', array(\'name\' => \'Debug\'));
            $chunk->setContent(\'\');
            $chunk->save();
            $chunk = $modx->getObject($prefix . \'modChunk\', array(\'name\' => \'Debug\'));
        } else {
            if ($clear) {
                $content = \'\';
            } else {
                $content = $chunk->getContent();
            }
        }
        $content .= $message . "\\n";
        $chunk->setContent($content);
        $chunk->save();
    }
}


/* don\'t execute for new documents */
if ($mode == modSystemEvent::MODE_NEW) {
    return;
}

$sp =& $scriptProperties;
$event = $modx->event->name;
$doResources = (bool) $modx->getOption(\'doResources\', $sp, false);
$doPlugins = (bool) $modx->getOption(\'doPlugins\', $sp, false);
$doSnippets = (bool) $modx->getOption(\'doSnippets\', $sp, false);
$doChunks = (bool) $modx->getOption(\'doChunks\', $sp, false);
$doTemplates = (bool) $modx->getOption(\'doTemplates\', $sp, false);
$doTVs = (bool) $modx->getOption(\'doTVs\', $sp, false);
$clearCheckbox = (bool) $modx->getOption(\'uncheckEmptyCache\', $sp, false);
$cm = $modx->getCacheManager();

/**  @var $resource modResource */

/* Bail out if we\'re not doing this object */
switch($event) {
    case \'OnBeforeDocFormSave\':
        /* No longer using this event */
        return;

    case \'OnDocFormPrerender\':

    case \'OnDocFormSave\':
        if (!$doResources) {
            return;
        }
        break;
    case \'OnSnipFormPrerender\':
    case \'OnBeforeSnipFormSave\':
        if (!$doSnippets) {
            return;
        }
        break;
    case \'OnPluginFormPrerender\':
    case \'OnBeforePluginFormSave\':
        if (!$doPlugins) {
            return;
        }
        break;
    case \'OnChunkFormPrerender\':
    case \'OnBeforeChunkFormSave\':
        if (!$doChunks) {
            return;
        }
        break;
    case \'OnTempFormPrerender\':
    case \'OnBeforeTempFormSave\':
        if (!$doTemplates) {
            return;
        }
        break;
    case \'OnTVFormPrerender\':
    case \'OnBeforeTVFormSave\':
        if (!$doTVs) {
            return;
        }
        break;
}
 if ($doDebug) {
     my_debug(\'CacheMaster Executing\');
 }
/* Handle prerender events */

/* Clear Empty Cache checkbox if UncheckEmptyCache is set */
if (strstr($event, \'Prerender\')) {
    if ($doDebug) {
        my_debug(\'In Prerender\');
    }
    $panel = array(
        \'OnDocFormPrerender\' => \'modx-resource-syncsite\',
        \'OnSnipFormPrerender\' => \'modx-snippet-clear-cache\',
        \'OnPluginFormPrerender\' => \'modx-plugin-clear-cache\',
        \'OnChunkFormPrerender\' => \'modx-chunk-clear-cache\',
        \'OnTempFormPrerender\' => \'modx-template-clear-cache\',
        \'OnTVFormPrerender\' => \'modx-tv-clear-cache\',
    );
    if ($clearCheckbox) {
        $modx->regClientStartupHTMLBlock(\'<script type="text/javascript">
    Ext.onReady(function () {
        Ext.getCmp("\' . $panel[$event] . \'").setValue(false);
    });
</script>\');

        // Clear Checkbox for Articles
    if ($event == \'OnDocFormPrerender\' && $resource->get(\'class_key\') == \'Article\')
        $modx->regClientStartupHTMLBlock(\'<script type="text/javascript">
            Ext.onReady(function () {
                Ext.getCmp("\' . \'modx-resource-clearcache\' . \'").setValue(false);
            });
        </script>\');
    }
    return;
}

/* handle formSave events */

/* Don\'t execute if Empty Cache is checked */
$syncsite = (bool) $modx->getOption(\'syncsite\', $_POST, false);
$emptyCache = (bool)$modx->getOption(\'clearCache\', $_POST, false);

$clearCache = ($syncsite || $emptyCache);

if ($doDebug) {
   my_debug(\'In FormSave\');
}


if ($clearCache) {
    /* return and let MODX clear the cache if box is checked */
    if ($doDebug) {
        my_debug("Empty cache is checked in " . $event);
    }
    return;
} else {
    if ($doDebug) {
        my_debug("Empty cache is NOT checked in " . $event);
    }
}

$path = null;

/* Empty Cache is unchecked; clear the individual object cache */
switch($event) {

    case \'OnDocFormSave\':

        if ($doDebug) {
            my_debug("In OnDocFormSave");
        }


            /* get resource context and id */
            $ctx = $resource->get(\'context_key\');
            $docId = $resource->get(\'id\');


            /* set path to default cache file */
            $path = MODX_CORE_PATH . \'cache/resource/\' . $ctx . \'/resources/\' . $docId . \'.cache.php\';

            $ck = $resource->getCacheKey();
            $mgrCtx = $modx->context->get(\'key\');
            $cKey = str_replace($mgrCtx, $ctx, $ck);

            $cm->delete($cKey, array(
                xPDO::OPT_CACHE_KEY => $modx->getOption(\'cache_resource_key\', null, \'resource\'),
                xPDO::OPT_CACHE_HANDLER => $modx->getOption(\'cache_resource_handler\', null,
                    $modx->getOption(xPDO::OPT_CACHE_HANDLER)),
                xPDO::OPT_CACHE_FORMAT => (integer)$modx->getOption(\'cache_resource_format\', null,
                    $modx->getOption(xPDO::OPT_CACHE_FORMAT, null, xPDOCacheManager::CACHE_PHP))
                )
            );
        /* Update the auto_publish cache */
            $providers = array(
                \'auto_publish\' => array(\'contexts\' => $ctx),
            );
            $cm->refresh($providers);

        break;

    case \'OnBeforeSnipFormSave\':
        /** @var $snippet modSnippet */
        $docId = $snippet->get(\'id\');

        /* set path to default cache file */
        $path = MODX_CORE_PATH . \'cache/scripts/elements/snippets/\' . $docId . \'.cache.php\';

        $cKey = $snippet->getScriptCacheKey();
        if ($doDebug) {
            my_debug(\'Cache Key: \' . $cKey);
        }
        $cm->delete($cKey, array(
            xPDO::OPT_CACHE_KEY => $modx->getOption(\'cache_scripts_key\', null, \'scripts\'),
            xPDO::OPT_CACHE_HANDLER => $modx->getOption(\'cache_scripts_handler\', null,
                $modx->getOption(xPDO::OPT_CACHE_HANDLER)),
            xPDO::OPT_CACHE_FORMAT => (integer)$modx->getOption(\'cache_scripts_format\', null,
            $modx->getOption(xPDO::OPT_CACHE_FORMAT, null, xPDOCacheManager::CACHE_PHP))
        ));
        break;

    case \'OnBeforePluginFormSave\':
        /** @var $plugin modPlugin */
        $docId = $plugin->get(\'id\');

        /* set path to default cache file */
        $path = MODX_CORE_PATH . \'cache/scripts/elements/plugins/\' . $docId . \'.cache.php\';

        $cKey = $plugin->getScriptCacheKey();
        /*$mgrCtx = $modx->context->get(\'key\');
        $cKey = str_replace($mgrCtx, $ctx, $ck);*/
        if ($doDebug) {
            my_debug(\'Cache Key: \' . $cKey);
        }
        $cm->delete($cKey, array(
            xPDO::OPT_CACHE_KEY=>$modx->getOption(\'cache_scripts_key\', null, \'scripts\'),
            xPDO::OPT_CACHE_HANDLER => $modx->getOption(\'cache_scripts_handler\', null,
                $modx->getOption(xPDO::OPT_CACHE_HANDLER)),
            xPDO::OPT_CACHE_FORMAT=>(integer)$modx->getOption(\'cache_scripts_format\', null,
            $modx->getOption(xPDO::OPT_CACHE_FORMAT, null, xPDOCacheManager::CACHE_PHP))
        ));

        break;
}

/* clear the cache the old-fashioned way, just in case */
if ($path && file_exists($path)) {
    unlink($path);
}


return \'\';',
      'locked' => '0',
      'properties' => 'a:7:{s:8:"doChunks";a:7:{s:4:"name";s:8:"doChunks";s:4:"desc";s:17:"cm_do_chunks_desc";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:22:"cachemaster:properties";s:4:"area";s:11:"CacheMaster";}s:9:"doPlugins";a:7:{s:4:"name";s:9:"doPlugins";s:4:"desc";s:18:"cm_do_plugins_desc";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:0;s:7:"lexicon";s:22:"cachemaster:properties";s:4:"area";s:11:"CacheMaster";}s:11:"doResources";a:7:{s:4:"name";s:11:"doResources";s:4:"desc";s:20:"cm_do_resources_desc";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:1;s:7:"lexicon";s:22:"cachemaster:properties";s:4:"area";s:11:"CacheMaster";}s:10:"doSnippets";a:7:{s:4:"name";s:10:"doSnippets";s:4:"desc";s:19:"cm_do_snippets_desc";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:22:"cachemaster:properties";s:4:"area";s:11:"CacheMaster";}s:5:"doTVs";a:7:{s:4:"name";s:5:"doTVs";s:4:"desc";s:14:"cm_do_tvs_desc";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:22:"cachemaster:properties";s:4:"area";s:11:"CacheMaster";}s:11:"doTemplates";a:7:{s:4:"name";s:11:"doTemplates";s:4:"desc";s:20:"cm_do_templates_desc";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:22:"cachemaster:properties";s:4:"area";s:11:"CacheMaster";}s:17:"uncheckEmptyCache";a:7:{s:4:"name";s:17:"uncheckEmptyCache";s:4:"desc";s:27:"cm_uncheck_empty_cache_desc";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:1;s:7:"lexicon";s:22:"cachemaster:properties";s:4:"area";s:11:"CacheMaster";}}',
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => '',
    ),
    29 => 
    array (
      'id' => '29',
      'source' => '0',
      'property_preprocess' => '0',
      'name' => 'ResizeImageOnUpload',
      'description' => 'Plugin for auto edit pictures with PhpThumbOf snippet on download.',
      'editor_type' => '0',
      'category' => '63',
      'cache_type' => '0',
      'plugincode' => '/**
 * ResizeImageOnUpload Plugin updated by Setest
 
 * Author: Stepan Prishepenko (Setest) <itman116@gmail.com> (01.04.2013)

 * Version: 1.1.2 (08.04.2013) fix errors
 * Version: 1.1.1 (05.04.2013) fix errors
 * Version: 1.1.0 (03.04.2013) fix some errors, add new parameter "exclude_dirs_suffix"
 * Version: 1.0.0 (01.04.2013) It`s must correctly work in ModX {REVO} 2.2 - 2.2.6
 
 * Events: OnFileManagerUpload
 * Required: PhpThumbOf snippet for resizing images

 * Based on: Vasiliy Naumkin (04.08.2012) <bezumkin@yandex.ru>  http://bezumkin.ru/blog/2012/08/04/resizeonupload/
 * Edited by Aleksey Naumov (08.10.2012)  http://www.createit.ru/blog/modx/2012/plugin-resizeimageonupload-modx-revo/
 * Good idea by Mordynsky Nicholay (create storage thumbs folder) (28.03.2013)

 
 
	Плагин обладает следующими параметрами и их возможностями:
	create_thumbs - при ДА создает привью изображений
	thumbnail_dir - если указано, то создает директорию, родителем которой является base_path источника, в которой хранятся превью изображений.
					Точки из названия папки удаляются.
	thumb_key	  - Ключ добавляющийся в имя файла предпросмотра.
	default_thumb_path - Если параметр указан, то игнорируется параметр "thumbnail_dir" и все файлы превью загружаются в эту директорию.

	default_src_param - параметры исходного изображения по умолчанию, задаются в соответствии с правилами PhpThumbOf
						пример: \'w\'=800,\'h\'=600,\'zc\'=0,\'q\'=80,\'fltr\'=\'wmi|/assets/img/watermark.png|BR|100|0|0\'
						можно и так: w=800,h=600,zc=0,q=80,fltr=wmi|/assets/img/watermark.png|BR|100|0|0
	default_thumb_param - параметры thumbs изображения по-умолчанию

	log - при == true создается лог файл с именем плагина

	Исключения - условия при которых плагин прерывает работу:
	exclude_dirs - путь к директориям разделенне запятыми, в которых плагин работать не будет
	exclude_dirs_children - при ДА распростраянет действие исключения родителя на дочерние директории
	exclude_part_of_name - если имя загружаемого файла содержит текст из данного параметра, то плагин прекращает работу
	exclude_sources - источники изображения при использовании которых плагин прекращает работу,
					  принимает имя источника или его id перечисленные через запятую.
					  Будьте внимательны при вводе имени источника, следите за регистром букв.
					  пример: Images, 5, hohoho, tetki

 */
 
 
// проверяем нужное событие
if ($modx->event->name != \'OnFileManagerUpload\') {return;}

$modx->lexicon->load(\'resizeimageonupload:default\');

$log = false;//$modx->getOption(\'log\', $scriptProperties,false);
////////////////////////////////--=LOG=--///////////////////////////////////
if ($log){
	$logFileName = $modx->event->activePlugin;
	$modx->setLogLevel(modX::LOG_LEVEL_INFO);
		$date = date(\'Y-m-d____H-i-s\');  // использовать в выводе даты : - нельзя, иначе не создается лог в файл
		$modx->setLogTarget(array(
		   \'target\' => \'FILE\',
		   \'options\' => array(\'filename\' => "{$logFileName}_$date.log")
		));
	$start_time_global = microtime(true); //общее время выполнения скрипта
}
////////////////////////////////--=LOG=--///////////////////////////////////


// подключаем phpthumb
require_once MODX_CORE_PATH.\'model/phpthumb/phpthumb.class.php\';

// сдесь вы можете указать особые директории в которых будут особые параметры
// загрузки изображений
// $config = array(
 // \'assets/upload/folder1/\' => array(
   // \'src\' => array(\'w\' => 800,\'h\' => 600,\'zc\' => 1,\'bg\' => \'#fff\',\'q\' => 90),
 // ),
 // \'assets/upload/folder2/\' => array(
   // \'src\' => array(\'w\' => 400,\'h\' => 300,\'zc\' => 1,\'bg\' => \'#fff\',\'q\' => 90),
   // \'thumb\' =>array(\'w\' => 200,\'h\' => 150,\'zc\' => 1,\'bg\' => \'#fff\',\'q\' => 70),
 // ),
// );


//$config_default_src_param = $modx->getOption(\'default_src_param\', $scriptProperties, "\'w\'=1280,\'h\'=1024,\'zc\'=0,\'q\'=80");
$config_default_src_param = "w=800,h=600,zc=0,q=75";
$config_default_thumb_param = $modx->getOption(\'default_thumb_param\', $scriptProperties, "\'w\'=200,\'h\'=150,\'zc\'=1,\'bg\'=\'#fff\',\'q\'=70");

// $config_default_src_param = "w=600,zc=0,q=80,fltr=wmi|/assets/templates/new/img/others/logo_watermark.png|BR|100|0|0";
// $config_default_thumb_param = "\'w\'=200,\'h\'=150,\'zc\'=1,\'bg\'=\'#fff\',\'q\'=70";


$create_thumbs = 0;// $modx->getOption(\'create_thumbs\', $scriptProperties);
$thumbnail_dir = $modx->getOption(\'thumbnail_dir\', $scriptProperties);
$thumbnail_dir = str_replace(\'//\', \'/\', $thumbnail_dir);
$thumbnail_dir = str_replace(array("..","."), "", $thumbnail_dir);
$default_thumb_path = $modx->getOption(\'default_thumb_path\',$scriptProperties,null); // assets/images/thumbs
$thumb_key = $modx->getOption(\'thumb_key\',$scriptProperties,\'\'); // this parameter add in the filename of thumbnail

//$exclude_dirs = $modx->getOption(\'exclude_dirs\', $scriptProperties, null);	// папки исключения
$exclude_dirs = \'images/sliders/\';
$exclude_dirs_suffix = $modx->getOption(\'exclude_dirs_suffix\', $scriptProperties, "{ExChild}");	// суффикс папки исключения, при наличии, которого дочерние папки исключаются
$exclude_dirs_children = $modx->getOption(\'exclude_dirs_children\', $scriptProperties, null);	// исключать ли дочерние директории?

$exclude_part_of_name = $modx->getOption(\'exclude_part_of_name\', $scriptProperties, null);	// исключаем при наличии в имени файла этого текста
$exclude_sources = $modx->getOption(\'exclude_sources\', $scriptProperties, null);	// исключаем по источникам.  Можно использовать id и имя источника, будьте внимательны при вводе имени источника, следите за регистром букв.

$exclude_extensions = $modx->getOption(\'exclude_extensions\', $scriptProperties, null);	// исключаем файлы с раширением ... содержащиеся в exclude_extensions, перечисленные через запятую

// перестрахуемся и удалим лишние кавычки
$config_default_src_param = str_replace(array("\'"," "),"",$config_default_src_param);
$config_default_thumb_param = str_replace(array("\'"," "),"",$config_default_thumb_param);

// \'w\'=580,\'h\'=324,\'zc\'=0,\'q\'=80,\'fltr\'=\'wmi|/assets/templates/new/img/others/logo_watermark.png|BR|100|0|0\'

// функция разбивает строку вида "\'param1\'=\'value1\',..." и возвращает массив

if (!function_exists(\'getconfigparam\')) {
	// function getconfigparam($config_default_param, $type){
	function getconfigparam($config_default_src_param){
		foreach (explode(",",$config_default_src_param) as $parametr) {
			$param_arr=explode("=",$parametr);
				// $param[$type][$param_arr[0]]=$param_arr[1];
				$param[$param_arr[0]]=$param_arr[1];
		}
		return $param;
	}
}

// получаем конфигурацию по умолчанию
$config_default = array(
	"src"	=>	getconfigparam($config_default_src_param),
	"thumb" =>	getconfigparam($config_default_thumb_param)
);

// параметры загружаемого файла
$file = $modx->event->params[\'files\'][\'file\'];
$cur_dir = $modx->event->params[\'directory\'];

// получаем media source
$ms = $modx->event->params[\'source\'];
// расскоментировав след строку вы можете взглянуть на начинку источника
// if ($log) $modx->log(modX::LOG_LEVEL_INFO, print_r($ms->toArray(),true));

if (!empty($exclude_sources)){
	$exclude_sources = str_replace(\' \', \'\', $exclude_sources);
	$exclude_sources=explode(",",$exclude_sources);
	foreach ($exclude_sources as $sources) {
		// if ($log) $modx->log(modX::LOG_LEVEL_INFO, is_numeric($sources));
		if ($log) $modx->log(modX::LOG_LEVEL_INFO, "Sources list: $sources - ".$ms->name);
		if (is_numeric($sources)) {
			if ($ms->id==(int)$sources) return;
		}
		else {
			if ($ms->name==$sources) return;
		}
	}	
}


if($ms == null){
	// return $modx->error->failure("Ошибка, не удается получить данные об источнике файлов");
	// тут нужно проверить версию modx, если она младше 2.2.4 то
	// используем 
	// foreach ($files as $file) {
		// $ext = @pathinfo($file[\'name\'],PATHINFO_EXTENSION);
		// rename($cur_dir->getPath().$file[\'name\'], $directory->getPath().UrlTranslit($file[\'name\']));
	// }
	// тк в старых версиях вызов события загрузки шел один раз, проверить!
	$cur_dir=$directory->getPath();

}
else {
	// настройки media source
	$msProperties = $ms->get(\'properties\');
	//$cur_dir = $msProperties[\'basePath\'][\'value\'] = MODX_BASE_PATH;
	//$modx->log(modX::LOG_LEVEL_INFO, "my: " . print_r($msProperties,true));
//$modx->log(modX::LOG_LEVEL_INFO, "my: " . print_r($cur_dir,true));
	//$cur_dir = $msProperties[\'basePath\'][\'value\'].$cur_dir;
	// на всякий случай проверяем наличие // и заменяем на /
	//$cur_dir = str_replace(\'//\', \'/\', $cur_dir);
	//if ($log) $modx->log(modX::LOG_LEVEL_INFO, "\\$cur_dir: $cur_dir");
	
	// смотрим, что при загрузке не возникло ошибок
	if ($file[\'error\'] != 0) {
		return $modx->error->failure($modx->lexicon(\'rionup_error_download\'));
	}
}
// проверяем на исключения директории
// if ($exclude_dirs and $exclude_dirs=str_replace(\' \', \'\', $exclude_dirs) and (in_array($cur_dir,explode(",",$exclude_dirs)))){
if ($exclude_dirs and ($exclude_dirs=explode(",",$exclude_dirs))){
	if ($exclude_dirs_children) {
	
		foreach ($exclude_dirs as $path) {
			// if ($log) $modx->log(modX::LOG_LEVEL_INFO, "EXCLUDE DIRS CONDITIONS: $cur_dir == $path");
			// if ((strpos($path, $exclude_dirs_suffix) !== false) && (strpos($cur_dir, substr($path,0,-1*(strlen($exclude_dirs_suffix)))) !== false)) {
				// если содержит в строке &ExChild
				// if ($log) $modx->log(modX::LOG_LEVEL_INFO, "except {$exclude_dirs_suffix} in: {$path}, return;");
			// }
			// else {
				
				// if (strpos($cur_dir, str_replace($exclude_dirs_suffix, \'\', $path)) !== false) //return;
				if (strpos($cur_dir, $path) !== false) //return;
				{
					// return $modx->error->failure("children");
					if ($log) $modx->log(modX::LOG_LEVEL_INFO, "except children, return;");
					return;
				}
			// }
		}
	}
	else {
		foreach ($exclude_dirs as $path) {
			if ($log) $modx->log(modX::LOG_LEVEL_INFO, "EXCLUDE DIRS CONDITIONS: curdir ($cur_dir), exclude dir ($path)");
			if ((strpos($path, $exclude_dirs_suffix) !== false) && (strpos($cur_dir, substr($path,0,-1*(strlen($exclude_dirs_suffix)))) !== false)) {
				// если содержит в строке &ExChild
				if ($log) $modx->log(modX::LOG_LEVEL_INFO, "except {$exclude_dirs_suffix} in: {$path}, return;");
				return;
			}
			else {
				if ($cur_dir==str_replace($exclude_dirs_suffix, \'\', $path)) {
					if ($log) $modx->log(modX::LOG_LEVEL_INFO, "except dir, return;");
					return;
				}
			}
		// return $modx->error->failure("Записать в данную директорию нельзя она находится в исключениях плагина");
		// return $modx->error->failure("parent");
		}
	}
}

// $name = $file[\'name\'];
$name = urldecode($file[\'name\']);
// проверяем на исключения в имени файла
if (!empty($exclude_part_of_name) and (strpos($name, $exclude_part_of_name) !== false)){
	if ($log) $modx->log(modX::LOG_LEVEL_INFO, "except part of name, return;");
	return;
}

$extensions = explode(\',\', $modx->getOption(\'upload_images\'));
if ($log) $modx->log(modX::LOG_LEVEL_INFO, "Allowed extensions: ".implode(",", $extensions));
// проверям, что наша категория задана в настройках плагина
if (!empty($config) && array_key_exists($cur_dir, $config)) {
	$config = $config[$cur_dir];
}
else {
	$config=$config_default;
}

// if ($log) $modx->log(modX::LOG_LEVEL_INFO, print_r($config));

// путь к файлу, имя файла, расширение
$filename = MODX_BASE_PATH.$cur_dir.$name;
if ($log) $modx->log(modX::LOG_LEVEL_INFO, "SourceFilename: {$filename}");
$def_fn = pathinfo($name, PATHINFO_FILENAME);
$ext = pathinfo($name, PATHINFO_EXTENSION);
// проверяем, что расширение файла задано в настройках MODX, как изображение
if (in_array($ext, $extensions)) {

	// проверяем исключение расширение файла exclude_extensions
	if ($exclude_extensions and $exclude_extensions=str_replace(\' \', \'\', $exclude_extensions) and ($exclude_extensions=explode(",",$exclude_extensions)) and (in_array($ext, $exclude_extensions))){
		// if (in_array($ext, $exclude_extensions)) {
		if ($log) $modx->log(modX::LOG_LEVEL_INFO, "except extension of file ({$ext}), return;");
		return;	
	}
if ($log) $modx->log(modX::LOG_LEVEL_INFO, \'my: \' . print_r($config,true));
	// бежим по всем полям массива с конфигом
	foreach($config as $imgKey =>$imgConfig){
		$options = \'\';
		if($imgKey == \'src\'){
			// для ключа src имя файла совпадает с исходным
			$imgName = $filename;
		}
		elseif ($imgKey == \'thumb\'){// && $create_thumbs){
			// формируем имя файла
			continue;
			//$imgName = MODX_BASE_PATH.$cur_dir.$def_fn.\'.\'.$ext.\'.\'.$imgKey.\'.\'.$ext;
			if ($log) $modx->log(modX::LOG_LEVEL_INFO, "\\$cur_dir: $cur_dir");
			if (!empty($thumbnail_dir) or !empty($default_thumb_path)) {
				$thumbnail_dir = MODX_BASE_PATH.$cur_dir.$thumbnail_dir."/";
				if (!empty($default_thumb_path)) {
					// если указана поапка по-умолчанию для превьюшек
					if ($log) $modx->log(modX::LOG_LEVEL_INFO, "Default thumbnail path exist");
					if (substr($default_thumb_path, -1, 1)!="/") $default_thumb_path.="/";
					$thumbnail_dir = MODX_BASE_PATH.$default_thumb_path;	
				}
				if ($log) $modx->log(modX::LOG_LEVEL_INFO, "Thumbnail full path: {$thumbnail_dir}");
				if(!is_dir($thumbnail_dir)) {
					if ($log) $modx->log(modX::LOG_LEVEL_INFO, "Thumbnail dir not exist");
					if (!mkdir($thumbnail_dir,0755)){
						if ($log) $modx->log(modX::LOG_LEVEL_INFO, "Thumbnail error:".$modx->lexicon(\'rionup_error_createdir\'));
						return $modx->error->failure($modx->lexicon(\'rionup_error_createdir\'));
					}
					else{
						if ($log) $modx->log(modX::LOG_LEVEL_INFO, "Thumbnail dir created successfull");
					}
				}
				else {
					if ($log) $modx->log(modX::LOG_LEVEL_INFO, "Thumbnail dir already exist");
				}
				// $filename = $thumbnail_dir.$name;
				// $imgName = $thumbnail_dir.$def_fn.\'_\'.$imgKey.\'.\'.$ext;
				$imgName = "{$thumbnail_dir}{$def_fn}{$thumb_key}_w{$imgConfig[\'w\']}_h{$imgConfig[\'h\']}.{$ext}";
			}
		}
		if ($log) $modx->log(modX::LOG_LEVEL_INFO, "Part: {$imgKey}, imgName: {$imgName}");

		// создаем объект phpThumb..
		$phpThumb = new phpThumb();
		// ..и задаем параметры
		// $thumbnail->setOptions($options); // хотел чере это сделать - не получилось
		$phpThumb->setSourceFilename($filename);
		
		if (empty($imgConfig[\'f\'])){
			$imgConfig[\'f\']=$ext; // без этого мы не увидим прозрачности в png и gif
		}
		if (!empty($imgConfig)){
			if (($ext==\'png\' or $ext==\'gif\') and !empty($imgConfig[\'fltr\'])){
				// если расширение png или gif и применяется фильтр
				// подразумевается добавление watermark
				// и чтобы наш watermark не распологался на цветном фоне
				// мы его удаляем
				// if ($log) $modx->log(modX::LOG_LEVEL_INFO, "Destroy background for watermark");
				// unset($imgConfig[\'bg\']);
			}
			
			foreach ($imgConfig as $k => $v) {
				// if ($log) $modx->log(modX::LOG_LEVEL_INFO,"$k - $v");
				$phpThumb->setParameter($k, $v);
			}
		}
	   
		// генерируем файл
		if ($log) $modx->log(modX::LOG_LEVEL_INFO, "GenerateThumbnail...");
		if ($phpThumb->GenerateThumbnail()) {
			if ($log) $modx->log(modX::LOG_LEVEL_INFO, "RenderToFile: $imgName");
			if ($phpThumb->RenderToFile($imgName)) {
				// устанавливаем права на файл, это опционально, зависит от сервера
				chmod($imgName, 0666);
			}
		}
	}
}
else {
	if ($log) $modx->log(modX::LOG_LEVEL_INFO, "extension of file ({$ext}) is forbidden for download in system parameters \'upload_images\'. Allow only: ".implode(",", $extensions));
}
return;',
      'locked' => '0',
      'properties' => 'a:13:{s:13:"create_thumbs";a:7:{s:4:"name";s:13:"create_thumbs";s:4:"desc";s:20:"rionup_create_thumbs";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:1;s:7:"lexicon";s:30:"resizeimageonupload:properties";s:4:"area";s:0:"";}s:17:"default_src_param";a:7:{s:4:"name";s:17:"default_src_param";s:4:"desc";s:24:"rionup_default_src_param";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:116:"\'w\'=800,\'h\'=600,\'zc\'=0,\'q\'=80,\'fltr\'=\'wmi|/assets/templates/new/img/others/logo_watermark.png|BR|100|0|0|stc|000000\'";s:7:"lexicon";s:30:"resizeimageonupload:properties";s:4:"area";s:0:"";}s:19:"default_thumb_param";a:7:{s:4:"name";s:19:"default_thumb_param";s:4:"desc";s:26:"rionup_default_thumb_param";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:41:"\'w\'=200,\'h\'=150,\'zc\'=1,\'bg\'=\'#fff\',\'q\'=70";s:7:"lexicon";s:30:"resizeimageonupload:properties";s:4:"area";s:0:"";}s:18:"default_thumb_path";a:7:{s:4:"name";s:18:"default_thumb_path";s:4:"desc";s:25:"rionup_default_thumb_path";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:30:"resizeimageonupload:properties";s:4:"area";s:0:"";}s:12:"exclude_dirs";a:7:{s:4:"name";s:12:"exclude_dirs";s:4:"desc";s:19:"rionup_exclude_dirs";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:53:"assets/images/banners/,assets/images/aliens/{ExChild}";s:7:"lexicon";s:30:"resizeimageonupload:properties";s:4:"area";s:0:"";}s:21:"exclude_dirs_children";a:7:{s:4:"name";s:21:"exclude_dirs_children";s:4:"desc";s:28:"rionup_exclude_dirs_children";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:0;s:7:"lexicon";s:30:"resizeimageonupload:properties";s:4:"area";s:0:"";}s:19:"exclude_dirs_suffix";a:7:{s:4:"name";s:19:"exclude_dirs_suffix";s:4:"desc";s:26:"rionup_exclude_dirs_suffix";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:9:"{ExChild}";s:7:"lexicon";s:30:"resizeimageonupload:properties";s:4:"area";s:0:"";}s:18:"exclude_extensions";a:7:{s:4:"name";s:18:"exclude_extensions";s:4:"desc";s:25:"rionup_exclude_extensions";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:3:"gif";s:7:"lexicon";s:30:"resizeimageonupload:properties";s:4:"area";s:0:"";}s:20:"exclude_part_of_name";a:7:{s:4:"name";s:20:"exclude_part_of_name";s:4:"desc";s:27:"rionup_exclude_part_of_name";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:8:"noresize";s:7:"lexicon";s:30:"resizeimageonupload:properties";s:4:"area";s:0:"";}s:15:"exclude_sources";a:7:{s:4:"name";s:15:"exclude_sources";s:4:"desc";s:22:"rionup_exclude_sources";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:30:"resizeimageonupload:properties";s:4:"area";s:0:"";}s:3:"log";a:7:{s:4:"name";s:3:"log";s:4:"desc";s:10:"rionup_log";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:1;s:7:"lexicon";s:30:"resizeimageonupload:properties";s:4:"area";s:0:"";}s:9:"thumb_key";a:7:{s:4:"name";s:9:"thumb_key";s:4:"desc";s:16:"rionup_thumb_key";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:6:"_thumb";s:7:"lexicon";s:30:"resizeimageonupload:properties";s:4:"area";s:0:"";}s:13:"thumbnail_dir";a:7:{s:4:"name";s:13:"thumbnail_dir";s:4:"desc";s:20:"rionup_thumbnail_dir";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:6:"thumbs";s:7:"lexicon";s:30:"resizeimageonupload:properties";s:4:"area";s:0:"";}}',
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => '',
    ),
    33 => 
    array (
      'id' => '33',
      'source' => '0',
      'property_preprocess' => '0',
      'name' => 'PDFResource',
      'description' => 'Convert MODX resources to PDF files using mPDF',
      'editor_type' => '0',
      'category' => '66',
      'cache_type' => '0',
      'plugincode' => '/**
 * PDFResource Plugin
 *
 * @package pdfresource
 * @subpackage plugin
 *
 * @var modX $modx
 * @var array $scriptProperties
 */

$className = \'TreehillStudio\\PDFResource\\Plugins\\Events\\\\\' . $modx->event->name;

$corePath = $modx->getOption(\'pdfresource.core_path\', null, $modx->getOption(\'core_path\') . \'components/pdfresource/\');
/** @var PDFResource $pdfresource */
$pdfresource = $modx->getService(\'pdfresource\', \'PDFResource\', $corePath . \'model/pdfresource/\', [
    \'core_path\' => $corePath
]);

if ($pdfresource) {
    if (class_exists($className)) {
        $handler = new $className($modx, $scriptProperties);
        if (get_class($handler) == $className) {
            $handler->run();
        } else {
            $modx->log(xPDO::LOG_LEVEL_ERROR, $className. \' could not be initialized!\', \'\', \'PDFResource Plugin\');
        }
    } else {
        $modx->log(xPDO::LOG_LEVEL_ERROR, $className. \' was not found!\', \'\', \'PDFResource Plugin\');
    }
}

return;',
      'locked' => '0',
      'properties' => 'a:0:{}',
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => '',
    ),
    36 => 
    array (
      'id' => '36',
      'source' => '1',
      'property_preprocess' => '0',
      'name' => 'alias_regen',
      'description' => '',
      'editor_type' => '0',
      'category' => '8',
      'cache_type' => '0',
      'plugincode' => 'switch ($modx->event->name) {
  case \'OnBeforeDocFormSave\':
    //if(strpos($resource->get(\'uri\'),\'katalog\') !== false){}
    $exclude = array(1,2,3,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,24,25,27);
    $id = $resource->get(\'id\');
    $title = $resource->get(\'pagetitle\');
    $old_alias = $resource->get(\'alias\');
    $new_alias = $resource->cleanAlias($title);
    if  (!in_array($id, $exclude) && (empty($old_alias) || $new_alias !== $old_alias)) {
      $resource->set(\'alias\', $new_alias);
    }
  break;
}',
      'locked' => '0',
      'properties' => 'a:0:{}',
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => '',
    ),
    39 => 
    array (
      'id' => '39',
      'source' => '1',
      'property_preprocess' => '0',
      'name' => 'MinifyX',
      'description' => '',
      'editor_type' => '0',
      'category' => '73',
      'cache_type' => '0',
      'plugincode' => 'switch ($modx->event->name) {
	case \'OnMODXInit\':
        $file = $modx->getOption(\'minifyx_core_path\', null, MODX_CORE_PATH) . \'components/minifyx/functions/function.php\';
        if (file_exists($file)) {
            include_once $file;
        }
		break;
	case \'OnSiteRefresh\':
        /** @var MinifyX $MinifyX */
		if ($MinifyX = $modx->getService(\'minifyx\',\'MinifyX\', MODX_CORE_PATH.\'components/minifyx/model/minifyx/\')) {
			if ($MinifyX->clearCache()) {
				$modx->log(modX::LOG_LEVEL_INFO, $modx->lexicon(\'refresh_default\').\': MinifyX\');
			}
		}
		break;
	case \'OnWebPagePrerender\':
		$time = microtime(true);
		// Process scripts and styles
		if ($modx->getOption(\'minifyx_process_registered\', null, false, true)) {
			$current = array(
				\'head\' => $modx->sjscripts,
				\'body\' => $modx->jscripts,
			);
			$included = $excluded = $prepared = $raw = array(
				\'head\' => array(\'css\' => array(), \'js\' => array(), \'html\' => array()),
				\'body\' => array(\'css\' => array(), \'js\' => array(), \'html\' => array()),
			);
			$exclude = $modx->getOption(\'minifyx_exclude_registered\');

			// Split all scripts and styles by type
			foreach ($current as $key => $value) {
				foreach ($value as $v) {
					if (preg_match(\'/<(?:link|script).*?(?:href|src)=[\\\'|"](.*?)[\\\'|"]/\', $v, $tmp)) {
						if (strpos($tmp[1], \'.css\') !== false) {
							if (!empty($exclude) && preg_match($exclude, $tmp[1])) {
								$excluded[$key][\'css\'][] = $tmp[1];
							}
							else {
								$included[$key][\'css\'][] = $tmp[1];
							}
						}
						if (strpos($tmp[1], \'.js\') !== false) {
							if (!empty($exclude) && preg_match($exclude, $tmp[1])) {
								$excluded[$key][\'js\'][] = $tmp[1];
							}
							else {
								$included[$key][\'js\'][] = $tmp[1];
							}
						}
					}
					elseif (strpos($v, \'<script\') !== false) {
						$raw[$key][\'js\'][] = trim(preg_replace(\'#<!--.*?-->(\\n|)#s\', \'\', $v));
					}
					elseif (strpos($v, \'<style\') !== false) {
						$raw[$key][\'css\'][] = trim(preg_replace(\'#/\\*.*?\\*/(\\n|)#s\', \'\', $v));
					}
					else {
						$excluded[$key][\'html\'][] = $v;
					}
				}
			}

			// Main options for MinifyX
			$scriptProperties = array(
				\'cacheFolder\' => $modx->getOption(\'minifyx_cacheFolder\', null, \'/assets/components/minifyx/cache/\', true),
				\'forceUpdate\' => $modx->getOption(\'minifyx_forceUpdate\', null, false, true),
				\'minifyJs\' => $modx->getOption(\'minifyx_minifyJs\', null, false, true),
				\'minifyCss\' => $modx->getOption(\'minifyx_minifyCss\', null, false, true),
				\'jsFilename\' => $modx->getOption(\'minifyx_jsFilename\', null, \'all\', true),
				\'cssFilename\' => $modx->getOption(\'minifyx_cssFilename\', null, \'all\', true),
			);
			/** @var MinifyX $MinifyX */
			if (isset($modx->minifyx) && $modx->minifyx instanceof MinifyX) {
                $MinifyX = $modx->minifyx;
                $MinifyX->reset($scriptProperties);
            } else {
                $MinifyX = $modx->getService(\'minifyx\', \'MinifyX\', MODX_CORE_PATH . \'components/minifyx/model/minifyx/\', $scriptProperties);
            }
			if (!$MinifyX->prepareCacheFolder()) {
				$this->modx->log(modX::LOG_LEVEL_ERROR, \'[MinifyX] Could not create cache dir "\'.$scriptProperties[\'cacheFolderPath\'].\'"\');
				return;
			}
			//$cacheFolderUrl = $MinifyX->config[\'cacheFolder\'];

			// Process raw scripts and styles
			$tmp_dir = $MinifyX->getTmpDir() . \'resources/\' . $modx->resource->id . \'/\';
			foreach ($raw as $key => $value) {
				foreach ($value as $type => $rows) {
					$tmp = \'\';
					if ($type == \'css\' && $modx->getOption(\'minifyx_processRawCss\', null, false, true) ||
						$type == \'js\' && $modx->getOption(\'minifyx_processRawJs\', null, false, true)) {

						$text = \'\';
						foreach ($rows as $text) {
							$text = preg_replace(\'#^<(script|style).*?>#\', \'\', $text);
							$text = preg_replace(\'#</(script|style)>$#\', \'\', $text);
							$tmp .= $text;
						}

						if (!empty($tmp)) {
							$file = sha1($tmp) . \'.\' . $type;
							if (!file_exists($tmp_dir . $file)) {
								if (!file_exists($tmp_dir)) {
									$MinifyX->makeDir($tmp_dir);
								}
								file_put_contents($tmp_dir . $file, $tmp);
							}
							$included[$key][$type][] = $tmp_dir . $file;
							$raw[$key][$type] = array();
						}
					}
				}
			}

			// Combine and minify files
			foreach ($included as $key => $value) {
				foreach ($value as $type => $files) {
					if (empty($files)) {continue;}
//					$filename = $MinifyX->config[$type.\'Filename\'] . \'_\';
//					$extension = $MinifyX->config[$type.\'Ext\'];
					$files = $MinifyX->prepareFiles($files, $type);
					$properties = array(
						\'minify\' => $MinifyX->config[\'minify\'.ucfirst($type)]
								? \'true\'
								: \'false\',
					);

					$result = $MinifyX->Munee($files, $properties);
					if ($MinifyX->saveFile($result)) {
                        $prepared[$key][$type][] = $MinifyX->getFileUrl();
                    }
				}
			}

			// Combine files by type
			$final = array(
				\'head\' => array_merge(
					$excluded[\'head\'][\'css\'], $prepared[\'head\'][\'css\'], $raw[\'head\'][\'css\'],
					$excluded[\'head\'][\'js\'], $prepared[\'head\'][\'js\'], $raw[\'head\'][\'js\']
				),
				\'body\' => array_merge(
					$excluded[\'body\'][\'css\'], $prepared[\'body\'][\'css\'], $raw[\'body\'][\'css\'],
					$excluded[\'body\'][\'js\'], $prepared[\'body\'][\'js\'], $raw[\'body\'][\'js\']
				),
			);

			// Push files to tags
			foreach ($final as $type => &$value) {
				foreach ($value as &$file) {
					if (strpos($file, \'<script\') === false && strpos($file, \'<style\') === false) {
						$file = preg_match(\'/\\.css$/iu\', $file)
							? \'<link rel="stylesheet" href="\' . $file . \'" type="text/css" />\'
							: \'<script type="text/javascript" src="\' . $file . \'"></script>\';
					}
				}
				if (!empty($excluded[$type][\'html\'])) {
					$value[] = implode("\\n", $excluded[$type][\'html\']);
				}
			}
			unset($value);

			// Replace tags in web page
			$modx->resource->_output = str_replace(
				array($modx->getRegisteredClientStartupScripts() . "\\n</head>", $modx->getRegisteredClientScripts() . "\\n</body>"),
				array(implode("\\n", $final[\'head\']) . "\\n</head>", implode("\\n", $final[\'body\']) . "\\n</body>"),
				$modx->resource->_output
			);
		}
		// Process images
		if ($modx->getOption(\'minifyx_process_images\', null, false, true)) {
			if (!$modx->getService(\'minifyx\',\'MinifyX\', MODX_CORE_PATH.\'components/minifyx/model/minifyx/\')) {return false;}

			$connector = $modx->getOption(\'minifyx_connector\', null, \'/assets/components/minifyx/munee.php\', true);
			$exclude = $modx->getOption(\'minifyx_exclude_images\');
			$replace = array(\'from\' => array(), \'to\' => array());
			$site_url = $modx->getOption(\'site_url\');
			$default = $modx->getOption(\'minifyx_images_filters\', null, \'\', true);

			preg_match_all(\'/<img.*?>/i\', $modx->resource->_output, $tags);
			foreach ($tags[0] as $tag) {
				if (preg_match($exclude, $tag)) {
					continue;
				}
				elseif (preg_match_all(\'/(src|height|width|filters)=[\\\'|"](.*?)[\\\'|"]/i\', $tag, $properties)) {
					if (count($properties[0]) >= 2) {
						$file = $connector . \'?files=\';
						$resize = \'\';
						$filters = \'\';
						$tmp = array(\'from\' => array(), \'to\' => array());

						foreach ($properties[1] as $k => $v) {
							if ($v == \'src\') {
								$src = $properties[2][$k];
								if (strpos($src, \'://\') !== false) {
									if (strpos($src, $site_url) !== false) {
										$src = str_replace($site_url, \'\', $src);
									}
									else {
										// Image from 3rd party domain
										continue;
									}
								}
								$file .= $src;
								$tmp[\'from\'][\'src\'] = $properties[2][$k];
							}
							elseif ($v == \'height\' || $v == \'width\') {
								$resize .=  $v[0] . \'[\'.$properties[2][$k].\']\';
							}
							elseif ($v == \'filters\') {
								$filters .= $properties[2][$k];
								$tmp[\'from\'][\'filters\'] = $properties[0][$k];
								$tmp[\'to\'][\'filters\'] = \'\';
							}
						}

						if (!empty($tmp[\'from\'][\'src\'])) {
							$resize .= isset($tmp[\'from\'][\'filters\'])
								? $filters
								: $default;
							$tmp[\'to\'][\'src\'] = $file . \'?resize=\' . $resize;

							ksort($tmp[\'from\']);
							ksort($tmp[\'to\']);

							$replace[\'from\'][] = $tag;
							$replace[\'to\'][] = str_replace($tmp[\'from\'], $tmp[\'to\'], $tag);
						}
					}
				}
			}

			if (!empty($replace)) {
				$modx->resource->_output = str_replace(
					$replace[\'from\'],
					$replace[\'to\'],
					$modx->resource->_output
				);
			}
		}
		// Minify the page content
        if ($modx->getOption(\'minifyx_minifyHtml\', null, false)) {
            $output = $modx->resource->_output;
            $replace = [
                \'/<!--[^\\[](.*?)[^\\]]-->/s\' => \'\',
                "/<\\?php/"                  => \'<?php \',
                "/\\n([\\S])/"                => \' $1\',
                "/\\n([\\S])/"                => \'$1\',
                "/>\\n</"                    => \'><\',
                "/>\\s+\\n</"                 => \'><\',
                "/>\\n\\s+</"                 => \'><\',
                "/\\r/"                      => \'\',
                "/\\n/"                      => \'\',
                "/\\t/"                      => \' \',
                \'/ +/\'                      => \' \',
                "/\\t/"                      => \'\',
                "/ +/"                      => \' \',
            ];
            $output = preg_replace(array_keys($replace), array_values($replace), $output);
            $modx->resource->_output = $output;
        }

		$modx->log(modX::LOG_LEVEL_INFO, \'[MinifyX] Total time for page "\'.$modx->resource->id.\'" = \'.(microtime(true) - $time));
		break;
}',
      'locked' => '0',
      'properties' => NULL,
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => 'core/components/minifyx/elements/plugins/plugin.minifyx.php',
    ),
    40 => 
    array (
      'id' => '40',
      'source' => '1',
      'property_preprocess' => '0',
      'name' => 'compiler',
      'description' => '',
      'editor_type' => '0',
      'category' => '74',
      'cache_type' => '0',
      'plugincode' => 'if (!$modx->getService(\'compiler\',\'Compiler\', MODX_CORE_PATH.\'components/compiler/model/compiler/\')) {
    return false;
}

/** @var modX $modx */
switch ($modx->event->name) {
    case "OnFileManagerFileCreate":
    case "OnFileManagerFileUpdate":
        if (empty($path)) {
            return;
        }
        
        /** @var Compiler $Compiler */
        $Compiler = new Compiler($modx);
        
        //
        $pathinfo = pathinfo($path);
        $pathinfo[\'dirpath\'] = $Compiler->cleanUrl($pathinfo[\'dirname\'] . \'/\');
        $pathinfo[\'dirurl\'] = $Compiler->cleanUrl(\'/\' . str_replace(MODX_BASE_PATH, \'\', $pathinfo[\'dirname\']) . \'/\');
        unset($pathinfo[\'dirname\']);
        
        //
        if (
            $pathinfo[\'extension\'] == \'scss\'
            && strpos($pathinfo[\'dirurl\'], $Compiler->config[\'scssDirFrom\']) === 0
            && !($Compiler->config[\'scssSkipUnderscore\'] && substr($pathinfo[\'filename\'], 0, 1) === \'_\')
        ) {
            // Создаём директорию назначения
            if (!$Compiler->prepareDir($Compiler->config[\'scssDirTo\'])) {
                $modx->log(modX::LOG_LEVEL_ERROR, \'[Compiler] Could not create dir "\' . $Compiler->config[\'scssDirTo\'] . \'"\');
                return;
            }
            
            //
            $fileInnerDir = $Compiler->cleanUrl(\'/\' . str_replace($Compiler->config[\'scssDirFrom\'], \'\', $pathinfo[\'dirurl\']) . \'/\');
            $fileInnerDirUrl = $Compiler->cleanUrl($Compiler->config[\'scssDirTo\'] . $fileInnerDir);
            
            // Проверяем, можно ли компилить в подпапках.
            // Если нельзя и мы в подпапке - останавливаемся.
            if (!$Compiler->config[\'scssWithSubdirs\'] && $fileInnerDir != \'/\') {
                return;
            }
            
            // Создаём подпапку назначения
            if (!$Compiler->makeDir($fileInnerDirUrl)) {
                $modx->log(modX::LOG_LEVEL_ERROR, \'[Compiler] Could not create dir "\' . $fileInnerDirUrl . \'"\');
                return;
            }
            
            // $options = array(
            //     \'minify\' => $Compiler->config[\'scssMinify\'] ? \'true\' : \'false\',
            // );
            
            //
            $cssData = $Compiler->Munee($pathinfo[\'dirurl\'] . $pathinfo[\'basename\']);
            $cssData = $cssData ? $cssData : \' \';
            
            // Парсим SCSS файл для поиска подключаемых SCSS директивой @import
            $scssData = file_get_contents($pathinfo[\'dirpath\'] . $pathinfo[\'basename\']);
            if (preg_match_all(\'/@import ([^\\\'";,]*[\\\'"]+([^\\\'";]+)[\\\'"]+[^;]*);/is\', $scssData, $import_matches)) {
                // Фильтруем из найденных только те, что нам подходят
                foreach ($import_matches[1] as $import_match) {
                    if (substr($import_match, 0, 3) !== \'url\' &&
                        substr($import_match, 1, 5) !== \'http:\' &&
                        substr($import_match, 1, 6) !== \'https:\' &&
                        substr($import_match, -5, 4) !== \'.css\' &&
                        (
                            substr($import_match, -1) === \'\\\'\' ||
                            substr($import_match, -1) === \'\\"\'
                        )
                    ) {
                        foreach (array_map(\'trim\', explode(\',\', $import_match)) as $file) {
                            $file = str_replace(array(\'\\\'\', \'"\'), \'\', $file);
                            // print $file . PHP_EOL;
                        }
                    }
                }
            }
            
            // Получаем путь до конечного CSS файла
            $fileOutPath = $Compiler->cleanUrl(MODX_BASE_PATH . $fileInnerDirUrl . $pathinfo[\'filename\'] . \'.css\');
            
            // Сохраняем файл
            if (!file_put_contents($fileOutPath, $cssData)) {
                $modx->log(modX::LOG_LEVEL_ERROR, \'[Compiler] Could not save cache file \'. $fileOutPath);
                return false;
            }
        }
        break;
}',
      'locked' => '0',
      'properties' => NULL,
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => 'core/components/compiler/elements/plugins/plugin.system.php',
    ),
    41 => 
    array (
      'id' => '41',
      'source' => '1',
      'property_preprocess' => '0',
      'name' => 'seoTemplates',
      'description' => '',
      'editor_type' => '0',
      'category' => '75',
      'cache_type' => '0',
      'plugincode' => '$seoTemplates = $modx->getService(\'seotemplates\',\'seoTemplates\',$modx->getOption(\'seotemplates_core_path\',null,$modx->getOption(\'core_path\').\'components/seotemplates/\').\'model/seotemplates/\', array());
if (!($seoTemplates instanceof seoTemplates)) return \'\';

//$pdotools = $modx->getService(\'pdoTools\');

if ($modx->event->name == \'OnLoadWebDocument\') {

  if (!$template = $modx->getObject(\'modTemplate\', $modx->resource->template)) {return \'\';};
  $template = $template->get(\'templatename\');
  $templates = array();

  $c = $modx->newQuery(\'seoTemplatesItem\');
  $c->sortby(\'id\', \'ASC\');
  $c->select(array(\'id\', \'template\', \'field\', \'value\', \'active\'));
  $c->where(array(\'active:=\' => 1));

  if ($c->prepare() && $c->stmt->execute()) {
    $items = $c->stmt->fetchAll(PDO::FETCH_ASSOC);
  }

  if (empty($items)) return \'\';

  foreach($items as $item) {
    $tpls = json_decode($item[\'template\'], true);

    if (in_array($template, $tpls)) {
        $templates[] = $item;
    }
  }

  if (empty($templates)) return \'\';

  $placeholders = array();
  $fields = array();

  $tmp = $modx->getCollection(\'seoTemplatesField\');

  if ($tmp) {

      foreach ($tmp as $field) {
        $fields[$field->get(\'id\')] = $field->get(\'name\');
      }

      foreach($templates as $item) {
        $field = $item[\'field\'];

        if (isset($fields[$field])) {
          $placeholders[$fields[$field]] = $item[\'value\'];
        }
      }

      foreach ($placeholders as $k => $v) {
        $chunk = $modx->newObject(\'modChunk\', array(\'name\' => \'seoTemplatesTmp_\'.$k));
        $chunk->setCacheable(false);
        $placeholders[$k] = $chunk->process(array($k => $v), $v);
        //$placeholders[$k] = $pdotools->getChunk(\'@INLINE \'.$v, array($k => $v));
      }

      $prefix = $modx->getOption(\'seotemplates_placeholder_prefix\', null, \'st_\');

      $modx->setPlaceholders($placeholders, $prefix);

  }

}',
      'locked' => '0',
      'properties' => NULL,
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => 'core/components/seotemplates/elements/plugins/plugin.seotemplates.php',
    ),
    43 => 
    array (
      'id' => '43',
      'source' => '1',
      'property_preprocess' => '0',
      'name' => 'MobileDetect',
      'description' => '',
      'editor_type' => '0',
      'category' => '80',
      'cache_type' => '0',
      'plugincode' => '/** @var modX $modx */
/** @var array $scriptProperties */
/** @var MobileDetect $MobileDetect */
switch ($modx->event->name) {
    case \'OnWebPagePrerender\':
        $MobileDetect = $modx->getService(\'mobiledetect\', \'MobileDetect\', MODX_CORE_PATH . \'components/mobiledetect/\');
        if ($MobileDetect && empty($MobileDetect->config[\'disable_plugin\'])) {
            $key = $MobileDetect->config[\'force_browser_variable\'];
            $device = !empty($_GET) && array_key_exists($key, $_GET)
                ? $modx->stripTags($_GET[$key])
                : \'\';

            $modx->resource->_output = $MobileDetect->parseDocument($modx->resource->_output, $device);
        }
        break;

    case \'pdoToolsOnFenomInit\':
        $MobileDetect = $modx->getService(\'mobiledetect\', \'MobileDetect\', MODX_CORE_PATH . \'components/mobiledetect/\');
        if ($MobileDetect && empty($MobileDetect->config[\'disable_plugin\'])) {
            $key = $MobileDetect->config[\'force_browser_variable\'];
            $device = !empty($_GET) && array_key_exists($key, $_GET)
                ? $modx->stripTags($_GET[$key])
                : \'\';

            if (empty($device)) {
                $device = $MobileDetect->getSettings();
            }

            if (empty($device) || $device == \'detect\') {
                /** @var Mobile_Detect $detector */
                $detector = $MobileDetect->getDetector();
                $device = ($detector->isMobile()
                    ? ($detector->isTablet() ? \'tablet\' : \'mobile\')
                    : \'standard\');
                $MobileDetect->saveSettings($device);
            }
        }
        
        if (!empty($device)) {
            $_SESSION[\'mobiledetect\'][\'device\'] = $device;
        }
        
        $fenom->addBlockFunction(\'mobile\', function($options, $content) {
			if ($_SESSION[\'mobiledetect\'][\'device\'] == \'mobile\' || $_SESSION[\'mobiledetect\'][\'device\'] == \'tablet\'){
				return $content;
			}
		});
        $fenom->addBlockFunction(\'phone\', function($options, $content) {
			if ($_SESSION[\'mobiledetect\'][\'device\'] == \'mobile\'){
				return $content;
			}
		});
        $fenom->addBlockFunction(\'tablet\', function($options, $content) {
			if ($_SESSION[\'mobiledetect\'][\'device\'] == \'tablet\'){
				return $content;
			}
		});
        $fenom->addBlockFunction(\'desktop\', function($options, $content) {
			if (empty($_SESSION[\'mobiledetect\'][\'device\']) || $_SESSION[\'mobiledetect\'][\'device\'] == \'standard\'){
				return $content;
			}
		});
        $fenom->addBlockFunction(\'standard\', function($options, $content) {
			if (empty($_SESSION[\'mobiledetect\'][\'device\']) || $_SESSION[\'mobiledetect\'][\'device\'] == \'standard\'){
				return $content;
			}
		});
        break;
}',
      'locked' => '0',
      'properties' => NULL,
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => 'core/components/mobiledetect/elements/plugins/plugin.mobiledetect.php',
    ),
    44 => 
    array (
      'id' => '44',
      'source' => '1',
      'property_preprocess' => '0',
      'name' => 'fenom_mods',
      'description' => '',
      'editor_type' => '0',
      'category' => '81',
      'cache_type' => '0',
      'plugincode' => '/** @var modX $modx */
switch ($modx->event->name) {
  case \'pdoToolsOnFenomInit\':
    /** @var Fenom $fenom
      Мы получаем переменную $fenom при его первой инициализации и можем вызывать его методы.
      Например, добавим модификатор вывода имени домена сайта из произвольной ссылки.
    */
    $fenom->addModifier(\'website\', function ($input) {
      if (!$url = parse_url($input)) {
        return $input;
      }
      $output = str_replace(\'www.\', \'\', $url[\'host\']);

      return strtolower($output);
    });

    // $fenom->addModifier(\'ignore\', function ($input) {
    //     $output = \'{ignore}\' . $input . \'{/ignore}\';
    //     return $output;
    // });

    $fenom->addModifier(\'array_keys\', function ($input) {
        $output = array_keys($input);
        return $output;
    });

    $fenom->addModifier(\'is_array\', function ($input) {
        $output = is_array($input);
        return $output;
    });

    break;
}',
      'locked' => '0',
      'properties' => 'a:0:{}',
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '1',
      'static_file' => 'artmebius/plugins/fenom_mods.php',
    ),
    45 => 
    array (
      'id' => '45',
      'source' => '0',
      'property_preprocess' => '0',
      'name' => 'ColorPicker',
      'description' => 'ColorPicker runtime hooks - registers custom TV input & output types and includes javascripts on document edit pages.',
      'editor_type' => '0',
      'category' => '89',
      'cache_type' => '0',
      'plugincode' => '/**
 * ColorPicker Runtime Hooks
 *
 * @package colorpicker
 * @subpackage plugin
 *
 * @var modX $modx
 * @var array $scriptProperties
 */

$className = \'TreehillStudio\\ColorPicker\\Plugins\\Events\\\\\' . $modx->event->name;

$corePath = $modx->getOption(\'colorpicker.core_path\', null, $modx->getOption(\'core_path\') . \'components/colorpicker/\');
/** @var ColorPicker $colorpicker */
$colorpicker = $modx->getService(\'colorpicker\', \'ColorPicker\', $corePath . \'model/colorpicker/\', [
    \'core_path\' => $corePath
]);

if ($colorpicker) {
    if (class_exists($className)) {
        $handler = new $className($modx, $scriptProperties);
        if (get_class($handler) == $className) {
            $handler->run();
        } else {
            $modx->log(xPDO::LOG_LEVEL_ERROR, $className. \' could not be initialized!\', \'\', \'ColorPicker Plugin\');
        }
    } else {
        $modx->log(xPDO::LOG_LEVEL_ERROR, $className. \' was not found!\', \'\', \'ColorPicker Plugin\');
    }
}

return;',
      'locked' => '0',
      'properties' => 'a:0:{}',
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => '',
    ),
    67 => 
    array (
      'id' => '67',
      'source' => '1',
      'property_preprocess' => '0',
      'name' => 'FileAttach',
      'description' => '',
      'editor_type' => '0',
      'category' => '108',
      'cache_type' => '0',
      'plugincode' => '/**
 * FileAttach
 *
 * Copyright 2015-2016 by Vitaly Checkryzhev <13hakta@gmail.com>
 *
 * This file is part of FileAttach, tool to attach files to resources with
 * MODX Revolution\'s Manager.
 *
 * FileAttach is free software; you can redistribute it and/or modify it under the
 * terms of the GNU General Public License as published by the Free Software
 * Foundation version 3,
 *
 * FileAttach is distributed in the hope that it will be useful, but WITHOUT ANY
 * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
 * A PARTICULAR PURPOSE. See the GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with
 * FileAttach; if not, write to the Free Software Foundation, Inc., 59 Temple Place,
 * Suite 330, Boston, MA 02111-1307 USA
 *
 * @package FileAttach
*/

switch ($modx->event->name) {
	// Add a custom tab to the MODX create/edit resource pages
	case \'OnDocFormPrerender\':

		// Check access
		if (!$modx->hasPermission(\'fileattach.doclist\')) return;

		// Skip form building when resource template is not in permitted list
		$templates = $modx->getOption(\'fileattach.templates\');

		if ($templates != \'\') {
			$templatelist = explode(\',\', $templates);
			$template = is_object($resource)? $resource->get(\'template\') : 0;
			if (!in_array($template, $templatelist)) return;
		}

		$modx->controller->addLexiconTopic(\'fileattach:default\');

		$corePath = $modx->getOption(\'fileattach.core_path\', null, $modx->getOption(\'core_path\') . \'components/fileattach/\');
		require_once $corePath . \'model/fileattach/fileattach.class.php\';

		$modx->FileAttach = new FileAttach($modx);
		$modx->controller->addJavascript($modx->FileAttach->config[\'jsUrl\'] . \'mgr/fileattach.js\');
		$modx->controller->addJavascript($modx->FileAttach->config[\'jsUrl\'] . \'mgr/widgets/items.grid.js\');
		$modx->controller->addLastJavascript($modx->FileAttach->config[\'jsUrl\'] . \'mgr/filestab.js\');
		$modx->controller->addHtml(\'<script type="text/javascript">FileAttach.config = \' . $modx->toJSON($modx->FileAttach->config) . \';</script>\');

		break;

	// Remove attached files to resources
	case \'OnEmptyTrash\':
		// Load service
		if (!$FileAttach = $modx->getService(\'fileattach\', \'FileAttach\',
			$modx->getOption(\'fileattach.core_path\',
			null,
			$modx->getOption(\'core_path\') . \'components/fileattach/\') . \'model/fileattach/\')) {
			$modx->log(xPDO::LOG_LEVEL_ERROR, \'Could not load FileAttach class OnEmptyTrash!\');
			return;
		}

		foreach ($ids as &$id) {
			$c = $modx->newQuery(\'FileItem\');
			$c->where(array(\'docid\' => $id));

			$iter = $modx->getIterator(\'FileItem\', $c);
			foreach ($iter as $item) $item->remove();
		}

		break;
}',
      'locked' => '0',
      'properties' => NULL,
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => 'core/components/fileattach/elements/plugins/plugin.filestab.php',
    ),
    46 => 
    array (
      'id' => '46',
      'source' => '1',
      'property_preprocess' => '0',
      'name' => 'TVTable',
      'description' => '',
      'editor_type' => '0',
      'category' => '90',
      'cache_type' => '0',
      'plugincode' => '/** @var modX $modx */
$corePath = $modx->getOption(\'tvtable.core_path\', null, $modx->getOption(\'core_path\') . \'components/tvtable/\');
$assetsPath = $modx->getOption(\'assets_url\', null, MODX_ASSETS_URL) . \'components/tvtable/\';

switch ($modx->event->name) {
    case \'OnTVInputRenderList\':
        $modx->event->output($corePath . \'elements/tv/input/\');
        break;
    case \'OnTVInputPropertiesList\':
        $modx->event->output($corePath . \'elements/tv/inputoptions/\');
        break;
    case \'OnDocFormPrerender\':
        $modx->regClientCSS($assetsPath . \'css/mgr/tvtable.css?ver=3.5.3\');
        $modx->regClientStartupScript($assetsPath . \'js/mgr/tvtable.js?ver=3.5.3\');
        break;
    case \'OnManagerPageBeforeRender\':
        $modx->controller->addLexiconTopic(\'tvtable:default\');
        break;
}',
      'locked' => '0',
      'properties' => NULL,
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => 'core/components/tvtable/elements/plugins/plugin.tvtable.php',
    ),
    48 => 
    array (
      'id' => '48',
      'source' => '0',
      'property_preprocess' => '0',
      'name' => 'mixedImage',
      'description' => 'mixedImage 2.1.0-pl plugin for MODx Revolution',
      'editor_type' => '0',
      'category' => '0',
      'cache_type' => '0',
      'plugincode' => '$corePath = $modx->getOption(\'core_path\',null,MODX_CORE_PATH).\'components/mixedimage/\';
$assetsUrl = $modx->getOption(\'assets_url\',null,MODX_ASSETS_URL).\'components/mixedimage/\';

$modx->lexicon->load(\'mixedimage:default\');

switch ($modx->event->name) {
    case \'OnTVInputRenderList\':
        $modx->event->output($corePath.\'elements/tv/input/\');
        break;
    case \'OnTVOutputRenderList\':
        $modx->event->output($corePath.\'elements/tv/output/\');
        break;
    case \'OnTVInputPropertiesList\':
        $modx->event->output($corePath.\'elements/tv/input/options/\');
        break;
    case \'OnTVOutputRenderPropertiesList\':
        $modx->event->output($corePath.\'elements/tv/properties/\');
        break;
    case \'OnDocFormPrerender\':
    case \'OnManagerPageBeforeRender\':
        $modx->regClientStartupScript($assetsUrl.\'js/mgr/mixedimage.js\');
        $modx->regClientCSS($assetsUrl.\'css/mgr/mixedimage.css\');
        $modx->controller->addLexiconTopic(\'mixedimage:default\');
        break;
    case \'OnMODXInit\':
    case \'OnLoadWebDocument\':
        $mTypes = $modx->getOption(\'manipulatable_url_tv_output_types\',null,\'image,file\').\',mixedimage\';
        $modx->setOption(\'manipulatable_url_tv_output_types\', $mTypes);
        break;
}',
      'locked' => '0',
      'properties' => NULL,
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => '',
    ),
    49 => 
    array (
      'id' => '49',
      'source' => '1',
      'property_preprocess' => '0',
      'name' => 'AdminTools',
      'description' => '',
      'editor_type' => '0',
      'category' => '92',
      'cache_type' => '0',
      'plugincode' => '/** @var array $scriptProperties */
$path = $modx->getOption(\'admintools_core_path\', null, $modx->getOption(\'core_path\') . \'components/admintools/\') . \'services/\';
/** @var AdminTools $AdminTools */
$AdminTools = $modx->getService(\'admintools\', \'AdminTools\', $path);
$elementType = null;
if ($AdminTools instanceof AdminTools) {
    switch ($modx->event->name) {
        case \'OnManagerPageBeforeRender\':
            if ($modx->user->id) {
                $AdminTools->initialize();
            }
            break;
        case \'OnManagerPageAfterRender\':
            if ($AdminTools->isLocked()) {
                $controller->content = $modx->getChunk(\'tpl.lockScreen\', [
                        \'username\' => $modx->user->username,
                        \'photo\' => $modx->user->getPhoto(),
                        \'title\' => $modx->getOption(\'site_name\'),
                        \'lang\' => $modx->getOption(\'manager_language\'),
                        \'form_action\' => $AdminTools->getOption(\'connectorUrl\'),
                        \'auth\' => $modx->user->getUserToken(\'mgr\'),
                        \'assets_url\' => MODX_ASSETS_URL,
                        \'input_placeholder\' => $AdminTools->getInputPlaceholder(),
                    ]
                );
            }
            break;
        case \'OnDocFormSave\':
            if ($modx->getOption(\'admintools_clear_only_resource_cache\', null, false) && $modx->event->params[\'mode\'] === modSystemEvent::MODE_UPD) {
                if ($resource->get(\'syncsite\')) {
                    $AdminTools->clearResourceCache($resource);
                }
                if (!empty($_POST[\'createCache\'])) {
                    $AdminTools->createResourceCache($resource->uri);
                }
            }
            break;
        case \'OnManagerPageInit\':
            if (!$modx->user->isAuthenticated(\'mgr\') && $modx->getOption(\'admintools_email_authorization\', null, false)) {
                $id = (int) $modx->getOption(\'admintools_loginform_resource\');
                if (!empty($id) && $modx->getCount(\'modResource\', [\'id\' => $id, \'published\' => 1, \'deleted\' => 0])) {
                    $url = $modx->makeUrl($id, \'\', \'\', \'full\');
                    $modx->setOption(\'manager_login_url_alternate\', $url);
                }
            }
            break;
        case \'OnManagerAuthentication\':
            if ($modx->getOption(\'admintools_user_can_login\', null, false)) {
                $modx->setOption(\'admintools_user_can_login\', false);
                $modx->event->output(true);
            }
            break;
        case \'OnLoadWebDocument\':
            if ((!$modx->user->active || $modx->user->Profile->blocked) && $modx->user->isAuthenticated($modx->context->get(\'key\'))) {
                $modx->runProcessor(\'security/logout\');
            }
            if ($modx->getOption(\'admintools_alternative_permissions\', null, false) && !$AdminTools->hasPermissions()){
                $modx->sendUnauthorizedPage();
            }
            break;
        case \'OnTempFormPrerender\':
            if ($modx->getOption(\'admintools_template_resource_relationship\', null, true)) {
                $modx->controller->addLastJavascript($AdminTools->getOption(\'jsUrl\') . \'mgr/templates.js\');
            }
            break;
        case \'OnDocFormPrerender\':
            $_html = [];
            $output = \'\';
            if ($modx->getOption(\'admintools_template_resource_relationship\', null, true)) {
                $_html[\'tpl_res_relationship\'] = \'
            var tmpl = Ext.getCmp("modx-resource-template");
            if (tmpl.getValue()) tmpl.label.update(_("resource_template") + "&nbsp;&nbsp;<a href=\\"?a=element/template/update&id=" + tmpl.getValue() + "\\"><i class=\\"icon icon-external-link\\"></i></a>");\';
            }
            if ($modx->getOption(\'admintools_clear_only_resource_cache\', null, true) && $modx->event->params[\'mode\'] != modSystemEvent::MODE_NEW) {
                $_html[\'create_resource_cache\'] = \'
            var cb = Ext.create({
                xtype: "xcheckbox",
                boxLabel: _("admintools_create_resource_cache"),
                description: _("admintools_create_resource_cache_help"),
                hideLabel: true,
                name: "createCache",
                id: "createCache",
                checked: \'. (int)$modx->getOption(\'admintools_create_resource_cache\', null, false) .\'
            });
            if (Ext.getCmp("modx-page-settings-right-box-right")) {
                Ext.getCmp("modx-page-settings-right-box-right").insert(2,cb);
                Ext.getCmp("modx-page-settings-right-box-left").add(Ext.getCmp("modx-resource-uri-override"));
                Ext.getCmp("modx-panel-resource").on("success", function(o){
                    if (o.result.object.createCache != 0) {
                        cb.setValue(true);
                    }
                });
            }\';
            }
            if (!empty($_html)) {
            $output .= \'
    Ext.onReady(function() {
        setTimeout(function(){\' . implode("\\n", $_html) . \'
        }, 200);
    });\';
            }
            if ($modx->getOption(\'admintools_alternative_permissions\', null, true) && $modx->hasPermission(\'access_permissions\')) {
                $modx->controller->addLastJavascript($AdminTools->getOption(\'jsUrl\') . \'mgr/permissions.js\');
                $output .= \'
    Ext.ComponentMgr.onAvailable("modx-resource-tabs", function() {
		this.on("beforerender", function() {
			this.add({
				title: _("admintools_permissions"),
				border: false,
				items: [{
					layout: "anchor",
					border: false,
					items: [{
						html: _("admintools_permissions_desc"),
						border: false,
						bodyCssClass: "panel-desc"
					}, {
						xtype: "admintools-grid-permissions",
						anchor: "100%",
						cls: "main-wrapper",
						resource: \' . $id . \'
					}]
				}]
			});
		});
	});
\';
            }
            if (!empty($output)) {
                $modx->controller->addHtml(\'<script>\' . $output . \'</script>\');
            }
            break;
        case \'OnMODXInit\':
            if (($modx->context->get(\'key\') !== \'mgr\')
                && $modx->getOption(\'admintools_only_current_context_user\', null, false)
                && $modx->user->isAuthenticated(\'mgr\')
                && !$modx->user->isAuthenticated($modx->context->get(\'key\')))
            {
               $modx->user = $modx->newObject(\'modUser\');
                $modx->user->fromArray([\'id\' => 0, \'username\' => $modx->getOption(\'default_username\', \'\', \'(anonymous)\', true)], \'\', true);
            }
            break;
    }
}',
      'locked' => '0',
      'properties' => NULL,
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => 'core/components/admintools/elements/plugins/plugin.admintools.php',
    ),
    50 => 
    array (
      'id' => '50',
      'source' => '1',
      'property_preprocess' => '0',
      'name' => 'miniShop2',
      'description' => '',
      'editor_type' => '0',
      'category' => '93',
      'cache_type' => '0',
      'plugincode' => '/** @var modX $modx */
switch ($modx->event->name) {
    case \'OnMODXInit\':
        // Load extensions
        /** @var miniShop2 $miniShop2 */
        if ($miniShop2 = $modx->getService(\'miniShop2\')) {
            $miniShop2->loadMap();
        }
        break;

    case \'OnHandleRequest\':
        // Handle ajax requests
        $isAjax = !empty($_SERVER[\'HTTP_X_REQUESTED_WITH\']) && $_SERVER[\'HTTP_X_REQUESTED_WITH\'] == \'XMLHttpRequest\';
        if (empty($_REQUEST[\'ms2_action\']) || !$isAjax) {
            return;
        }
        /** @var miniShop2 $miniShop2 */
        if ($miniShop2 = $modx->getService(\'miniShop2\')) {
            $response = $miniShop2->handleRequest($_REQUEST[\'ms2_action\'], @$_POST);
            @session_write_close();
            exit($response);
        }
        break;

    case \'OnManagerPageBeforeRender\':
        /** @var miniShop2 $miniShop2 */
        if ($miniShop2 = $modx->getService(\'miniShop2\')) {
            $modx->controller->addLexiconTopic(\'minishop2:default\');
            $modx->regClientStartupScript($miniShop2->config[\'jsUrl\'] . \'mgr/misc/ms2.manager.js\');
        }
        break;

    case \'OnLoadWebDocument\':
        /** @var miniShop2 $miniShop2 */
        $miniShop2 = $modx->getService(\'miniShop2\');
        $registerFrontend = $modx->getOption(\'ms2_register_frontend\', null, \'1\');
        if ($miniShop2 && $registerFrontend) {
            $miniShop2->registerFrontend($modx->context->get(\'key\'));
        }
        // Handle non-ajax requests
        if (!empty($_REQUEST[\'ms2_action\'])) {
            if ($miniShop2) {
                $miniShop2->handleRequest($_REQUEST[\'ms2_action\'], @$_POST);
            }
        }
        // Set product fields as [[*resource]] tags
        if ($modx->resource->get(\'class_key\') == \'msProduct\') {
            if ($dataMeta = $modx->getFieldMeta(\'msProductData\')) {
                unset($dataMeta[\'id\']);
                $modx->resource->_fieldMeta = array_merge(
                    $modx->resource->_fieldMeta,
                    $dataMeta
                );
            }
        }
        break;

    case \'OnWebPageInit\':
        // Set referrer cookie
        /** @var msCustomerProfile $profile */
        $referrerVar = $modx->getOption(\'ms2_referrer_code_var\', null, \'msfrom\', true);
        $cookieVar = $modx->getOption(\'ms2_referrer_cookie_var\', null, \'msreferrer\', true);
        $cookieTime = $modx->getOption(\'ms2_referrer_time\', null, 86400 * 365, true);

        if (!$modx->user->isAuthenticated() && !empty($_REQUEST[$referrerVar])) {
            $code = trim($_REQUEST[$referrerVar]);
            if ($profile = $modx->getObject(\'msCustomerProfile\', [\'referrer_code\' => $code])) {
                $referrer = $profile->get(\'id\');
                setcookie($cookieVar, $referrer, time() + $cookieTime);
            }
        }
        break;

    case \'OnUserSave\':
        // Save referrer id
        /** @var string $mode */
        if ($mode == modSystemEvent::MODE_NEW) {
            /** @var modUser $user */
            $cookieVar = $modx->getOption(\'ms2_referrer_cookie_var\', null, \'msreferrer\', true);
            $cookieTime = $modx->getOption(\'ms2_referrer_time\', null, 86400 * 365, true);
            if ($modx->context->key != \'mgr\' && !empty($_COOKIE[$cookieVar])) {
                if ($profile = $modx->getObject(\'msCustomerProfile\', [\'id\' => $user->get(\'id\')])) {
                    if (!$profile->get(\'referrer_id\') && $_COOKIE[$cookieVar] != $user->get(\'id\')) {
                        $profile->set(\'referrer_id\', (int)$_COOKIE[$cookieVar]);
                        $profile->save();
                    }
                }
                setcookie($cookieVar, \'\', time() - $cookieTime);
            }
        }
        break;

    case \'msOnChangeOrderStatus\':
        // Update customer stat
        if (empty($status) || $status != 2) {
            return;
        }

        /** @var modUser $user */
        /** @var msOrder $order */
        if ($user = $order->getOne(\'User\')) {
            $q = $modx->newQuery(\'msOrder\', [\'type\' => 0]);
            $q->innerJoin(\'modUser\', \'modUser\', [\'modUser.id = msOrder.user_id\']);
            $q->innerJoin(\'msOrderLog\', \'msOrderLog\', [
                \'msOrderLog.order_id = msOrder.id\',
                \'msOrderLog.action\' => \'status\',
                \'msOrderLog.entry\' => $status,
            ]);
            $q->where([\'msOrder.user_id\' => $user->get(\'id\')]);
            $q->groupby(\'msOrder.user_id\');
            $q->select(\'SUM(msOrder.cost)\');
            if ($q->prepare() && $q->stmt->execute()) {
                $spent = $q->stmt->fetchColumn();
                /** @var msCustomerProfile $profile */
                if ($profile = $modx->getObject(\'msCustomerProfile\', [\'id\' => $user->get(\'id\')])) {
                    $profile->set(\'spent\', $spent);
                    $profile->save();
                }
            }
        }
        break;
}',
      'locked' => '0',
      'properties' => NULL,
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => 'core/components/minishop2/elements/plugins/plugin.minishop2.php',
    ),
    51 => 
    array (
      'id' => '51',
      'source' => '1',
      'property_preprocess' => '0',
      'name' => 'mSearch2',
      'description' => '',
      'editor_type' => '0',
      'category' => '94',
      'cache_type' => '0',
      'plugincode' => '$id = 0;

switch ($modx->event->name) {

	case \'OnDocFormSave\':
	case \'OnResourceDelete\':
	case \'OnResourceUndelete\':
		/* @var modResource $modResource */
		if (!empty($resource) && $resource instanceof modResource) {
			$id = $resource->get(\'id\');
		}
	break;

	case \'OnCommentSave\':
	case \'OnCommentRemove\':
	case \'OnCommentDelete\':
		/* @var TicketComment $TicketComment */
		if (!empty($TicketComment) && $TicketComment instanceof TicketComment) {
			$id = $TicketComment->getOne(\'Thread\')->get(\'resource\');
		}
	break;

}


if (!empty($id)) {
	/* @var modProcessorResponse $response */
	$response = $modx->runProcessor(\'mgr/index/update\', array(\'id\' => $id), array(\'processors_path\' => MODX_CORE_PATH . \'components/msearch2/processors/\'));

	if ($response->isError()) {
		$modx->log(modX::LOG_LEVEL_ERROR, print_r($response->getAllErrors(), true));
	}
}',
      'locked' => '0',
      'properties' => NULL,
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => 'core/components/msearch2/elements/plugins/plugin.msearch2.php',
    ),
    52 => 
    array (
      'id' => '52',
      'source' => '1',
      'property_preprocess' => '0',
      'name' => 'msOptionsPrice',
      'description' => '',
      'editor_type' => '0',
      'category' => '95',
      'cache_type' => '0',
      'plugincode' => '/** @var array $scriptProperties */
/** @var msoptionsprice $msoptionsprice */

$fqn = $modx->getOption(\'msoptionsprice_class\', null, \'msoptionsprice.msoptionsprice\', true);
$path = $modx->getOption(\'msoptionsprice_core_path\', null,
    $modx->getOption(\'core_path\', null, MODX_CORE_PATH) . \'components/msoptionsprice/\');
if (!$msoptionsprice = $modx->getService($fqn, \'\', $path . \'model/\',
    array(\'core_path\' => $path))
) {
    return false;
}

$className = \'msOptionsPrice\' . $modx->event->name;
$modx->loadClass(\'msOptionsPricePlugin\', $msoptionsprice->getOption(\'modelPath\') . \'msoptionsprice/systems/\', true,
    true);
$modx->loadClass($className, $msoptionsprice->getOption(\'modelPath\') . \'msoptionsprice/systems/\', true, true);
if (class_exists($className)) {
    /** @var msOptionsPricePlugin $handler */
    $handler = new $className($modx, $scriptProperties);
    $handler->run();
}
return;',
      'locked' => '0',
      'properties' => NULL,
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => 'core/components/msoptionsprice/elements/plugins/plugin.msoptionsprice.php',
    ),
    53 => 
    array (
      'id' => '53',
      'source' => '1',
      'property_preprocess' => '0',
      'name' => 'msOptionsPriceOnInit',
      'description' => '',
      'editor_type' => '0',
      'category' => '95',
      'cache_type' => '0',
      'plugincode' => 'if ($modx->event->name != \'OnMODXInit\') {
    return;
}

$classGallery = trim($this->xpdo->getOption(\'msoptionsprice_modification_gallery_class\', null,
    \'msProductFile\', true));

if (!empty($classGallery)) {
    $modx->loadClass($classGallery);
    $modx->map[$classGallery][\'composites\'][\'modificationImages\'] = array(
        \'class\'       => \'msopModificationImage\',
        \'local\'       => \'id\',
        \'foreign\'     => \'image\',
        \'cardinality\' => \'many\',
        \'owner\'       => \'local\',
    );
}',
      'locked' => '0',
      'properties' => NULL,
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => 'core/components/msoptionsprice/elements/plugins/plugin.init.php',
    ),
    54 => 
    array (
      'id' => '54',
      'source' => '1',
      'property_preprocess' => '0',
      'name' => '410error',
      'description' => '',
      'editor_type' => '0',
      'category' => '8',
      'cache_type' => '0',
      'plugincode' => 'if ($modx->context->key == \'mgr\') {
	return;
}
$uri = $modx->getOption(\'REQUEST_URI\', $_SERVER, \'/\');
if($modx->event->name == \'OnPageNotFound\'){
    $scriptProperties[\'response_code\'] = \'HTTP/1.1 410 Gone\';
    $scriptProperties[\'error_type\'] =  \'410\';
    $scriptProperties[\'error_header\'] = \'HTTP/1.1 410 Gone\';
    $scriptProperties[\'error_pagetitle\'] = \'Error 410: Page gone\';
    $scriptProperties[\'error_message\'] = \'<h1>Страница удалена навсегда</h1><p>Бывает, что товар не ожидается. Или статья устарела и не актуальна.</p>\';
    $resource = $modx->getObject(\'modResource\', array(\'alias\'=>\'410\'));
    $modx->sendForward($resource->get(\'id\'), $scriptProperties);
}',
      'locked' => '0',
      'properties' => 'a:0:{}',
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => '',
    ),
    56 => 
    array (
      'id' => '56',
      'source' => '1',
      'property_preprocess' => '0',
      'name' => 'Comparison',
      'description' => '',
      'editor_type' => '0',
      'category' => '101',
      'cache_type' => '0',
      'plugincode' => 'switch ($modx->event->name) {

	case \'OnHandleRequest\':
		if (empty($_REQUEST[\'cmp_action\']) || empty($_SERVER[\'HTTP_X_REQUESTED_WITH\']) || $_SERVER[\'HTTP_X_REQUESTED_WITH\'] != \'XMLHttpRequest\') {
			return;
		}

		$modx->lexicon->load(\'comparison:default\');
		$response = array(\'success\' => true, \'message\' => \'\', \'data\' => array());

		$action = trim(strtolower($_REQUEST[\'cmp_action\']));
		switch ($action) {
			case \'add\':
			case \'remove\':
				$list = !empty($_REQUEST[\'list\'])
					? (string) $_REQUEST[\'list\']
					: \'default\';

				if ($list != \'default\' && !isset($_SESSION[\'Comparison\'][$modx->context->key][$list])) {
					$response[\'success\'] = false;
					$response[\'message\'] = $modx->lexicon(\'comparison_err_add_name\');
				}
				elseif (empty($_REQUEST[\'resource\']) || !$modx->getCount(\'modResource\', array(\'id\' => $_REQUEST[\'resource\'], \'published\' => 1, \'deleted\' => 0))) {
					$response[\'success\'] = false;
					$response[\'message\'] = $modx->lexicon(\'comparison_err_add_resource\');
				}
				else {
					$params = & $_SESSION[\'Comparison\'][$modx->context->key][$list];
					$id = $_REQUEST[\'resource\'];
					if ($action == \'add\') {
						if ((count($params[\'ids\']) + 1) > $params[\'maxItems\']) {
							$response[\'success\'] = false;
							$response[\'message\'] = $modx->lexicon(\'comparison_err_max_resource\');
						}
						else {
							$params[\'ids\'][$id] = true;
						}
					}
					else {
						unset($params[\'ids\'][$id]);
					}
					$response[\'data\'] = array(
						\'total\' => count($params[\'ids\']),
					);

					$link_params = array();
					if ($list != \'default\') {
						$link_params[\'list\'] = $list;
					}
					if (!empty($params[\'ids\'])) {
						$link_params[\'cmp_ids\'] = implode(\',\', array_keys($params[\'ids\']));
					}
					$response[\'data\'][\'link\'] = !empty($link_params[\'cmp_ids\'])
						? urldecode($modx->context->makeUrl($params[\'list_id\'], $link_params, $modx->getOption(\'link_tag_scheme\')))
						: \'#\';
				}
				break;
		}

		@session_write_close();
		exit($modx->toJSON($response));
		break;

}',
      'locked' => '0',
      'properties' => NULL,
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => 'core/components/comparison/elements/plugins/plugin.comparison.php',
    ),
    57 => 
    array (
      'id' => '57',
      'source' => '9',
      'property_preprocess' => '0',
      'name' => 'ms_options_include_categories',
      'description' => '',
      'editor_type' => '0',
      'category' => '8',
      'cache_type' => '0',
      'plugincode' => '$eventName = $modx->event->name;
switch($eventName) {
  case "OnDocFormSave":

    if ($resource->template == 9) {

      if (!function_exists(\'db_insert\')){
        function db_insert($modx, $table, $data){
          $keys = array_keys($data);
          $fields = \'`\' . implode(\'`,`\', $keys) . \'`\';
          $placeholders = substr(str_repeat(\'?,\', count($keys)), 0, -1);
          $sql = "INSERT INTO {$table} ({$fields}) VALUES ({$placeholders});";
          $stmt = $modx->prepare($sql);
          if (!$stmt->execute(array_values($data))) {
            $modx->log(1, print_r($stmt->errorInfo(), true) . \' SQL: \' . $sql);
          }
        }
      }

      $cat_id = $resource->id;
      $db_prefix = $modx->config[\'table_prefix\'];
      $db_table = $db_prefix.\'ms2_category_options\';
      $ms_options_arr = $ms_options_ids_arr = $ms_options_ids_included_arr = $ms_options_ids_not_included_arr = array();

      // получаем список опций, из конфигуратора
      $ms_options_str = $modx->getOption(\'ms_options_include_categories\');
      if ($ms_options_str) {
        $ms_options_arr = array_map(\'trim\', explode(\',\', $ms_options_str));
      }
      if (!$ms_options_arr) return;

      // получаем id опций, которые хотим включить
      $q = $modx->newQuery(\'msOption\');
      $q->select(array(\'id\'));
      $q->where(array(
        \'key:IN\' => $ms_options_arr,
      ));
      $q->prepare();
      if($q->stmt && $q->stmt->execute()){
        $ms_options_ids_arr = $q->stmt->fetchAll(PDO::FETCH_COLUMN);
      }
      if (!$ms_options_ids_arr) return;

      // получаем id опций, которые уже включены
      $q = $modx->newQuery(\'msCategoryOption\');
      $q->select(array(\'option_id\'));
      $q->where(array(
        \'category_id\' => $cat_id
      ));
      $q->prepare();
      if($q->stmt && $q->stmt->execute()){
        $ms_options_ids_included_arr = $q->stmt->fetchAll(PDO::FETCH_COLUMN);
      }

      // получаем id опций, которые хотим включить и они не включены
      $ms_options_ids_not_included_arr = array_diff($ms_options_ids_arr, $ms_options_ids_included_arr);

      if (count($ms_options_ids_not_included_arr)) {
        foreach ($ms_options_ids_not_included_arr as $o => $option_id) {
          $data_arr = array(\'option_id\' => $option_id, \'category_id\' => $cat_id, \'rank\' => 0, \'active\' => 1, \'required\' => 0, \'value\' => \'\');
          db_insert($modx, $db_table, $data_arr);
        }
      }

    }

    break;
}',
      'locked' => '0',
      'properties' => 'a:0:{}',
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '1',
      'static_file' => 'ms_options_include_categories.php',
    ),
    59 => 
    array (
      'id' => '59',
      'source' => '9',
      'property_preprocess' => '0',
      'name' => 'editTVLink',
      'description' => '',
      'editor_type' => '0',
      'category' => '8',
      'cache_type' => '0',
      'plugincode' => '$eventName = $modx->event->name;
switch($eventName) {
    case "OnResourceTVFormRender":
    if (!$modx->user->isMember(\'Administrator\') ) {
        return;
    }
    foreach ($categories as $id => & $category) {
        if (!empty($category[\'tvs\'])) {
            foreach ($category[\'tvs\'] as $key => & $tv) {
                // if($tv->id == 20){
                //     $tv->type = "hidden";
                //     $tv->formElement = "";
                // }
                $tv->caption = "<a href=\'/manager/?a=element/tv/update&id={$tv->id}\' target=\'_blank\' style=\'font-size: 16px; color: #555; vertical-align: middle;\'><i class=\'icon icon icon-edit\'></i></a> ".$tv->caption;
            }
        }
    }
    break;
}',
      'locked' => '0',
      'properties' => 'a:0:{}',
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '1',
      'static_file' => 'editTVLink.php',
    ),
    60 => 
    array (
      'id' => '60',
      'source' => '1',
      'property_preprocess' => '0',
      'name' => 'mspre',
      'description' => '',
      'editor_type' => '0',
      'category' => '103',
      'cache_type' => '0',
      'plugincode' => '/** @var modX $modx */
/* @var mspre $msPree */
/* @var array $scriptProperties */
switch ($modx->event->name) {
    case \'OnManagerPageBeforeRender\':
    case \'OnResourceToolbarLoad\':
    case \'OnTVFormDelete\':
        /* @var mspre $mspre */
        if ($mspre = $modx->getService(\'mspre\', \'mspre\', MODX_CORE_PATH . \'components/mspre/model/\')) {
            $mspre->handleEvent($modx->event, $scriptProperties, $controller);
        }
        break;
    case \'OnDocFormRender\':
        if (isset($_GET[\'mspre_iframe\'])) {
            $modx->controller->addCss(MODX_ASSETS_URL . \'components/mspre/css/mgr/manageriframe.css\');
        }
        break;
}',
      'locked' => '0',
      'properties' => NULL,
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => 'core/components/mspre/elements/plugins/mspre.php',
    ),
    61 => 
    array (
      'id' => '61',
      'source' => '9',
      'property_preprocess' => '0',
      'name' => 'ajaxRequest',
      'description' => '',
      'editor_type' => '0',
      'category' => '8',
      'cache_type' => '0',
      'plugincode' => 'if (!empty($_SERVER[\'HTTP_X_REQUESTED_WITH\']) && strtolower($_SERVER[\'HTTP_X_REQUESTED_WITH\']) == \'xmlhttprequest\' && !empty($_REQUEST[\'action\'])) {

  $eventName = $modx->event->name;

  switch($eventName) {
    case "OnLoadWebDocument":

      if($_REQUEST[\'action\'] == \'quick\' && $modx->resource->template == 10){
        $modx->resource->set(\'cacheable\', 0);
        $modx->resource->set(\'template\', 27);
      }

      break;
  }

}',
      'locked' => '0',
      'properties' => 'a:0:{}',
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '1',
      'static_file' => 'ajaxRequest.php',
    ),
    62 => 
    array (
      'id' => '62',
      'source' => '1',
      'property_preprocess' => '0',
      'name' => 'msSetInCartOnInit',
      'description' => '',
      'editor_type' => '0',
      'category' => '105',
      'cache_type' => '0',
      'plugincode' => 'if ($modx->event->name != \'OnMODXInit\') {
    return;
}

$modx->loadClass(\'msProductLink\');

$modx->map[\'msProductLink\'][\'fields\'][\'count\'] = 0;
$modx->map[\'msProductLink\'][\'fieldMeta\'][\'count\'] = array(
    \'dbtype\'     => \'int\',
    \'precision\'  => \'10\',
    \'phptype\'    => \'integer\',
    \'attributes\' => \'unsigned\',
    \'null\'       => false,
    \'default\'    => 0,
);

$modx->map[\'msProductLink\'][\'fields\'][\'price\'] = \'\';
$modx->map[\'msProductLink\'][\'fieldMeta\'][\'price\'] = array(
    \'dbtype\'    => \'varchar\',
    \'precision\' => 255,
    \'phptype\'   => \'string\',
    \'null\'      => false,
    \'default\'   => \'\',
);',
      'locked' => '0',
      'properties' => NULL,
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => 'core/components/mssetincart/elements/plugins/plugin.init.php',
    ),
    63 => 
    array (
      'id' => '63',
      'source' => '1',
      'property_preprocess' => '0',
      'name' => 'msSetInCart',
      'description' => '',
      'editor_type' => '0',
      'category' => '105',
      'cache_type' => '0',
      'plugincode' => '/** @var array $scriptProperties */
/** @var msSetInCart $msSetInCart */
$corePath = $modx->getOption(\'mssetincart_core_path\', null,
    $modx->getOption(\'core_path\', null, MODX_CORE_PATH) . \'components/mssetincart/\');
if (!$msSetInCart = $modx->getService(\'mssetincart\', \'msSetInCart\', $corePath . \'model/mssetincart/\',
    array(\'core_path\' => $corePath))
) {
    return;
}

$className = \'mssetincart\' . $modx->event->name;
$modx->loadClass(\'msSetInCartPlugin\', $msSetInCart->getOption(\'modelPath\') . \'mssetincart/systems/\', true,
    true);
$modx->loadClass($className, $msSetInCart->getOption(\'modelPath\') . \'mssetincart/systems/\', true, true);
if (class_exists($className)) {
    /** @var msSetInCartPlugin $handler */
    $handler = new $className($modx, $scriptProperties);
    $handler->run();
}
return;',
      'locked' => '0',
      'properties' => NULL,
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => 'core/components/mssetincart/elements/plugins/plugin.mssetincart.php',
    ),
    64 => 
    array (
      'id' => '64',
      'source' => '9',
      'property_preprocess' => '0',
      'name' => 'ticketFileUpload',
      'description' => '',
      'editor_type' => '0',
      'category' => '55',
      'cache_type' => '0',
      'plugincode' => '$eventName = $modx->event->name;
switch($eventName) {
  case "OnBeforeCommentSave":

    if(count($_FILES)){

      $upload_error = $upload_images = $properties = array();

      // конфигурация
      $path       = $_SERVER[\'DOCUMENT_ROOT\'] . \'/images/reviews/\';
      $types      = array(\'image/gif\', \'image/png\', \'image/jpeg\');
      $max_size   = 2*1024*1024;
      $prefix     = date(\'dmY-His_\');
      $input_name = \'photo\';
      $max_files  = 1;

      $is_array = is_array($_FILES[$input_name][\'name\']) ? 1 : 0;
      $count_files = $is_array ? count($_FILES[$input_name][\'name\']) : 1;

      // проверяем кол-во загруженных фотографий
      if ($count_files > $max_files) {
        $upload_error[] = "Максимальное кол-во фотографий - $max_files.";
      }

      // если мультизагрузка
      if ($is_array) {

        // Проверяем тип файлов
        foreach ($_FILES[$input_name][\'type\'] as $img_type) {
          if (!in_array($img_type, $types)) {
            $upload_error[] = \'Ошибка. Разрешено загружать только изображения.\';
          }
        }

        // Проверяем размер файла
        foreach ($_FILES[$input_name][\'size\'] as $img_size) {
          if ($img_size > $max_size){
            $upload_error[] = \'Ошибка. Максимальный размер файла \'.$max_size / 1024 / 1024 .\' мб.\';
          }
        }

        if(!count($upload_error)){
          // Загрузка файлов и вывод сообщения
          foreach ($_FILES[$input_name][\'tmp_name\'] as $k => $img_tmp) {
            if (!copy($img_tmp, $path . $prefix.$_FILES[$input_name][\'name\'][$k])){
              $upload_error[] = \'Ошибка. Не удалось загрузить файл изображения.\';
            } else {
              $upload_images[] = array(\'image\' => $prefix.$_FILES[$input_name][\'name\'][$k]);
            }
          }

          $properties[$input_name] = json_encode($upload_images);
          $modx->event->params[\'TicketComment\']->set(\'properties\', array_merge($data[\'properties\'],$properties));
        }

      } // если один файл
      else {

        // Проверяем тип файла
        if (!in_array($_FILES[$input_name][\'type\'], $types)) {
          $upload_error[] = \'Ошибка. Разрешено загружать только изображения.\';
        }

        // Проверяем размер файла
        if ($_FILES[$input_name][\'size\'] > $max_size){
          $upload_error[] = \'Ошибка. Максимальный размер файла \' . $max_size / 1024 / 1024 . \' мб.\';
        }

        if(!count($upload_error)){
          // Загрузка файла и вывод сообщения
          if (!copy($_FILES[$input_name][\'tmp_name\'], $path.$prefix.$_FILES[$input_name][\'name\'])){
            $upload_error[] = \'Ошибка. Не удалось загрузить файл изображения.\';
          } else {
            $upload_images[] = array(\'image\' => $prefix.$_FILES[$input_name][\'name\']);
          }

          $properties[$input_name] = json_encode($upload_images);
          $modx->event->params[\'TicketComment\']->set(\'properties\', array_merge($data[\'properties\'],$properties));
        }

      } // $is_array

      if(count($upload_error)){
        $modx->event->output(implode(", ", $upload_error));
      }

    } // if(count($_FILES))

    break;
}',
      'locked' => '0',
      'properties' => 'a:0:{}',
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '1',
      'static_file' => 'ticketFileUpload.php',
    ),
    65 => 
    array (
      'id' => '65',
      'source' => '0',
      'property_preprocess' => '0',
      'name' => 'msimportexport',
      'description' => '',
      'editor_type' => '0',
      'category' => '106',
      'cache_type' => '0',
      'plugincode' => '/** @var modX $modx */
switch ($modx->event->name) {
    case \'OnBeforeEmptyTrash\':
        if (empty($ids) || !is_array($ids)) return;
        $msie = $modx->getService(\'msimportexport\', \'Msie\', $modx->getOption(\'msimportexport.core_path\', null, $modx->getOption(\'core_path\') . \'components/msimportexport/\') . \'model/msimportexport/\', array());
        $msie->removeСategoryFromPresets($ids);

        $parents = $modx->getOption(\'msimportexport.export.parents\', null, \'\');
        if (!$parents = array_map(\'trim\', explode(\',\', $parents))) return;
        $parents = array_diff($parents, $ids);
        $msie->setOption(\'msimportexport.export.parents\', implode(\',\', $parents), true);
        break;
}',
      'locked' => '0',
      'properties' => NULL,
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => '',
    ),
    66 => 
    array (
      'id' => '66',
      'source' => '9',
      'property_preprocess' => '0',
      'name' => 'cache_refresh',
      'description' => '',
      'editor_type' => '0',
      'category' => '8',
      'cache_type' => '0',
      'plugincode' => '$funs = $modx->getService(\'funs\', \'functions\', MODX_BASE_PATH.\'artmebius/snippets/model/\');

// указываем шаблоны в которых используется сниппет, в формате: \'название_сниппета\' => [массив id шаблонов];
$config = [
  \'print_price_table\' => [25, 26],
  // \'linked\' => [25, 26],
  \'print_selects_services\' => [25, 26]
];

// указываем id и/или шаблоны ресурсов, из которых сниппет собирает данные, в формате: \'название_сниппета\' => [\'ids\' => [массив id ресурсов], \'tpls\' => [массив id шаблонов]];
$config_related = [
  \'print_price_table\' => [
    \'ids\' => [1]
  ],
  \'linked\' => [
    \'tpls\' => [29]
  ],
  \'print_selects_services\' => [
    \'tpls\' => [29]
  ],
];

$eventName = $modx->event->name;
switch($eventName) {

  case \'OnDocFormSave\':
    foreach ($config as $snippet => $tpls) {
      if (in_array($resource->template, $tpls)) {
        // $path = MODX_CORE_PATH.\'cache/artmebius/\'.$snippet.\'/\'.$id.\'.cache.php\';
        // if (file_exists($path)) {
        //   unlink($path);
        // }
        $path = MODX_CORE_PATH.\'cache/artmebius/\'.$snippet.\'/\'.$id.\'/\';
        if (is_dir($path)) {
          $funs->clear_dir($path);
        }
      }
    }

    foreach ($config_related as $snippet => $options) {
      foreach ($options as $type => $values) {

        switch ($type) {
          case \'ids\':
            if (in_array($id, $values)) {
              $path = MODX_CORE_PATH.\'cache/artmebius/\'.$snippet.\'/\';
              if (is_dir($path)) {
                $funs->clear_dir($path);
              }
            }
            break;

          case \'tpls\':
            if (in_array($resource->template, $values)) {
              $path = MODX_CORE_PATH.\'cache/artmebius/\'.$snippet.\'/\';
              if (is_dir($path)) {
                $funs->clear_dir($path);
              }
            }
            break;
        }
      }
    }
  break;

  case \'OnSiteRefresh\':
    $path = MODX_CORE_PATH.\'cache/artmebius/\';
    if (is_dir($path)) {
      $funs->clear_dir($path);
    }
    break;
}',
      'locked' => '0',
      'properties' => 'a:0:{}',
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '1',
      'static_file' => 'cache_refresh.php',
    ),
    69 => 
    array (
      'id' => '69',
      'source' => '1',
      'property_preprocess' => '0',
      'name' => 'ms2Gallery',
      'description' => 'Main plugin for ms2Gallery',
      'editor_type' => '0',
      'category' => '111',
      'cache_type' => '0',
      'plugincode' => '/** @var modX $modx */
/** @var array $scriptProperties */
switch ($modx->event->name) {

    case \'OnDocFormRender\':
        /** @var modResource $resource */
        $templates = array_map(\'trim\', explode(\',\', $modx->getOption(\'ms2gallery_disable_for_templates\')));
        $disable = $mode == \'new\' ||
            ($templates[0] != \'\' && in_array($resource->get(\'template\'), $templates)) ||
            ($resource->class_key == \'msProduct\' &&
                $modx->getOption(\'ms2gallery_disable_for_ms2\', null, true) &&
                !$modx->getOption(\'ms2gallery_sync_ms2\', null, false)
            );
        if (!$disable) {
            /** @var ms2Gallery $ms2Gallery */
            $ms2Gallery = $modx->getService(\'ms2gallery\', \'ms2Gallery\',
                MODX_CORE_PATH . \'components/ms2gallery/model/ms2gallery/\');
            if ($ms2Gallery) {
                $ms2Gallery->loadManagerFiles($modx->controller, $resource);
            }
        }
        break;

    case \'OnBeforeDocFormSave\':
        if ($source_id = $resource->get(\'media_source\')) {
            $resource->setProperties(array(\'media_source\' => $source_id), \'ms2gallery\');
        }
        break;

    case \'OnLoadWebDocument\':
        if (!$modx->getOption(\'ms2gallery_set_placeholders\', null, false, true)) {
            return;
        }
        $tstart = microtime(true);
        /** @var pdoFetch $pdoFetch */
        $pdoFetch = $modx->getService(\'pdoFetch\');
        $plTemplates = array_map(\'trim\', explode(\',\', $modx->getOption(\'ms2gallery_placeholders_for_templates\')));
        if (!empty($plTemplates[0]) && !in_array($modx->resource->get(\'template\'), $plTemplates)) {
            return;
        }
        $plPrefix = $modx->getOption(\'ms2gallery_placeholders_prefix\', null, \'ms2g.\', true);
        $plThumbs = array_map(\'trim\', explode(\',\', $modx->getOption(\'ms2gallery_placeholders_thumbs\')));
        $tplName = $modx->getOption(\'ms2gallery_placeholders_tpl\');

        // Check for assigned TV
        $q = $modx->newQuery(\'modTemplateVarTemplate\');
        $q->innerJoin(\'modTemplateVar\', \'TemplateVar\');
        $q->innerJoin(\'modTemplate\', \'Template\');
        $q->where(array(
            \'TemplateVar.name\' => $tplName,
            \'Template.id\' => $modx->resource->get(\'template\'),
        ));
        $q->select(\'TemplateVar.id\');
        $tpl = $modx->getCount(\'modTemplateVarTemplate\', $q)
            ? \'@INLINE \' . $modx->resource->getTVValue($tplName)
            : $tplName;

        $options = array(\'loadModels\' => \'ms2gallery\');
        $where = array(\'resource_id\' => $modx->resource->id, \'parent\' => 0);

        $parents = $pdoFetch->getCollection(\'msResourceFile\', $where, $options);
        $options[\'select\'] = \'url\';
        foreach ($parents as &$parent) {
            $where = array(\'parent\' => $parent[\'id\']);
            if (!empty($plThumbs[0])) {
                $where[\'path:IN\'] = array();
                foreach ($plThumbs as $thumb) {
                    $where[\'path:IN\'][] = $parent[\'path\'] . $thumb . \'/\';
                }
            }
            if ($children = $pdoFetch->getCollection(\'msResourceFile\', $where, $options)) {
                foreach ($children as $child) {
                    if (preg_match("#/{$parent[\'resource_id\']}/(.*?)/#", $child[\'url\'], $size)) {
                        $parent[$size[1]] = $child[\'url\'];
                    }
                }
            }
            $pls = $pdoFetch->makePlaceholders($parent, $plPrefix . $parent[\'rank\'] . \'.\', \'[[+\', \']]\', false);
            $pls[\'vl\'][$plPrefix . $parent[\'rank\']] = $pdoFetch->getChunk($tpl, $parent);
            $modx->setPlaceholders($pls[\'vl\']);
        }

        $modx->log(modX::LOG_LEVEL_INFO, \'[ms2Gallery] Set image placeholders for page id = \' . $modx->resource->id .
            \' in \' . number_format(microtime(true) - $tstart, 7) . \' sec.\');
        break;

    case \'OnBeforeEmptyTrash\':
        if (empty($scriptProperties[\'ids\']) || !is_array($scriptProperties[\'ids\'])) {
            return;
        }
        if (!$modx->addPackage(\'ms2gallery\', MODX_CORE_PATH . \'components/ms2gallery/model/\')) {
            return;
        }
        $resources = $modx->getIterator(\'modResource\', array(\'id:IN\' => $scriptProperties[\'ids\']));
        /** @var modResource $resource */
        foreach ($resources as $resource) {
            $properties = $resource->getProperties(\'ms2gallery\');
            if (!empty($properties[\'media_source\'])) {
                /** @var modMediaSource $source */
                $source = $modx->getObject(\'modMediaSource\', $properties[\'media_source\']);
                $resource_id = $resource->get(\'id\');
                if ($source) {
                    $source->set(\'ctx\', $resource->get(\'context_key\'));
                    $source->initialize();
                }
                $images = $modx->getIterator(\'msResourceFile\', array(\'resource_id\' => $resource_id, \'parent\' => 0));
                /** @var msResourceFile $image */
                foreach ($images as $image) {
                    $prepare = $image->prepareSource($source);
                    if ($prepare === true) {
                        $image->remove();
                    } else {
                        $modx->log(modX::LOG_LEVEL_ERROR, "[ms2Gallery] {$prepare}.");
                    }
                }
                if ($source) {
                    $source->removeContainer($source->getBasePath() . $resource_id);
                }
            }
        }
        break;

}',
      'locked' => '0',
      'properties' => NULL,
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => 'core/components/ms2gallery/elements/plugins/plugin.ms2gallery.php',
    ),
    70 => 
    array (
      'id' => '70',
      'source' => '0',
      'property_preprocess' => '0',
      'name' => 'TinyMCE Rich Text Editor',
      'description' => 'TinyMCE Rich Text Editor runtime hooks - registers and includes javascripts on document edit pages',
      'editor_type' => '0',
      'category' => '112',
      'cache_type' => '0',
      'plugincode' => '/**
 * TinyMCE Rich Tech Editor Plugin
 *
 * @package tinymcerte
 * @subpackage plugin
 *
 * @var modX $modx
 * @var array $scriptProperties
 */

$className = \'TinyMCERTE\\Plugins\\Events\\\\\' . $modx->event->name;

$corePath = $modx->getOption(\'tinymcerte.core_path\', null, $modx->getOption(\'core_path\') . \'components/tinymcerte/\');
/** @var TinyMCERTE $tinymcerte */
$tinymcerte = $modx->getService(\'tinymcerte\', \'TinyMCERTE\', $corePath . \'model/tinymcerte/\', [
    \'core_path\' => $corePath
]);

if ($tinymcerte) {
    if (class_exists($className)) {
        $handler = new $className($modx, $scriptProperties);
        if (get_class($handler) == $className) {
            $handler->run();
        } else {
            $modx->log(xPDO::LOG_LEVEL_ERROR, $className. \' could not be initialized!\', \'\', \'TinyMCE RTE Plugin\');
        }
    } else {
        $modx->log(xPDO::LOG_LEVEL_ERROR, $className. \' was not found!\', \'\', \'TinyMCE RTE Plugin\');
    }
}

return;',
      'locked' => '0',
      'properties' => 'a:0:{}',
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => '',
    ),
    71 => 
    array (
      'id' => '71',
      'source' => '0',
      'property_preprocess' => '0',
      'name' => 'ResVideoGallery',
      'description' => '',
      'editor_type' => '0',
      'category' => '113',
      'cache_type' => '0',
      'plugincode' => '/**
 * ResVideoGallery
 * @package resvideogallery
 */
/**
 * @var modX $modx
 * @var array $scriptProperties
 */
switch ($modx->event->name) {
    case \'OnDocFormRender\':
        /** @var modResource $resource */
        if ($mode == \'new\') {
            return;
        }
        $template = $resource->get(\'template\');
        $templates = array_map(\'trim\', explode(\',\', $modx->getOption(\'resvideogallery.disable_for_templates\')));
        if (!empty($templates) && in_array($template, $templates)) {
            return;
        }

        /** @var Rvg $rvg */
        if ($rvg = $modx->getService(\'resvideogallery\', \'Rvg\', MODX_CORE_PATH . \'components/resvideogallery/model/resvideogallery/\')) {
            $rvg->loadVideoManagerFiles($modx->controller, $resource);
        }
        break;

    case \'OnBeforeEmptyTrash\':
        if (empty($scriptProperties[\'ids\']) || !is_array($scriptProperties[\'ids\'])) {
            return;
        }

        /** @var Rvg $rvg */
        if (!$rvg = $modx->getService(\'resvideogallery\', \'Rvg\', MODX_CORE_PATH . \'components/resvideogallery/model/resvideogallery/\')) {
            return;
        }

        $resources = $modx->getIterator(\'modResource\', array(\'id:IN\' => $scriptProperties[\'ids\']));

        /** @var modResource $resource */
        foreach ($resources as $resource) {
            $resource_id = $resource->get(\'id\');
            $videos = $modx->getIterator(\'RvgVideos\', array(\'resource_id\' => $resource_id));
            /** @var RvgVideos $video */
            foreach ($videos as $video) {
                $video->remove();
            }

            $dir = $rvg->config[\'thumbsPath\'] . $resource_id;
            if(is_dir($dir)) {
                $modx->cacheManager->deleteTree($dir,array(\'deleteTop\' => true));
            }
        }
        break;
}',
      'locked' => '0',
      'properties' => NULL,
      'disabled' => '0',
      'moduleguid' => '',
      'static' => '0',
      'static_file' => '',
    ),
  ),
  'policies' => 
  array (
    'modAccessContext' => 
    array (
      'web' => 
      array (
        0 => 
        array (
          'principal' => 0,
          'authority' => 9999,
          'policy' => 
          array (
            'load' => true,
          ),
        ),
        1 => 
        array (
          'principal' => 0,
          'authority' => 9999,
          'policy' => 
          array (
            'fileattach.download' => true,
          ),
        ),
        2 => 
        array (
          'principal' => 1,
          'authority' => 0,
          'policy' => 
          array (
            'about' => true,
            'access_permissions' => true,
            'actions' => true,
            'change_password' => true,
            'change_profile' => true,
            'charsets' => true,
            'class_map' => true,
            'components' => true,
            'content_types' => true,
            'countries' => true,
            'create' => true,
            'credits' => true,
            'customize_forms' => true,
            'dashboards' => true,
            'database' => true,
            'database_truncate' => true,
            'delete_category' => true,
            'delete_chunk' => true,
            'delete_context' => true,
            'delete_document' => true,
            'delete_weblink' => true,
            'delete_symlink' => true,
            'delete_static_resource' => true,
            'delete_eventlog' => true,
            'delete_plugin' => true,
            'delete_propertyset' => true,
            'delete_role' => true,
            'delete_snippet' => true,
            'delete_template' => true,
            'delete_tv' => true,
            'delete_user' => true,
            'directory_chmod' => true,
            'directory_create' => true,
            'directory_list' => true,
            'directory_remove' => true,
            'directory_update' => true,
            'edit_category' => true,
            'edit_chunk' => true,
            'edit_context' => true,
            'edit_document' => true,
            'edit_weblink' => true,
            'edit_symlink' => true,
            'edit_static_resource' => true,
            'edit_locked' => true,
            'edit_plugin' => true,
            'edit_propertyset' => true,
            'edit_role' => true,
            'edit_snippet' => true,
            'edit_template' => true,
            'edit_tv' => true,
            'edit_user' => true,
            'element_tree' => true,
            'empty_cache' => true,
            'error_log_erase' => true,
            'error_log_view' => true,
            'events' => true,
            'export_static' => true,
            'file_create' => true,
            'file_list' => true,
            'file_manager' => true,
            'file_remove' => true,
            'file_tree' => true,
            'file_update' => true,
            'file_upload' => true,
            'file_unpack' => true,
            'file_view' => true,
            'flush_sessions' => true,
            'frames' => true,
            'help' => true,
            'home' => true,
            'import_static' => true,
            'languages' => true,
            'lexicons' => true,
            'list' => true,
            'load' => true,
            'logout' => true,
            'logs' => true,
            'menus' => true,
            'menu_reports' => true,
            'menu_security' => true,
            'menu_site' => true,
            'menu_support' => true,
            'menu_system' => true,
            'menu_tools' => true,
            'menu_user' => true,
            'messages' => true,
            'namespaces' => true,
            'new_category' => true,
            'new_chunk' => true,
            'new_context' => true,
            'new_document' => true,
            'new_document_in_root' => true,
            'new_plugin' => true,
            'new_propertyset' => true,
            'new_role' => true,
            'new_snippet' => true,
            'new_static_resource' => true,
            'new_symlink' => true,
            'new_template' => true,
            'new_tv' => true,
            'new_user' => true,
            'new_weblink' => true,
            'packages' => true,
            'policy_delete' => true,
            'policy_edit' => true,
            'policy_new' => true,
            'policy_save' => true,
            'policy_template_delete' => true,
            'policy_template_edit' => true,
            'policy_template_new' => true,
            'policy_template_save' => true,
            'policy_template_view' => true,
            'policy_view' => true,
            'property_sets' => true,
            'providers' => true,
            'publish_document' => true,
            'purge_deleted' => true,
            'remove' => true,
            'remove_locks' => true,
            'resource_duplicate' => true,
            'resourcegroup_delete' => true,
            'resourcegroup_edit' => true,
            'resourcegroup_new' => true,
            'resourcegroup_resource_edit' => true,
            'resourcegroup_resource_list' => true,
            'resourcegroup_save' => true,
            'resourcegroup_view' => true,
            'resource_quick_create' => true,
            'resource_quick_update' => true,
            'resource_tree' => true,
            'save' => true,
            'save_category' => true,
            'save_chunk' => true,
            'save_context' => true,
            'save_document' => true,
            'save_plugin' => true,
            'save_propertyset' => true,
            'save_role' => true,
            'save_snippet' => true,
            'save_template' => true,
            'save_tv' => true,
            'save_user' => true,
            'search' => true,
            'set_sudo' => true,
            'settings' => true,
            'sources' => true,
            'source_delete' => true,
            'source_edit' => true,
            'source_save' => true,
            'source_view' => true,
            'steal_locks' => true,
            'tree_show_element_ids' => true,
            'tree_show_resource_ids' => true,
            'undelete_document' => true,
            'unlock_element_properties' => true,
            'unpublish_document' => true,
            'usergroup_delete' => true,
            'usergroup_edit' => true,
            'usergroup_new' => true,
            'usergroup_save' => true,
            'usergroup_user_edit' => true,
            'usergroup_user_list' => true,
            'usergroup_view' => true,
            'view' => true,
            'view_category' => true,
            'view_chunk' => true,
            'view_context' => true,
            'view_document' => true,
            'view_element' => true,
            'view_eventlog' => true,
            'view_offline' => true,
            'view_plugin' => true,
            'view_propertyset' => true,
            'view_role' => true,
            'view_snippet' => true,
            'view_sysinfo' => true,
            'view_template' => true,
            'view_tv' => true,
            'view_unpublished' => true,
            'view_user' => true,
            'workspaces' => true,
          ),
        ),
        3 => 
        array (
          'principal' => 2,
          'authority' => 9,
          'policy' => 
          array (
            'about' => false,
            'access_permissions' => false,
            'actions' => false,
            'change_password' => false,
            'change_profile' => true,
            'charsets' => false,
            'class_map' => true,
            'components' => true,
            'content_types' => false,
            'countries' => true,
            'create' => false,
            'credits' => false,
            'customize_forms' => false,
            'dashboards' => false,
            'database' => false,
            'database_truncate' => false,
            'delete_category' => false,
            'delete_chunk' => false,
            'delete_context' => false,
            'delete_document' => true,
            'delete_eventlog' => false,
            'delete_plugin' => false,
            'delete_propertyset' => false,
            'delete_role' => false,
            'delete_snippet' => false,
            'delete_template' => false,
            'delete_tv' => false,
            'delete_user' => false,
            'directory_chmod' => true,
            'directory_create' => true,
            'directory_list' => true,
            'directory_remove' => true,
            'directory_update' => true,
            'edit_category' => false,
            'edit_chunk' => false,
            'edit_context' => false,
            'edit_document' => true,
            'edit_locked' => false,
            'edit_plugin' => false,
            'edit_propertyset' => false,
            'edit_role' => false,
            'edit_snippet' => false,
            'edit_template' => false,
            'edit_tv' => false,
            'edit_user' => false,
            'element_tree' => false,
            'empty_cache' => true,
            'error_log_erase' => false,
            'error_log_view' => false,
            'events' => false,
            'export_static' => false,
            'file_create' => true,
            'file_list' => true,
            'file_manager' => true,
            'file_remove' => true,
            'file_tree' => true,
            'file_unpack' => false,
            'file_update' => true,
            'file_upload' => true,
            'file_view' => true,
            'flush_sessions' => false,
            'formit' => true,
            'formit_encryptions' => false,
            'frames' => true,
            'help' => true,
            'home' => true,
            'import_static' => false,
            'languages' => false,
            'lexicons' => false,
            'list' => true,
            'load' => true,
            'logout' => true,
            'logs' => false,
            'menus' => false,
            'menu_reports' => true,
            'menu_security' => false,
            'menu_site' => true,
            'menu_support' => true,
            'menu_system' => false,
            'menu_tools' => true,
            'menu_trash' => true,
            'menu_user' => true,
            'messages' => false,
            'namespaces' => false,
            'new_category' => false,
            'new_chunk' => false,
            'new_context' => false,
            'new_document' => true,
            'new_document_in_root' => true,
            'new_plugin' => false,
            'new_propertyset' => false,
            'new_role' => false,
            'new_snippet' => false,
            'new_static_resource' => false,
            'new_symlink' => true,
            'new_template' => false,
            'new_tv' => false,
            'new_user' => false,
            'new_weblink' => true,
            'packages' => false,
            'policy_delete' => false,
            'policy_edit' => false,
            'policy_new' => false,
            'policy_save' => false,
            'policy_template_delete' => false,
            'policy_template_edit' => false,
            'policy_template_new' => false,
            'policy_template_save' => false,
            'policy_template_view' => false,
            'policy_view' => false,
            'property_sets' => true,
            'providers' => false,
            'publish_document' => true,
            'purge_deleted' => true,
            'remove' => true,
            'remove_locks' => false,
            'resourcegroup_delete' => false,
            'resourcegroup_edit' => false,
            'resourcegroup_new' => false,
            'resourcegroup_resource_edit' => false,
            'resourcegroup_resource_list' => false,
            'resourcegroup_save' => false,
            'resourcegroup_view' => false,
            'resource_duplicate' => true,
            'resource_quick_create' => true,
            'resource_quick_update' => true,
            'resource_tree' => true,
            'save' => true,
            'save_category' => false,
            'save_chunk' => false,
            'save_context' => false,
            'save_document' => true,
            'save_plugin' => false,
            'save_propertyset' => false,
            'save_role' => false,
            'save_snippet' => false,
            'save_template' => false,
            'save_tv' => false,
            'save_user' => false,
            'search' => true,
            'settings' => false,
            'set_sudo' => false,
            'sources' => false,
            'source_delete' => false,
            'source_edit' => false,
            'source_save' => false,
            'source_view' => true,
            'steal_locks' => false,
            'tree_show_element_ids' => false,
            'tree_show_resource_ids' => true,
            'undelete_document' => true,
            'unlock_element_properties' => false,
            'unpublish_document' => true,
            'usergroup_delete' => false,
            'usergroup_edit' => false,
            'usergroup_new' => false,
            'usergroup_save' => false,
            'usergroup_user_edit' => false,
            'usergroup_user_list' => false,
            'usergroup_view' => false,
            'view' => true,
            'view_category' => false,
            'view_chunk' => false,
            'view_context' => false,
            'view_document' => true,
            'view_element' => false,
            'view_eventlog' => false,
            'view_offline' => false,
            'view_plugin' => false,
            'view_propertyset' => false,
            'view_role' => false,
            'view_snippet' => false,
            'view_sysinfo' => false,
            'view_template' => true,
            'view_tv' => false,
            'view_unpublished' => true,
            'view_user' => false,
            'workspaces' => false,
          ),
        ),
        4 => 
        array (
          'principal' => 3,
          'authority' => 9999,
          'policy' => 
          array (
            'load' => true,
            'list' => true,
            'view' => true,
          ),
        ),
      ),
    ),
  ),
);