var Tickets={initialize:function(){"function"!=typeof window.prettyPrint&&$.getScript(TicketsConfig.jsUrl+"lib/prettify/prettify.js",function(){prettyPrint()});jQuery().ajaxForm||document.write('<script src="'+TicketsConfig.jsUrl+'lib/jquery.form.min.js">\x3c/script>');jQuery();jQuery().sisyphus||document.write('<script src="'+TicketsConfig.jsUrl+'lib/jquery.sisyphus.min.js">\x3c/script>');$(document).on("click","#comment-preview-placeholder a",function(){return!1});$(document).on("change","#comments-subscribe",
function(){Tickets.comment.subscribe($('[name="thread"]',$("#comment-form")))});$(document).on("change","#tickets-subscribe",function(){Tickets.ticket.subscribe($(this).data("id"))});$(document).on("submit","#ticketForm",function(a){Tickets.ticket.save(this,$(this).find('[type="submit"]')[0]);a.preventDefault();return!1});$(document).on("submit","#comment-form",function(a){Tickets.comment.save(this,$(this).find('[type="submit"]')[0]);a.preventDefault();return!1});$(document).on("click touchend","#ticketForm .preview, #ticketForm .save, #ticketForm .draft, #ticketForm .publish",
function(a){$(this).hasClass("preview")?Tickets.ticket.preview(this.form,this):Tickets.ticket.save(this.form,this);a.preventDefault();return!1});$(document).on("click touchend","#comment-form .preview, #comment-form .submit",function(a){$(this).hasClass("preview")?Tickets.comment.preview(this.form,this):Tickets.comment.save(this.form,this);a.preventDefault();return!1});$(document).on("keydown","#ticketForm, #comment-form",function(a){13==a.keyCode&&(a.shiftKey&&(a.ctrlKey||a.metaKey)?$(this).submit():
(a.ctrlKey||a.metaKey)&&$(this).find('input[type="button"].preview').click())});$(document).on("click touchend","#comment-new-link a",function(a){Tickets.forms.comment();a.preventDefault();return!1});$(document).on("click touchend",".comment-reply a",function(a){var b=$(this).parents(".ticket-comment").data("id");$(this).hasClass("reply")?Tickets.forms.reply(b):$(this).hasClass("edit")&&Tickets.forms.edit(b);a.preventDefault();return!1});$(document).on("click touchend",".ticket-comment-rating.active > .vote",
function(a){var b=$(this).parents(".ticket-comment").data("id");$(this).hasClass("plus")?Tickets.Vote.comment.vote(this,b,1):$(this).hasClass("minus")&&Tickets.Vote.comment.vote(this,b,-1);a.preventDefault();return!1});$(document).on("click touchend",".ticket-rating.active > .vote",function(a){var b=$(this).parents(".ticket-meta").data("id");$(this).hasClass("plus")?Tickets.Vote.ticket.vote(this,b,1):$(this).hasClass("minus")?Tickets.Vote.ticket.vote(this,b,-1):Tickets.Vote.ticket.vote(this,b,0);
a.preventDefault();return!1});$(document).on("click touchend",".ticket-comment-star.active > .star",function(a){var b=$(this).parents(".ticket-comment").data("id");Tickets.Star.comment.star(this,b,0);a.preventDefault();return!1});$(document).on("click touchend",".ticket-star.active > .star",function(a){var b=$(this).parents(".ticket-meta").data("id");Tickets.Star.ticket.star(this,b,0);a.preventDefault();return!1});$(document).ready(function(){1==TicketsConfig.enable_editor&&$("#ticket-editor").markItUp(TicketsConfig.editor.ticket);
1==TicketsConfig.enable_editor&&$("#comment-editor").markItUp(TicketsConfig.editor.comment);var a=$(".ticket-comment").length;$("#comment-total, .ticket-comments-count").text(a);$("#ticketForm.create").sisyphus({excludeFields:$("#ticketForm .disable-sisyphus")});$("#comment-form").is(":visible")&&$("#comment-new-link").hide()});$("#comments").on("click touchend",".ticket-comment-up a",function(){var a=$(this).data("id"),b=$(this).data("parent");b&&a&&(Tickets.utils["goto"]("comment-"+b),$("#comment-"+
b+" .ticket-comment-down:lt(1)").show().find("a").attr("data-child",a));return!1});$("#comments").on("click touchend",".ticket-comment-down a",function(){var a=$(this).data("child");a&&Tickets.utils["goto"]("comment-"+a);$(this).attr("data-child","").parent().hide();return!1})},ticket:{preview:function(a,b){$(a).ajaxSubmit({data:{action:"ticket/preview"},url:TicketsConfig.actionUrl,form:a,button:b,dataType:"json",beforeSubmit:function(){$(b).attr("disabled","disabled");return!0},success:function(a){var c=
$("#ticket-preview-placeholder");a.success?(c.html(a.data.preview).show(),prettyPrint()):(c.html("").hide(),Tickets.Message.error(a.message));$(b).removeAttr("disabled")}})},save:function(a,b){var c="ticket/";switch($(b).prop("name")){case "draft":c+="draft";break;case "save":c+="save";break;default:c+="publish"}$(a).ajaxSubmit({data:{action:c},url:TicketsConfig.actionUrl,form:a,button:b,dataType:"json",beforeSubmit:function(){$(a).find('input[type="submit"], input[type="button"]').attr("disabled",
"disabled");$(".error",a).text("");return!0},success:function(b){$("#ticketForm.create").sisyphus().manuallyReleaseData();if(b.success)b.message&&Tickets.Message.success(b.message),"ticket/save"==c?$(a).find('input[type="submit"], input[type="button"]').removeAttr("disabled"):b.data.redirect&&(document.location.href=b.data.redirect);else if($(a).find('input[type="submit"], input[type="button"]').removeAttr("disabled"),Tickets.Message.error(b.message),b.data){var d;for(d in b.data){var f=b.data[d];
$(a).find('[name="'+f.field+'"]').parent().find(".error").text(f.message)}}}})},subscribe:function(a){a&&$.post(TicketsConfig.actionUrl,{action:"section/subscribe",section:a},function(a){a.success?Tickets.Message.success(a.message):Tickets.Message.error(a.message)},"json")}},comment:{preview:function(a,b){$(a).ajaxSubmit({data:{action:"comment/preview"},url:TicketsConfig.actionUrl,form:a,button:b,dataType:"json",beforeSubmit:function(){$(b).attr("disabled","disabled");return!0},success:function(a){$(b).removeAttr("disabled");
a.success?($("#comment-preview-placeholder").html(a.data.preview).show(),prettyPrint()):Tickets.Message.error(a.message)}});return!1},save:function(a,b){$(a).ajaxSubmit({data:{action:"comment/save"},url:TicketsConfig.actionUrl,form:a,button:b,dataType:"json",beforeSubmit:function(){clearInterval(window.timer);$(".error",a).text("");$(b).attr("disabled","disabled");return!0},success:function(c){console.log(c);$(b).removeAttr("disabled");if(c.success)Tickets.forms.comment(!1),$("#comment-preview-placeholder").html("").hide(),
$("#comment-editor",a).val(""),$(".ticket-comment .comment-reply a").show(),!c.data.length&&c.message?Tickets.Message.info(c.message):(Tickets.comment.insert(c.data.comment),Tickets.utils["goto"]($(c.data.comment).attr("id"))),Tickets.comment.getlist(),prettyPrint();else if(Tickets.Message.error(c.message),c.data){var d=[],e;for(e in c.data){var f=c.data[e];var g=$(a).find('[name="'+f.field+'"]').parents(".form-group").find(".error");0<g.length?g.text(f.message):f.field&&f.message&&d.push(f.field+
": "+f.message)}0<d.length&&Tickets.Message.error(d.join("<br/>"))}c.data.captcha&&($('input[name="captcha"]',a).val("").focus(),$("#comment-captcha",a).text(c.data.captcha))}});return!1},getlist:function(){var a=$("#comment-form");a=$('[name="thread"]',a);if(!a)return!1;Tickets.tpanel.start();$.post(TicketsConfig.actionUrl,{action:"comment/getlist",thread:a.val()},function(a){for(var b in a.data.comments)a.data.comments.hasOwnProperty(b)&&Tickets.comment.insert(a.data.comments[b],!0);a=$(".ticket-comment").length;
$("#comment-total, .ticket-comments-count").text(a);Tickets.tpanel.stop()},"json");return!0},insert:function(a,b){var c=$(a),d=$(c).attr("data-parent"),e=$(c).attr("id"),f=$("#"+e),g="";if(0<f.length)if(g=f.data("newparent"),c.attr("data-newparent",g),a=c[0].outerHTML,b)g=f.find(".comments-list").html(),f.remove();else{f.replaceWith(a);return}if(0==d&&TicketsConfig.formBefore)$("#comments").prepend(a);else if(0==d)$("#comments").append(a);else{f=$("#comment-"+d);if(f.data("parent")!=f.data("newparent"))d=
f.data("newparent"),c.attr("data-newparent",d),a=c[0].outerHTML;else if(TicketsConfig.thread_depth){var h=f.parents(".ticket-comment").length;0<h&&h>=TicketsConfig.thread_depth-1&&(d=f.data("parent"),c.attr("data-newparent",d),a=c[0].outerHTML)}$("#comment-"+d+" > .comments-list").append(a)}0<g.length&&$("#"+e).find(".comments-list").html(g)},subscribe:function(a){a.length&&$.post(TicketsConfig.actionUrl,{action:"comment/subscribe",thread:a.val()},function(a){a.success?Tickets.Message.success(a.message):
Tickets.Message.error(a.message)},"json")}},forms:{reply:function(a){$("#comment-new-link").show();clearInterval(window.timer);var b=$("#comment-form");$(".time",b).text("");$(".ticket-comment .comment-reply a").show();$("#comment-preview-placeholder").hide();$('input[name="parent"]',b).val(a);$('input[name="id"]',b).val(0);a=$("#comment-"+a+" > .comment-reply");b.insertAfter(a).show();$("a",a).hide();a.parents(".ticket-comment").removeClass("ticket-comment-new");$("#comment-editor",b).val("").focus();
return!1},comment:function(a){!1!==a&&(a=!0);clearInterval(window.timer);$("#comment-new-link").hide();var b=$("#comment-form");$(".time",b).text("");$(".ticket-comment .comment-reply a:hidden").show();$("#comment-preview-placeholder").hide();$('input[name="parent"]',b).val(0);$('input[name="id"]',b).val(0);$(b).insertAfter("#comment-form-placeholder").show();$("#comment-editor",b).val("");a&&$("#comment-editor",b).focus();return!1},edit:function(a){$("#comment-new-link").show();var b=$('#comment-form [name="thread"]').val();
$.post(TicketsConfig.actionUrl,{action:"comment/get",id:a,thread:b},function(b){if(b.success){clearInterval(window.timer);$(".ticket-comment .comment-reply a:hidden").show();var c=$("#comment-form");$("#comment-preview-placeholder").hide();$('input[name="parent"]',c).val(0);$('input[name="id"]',c).val(a);var e=$("#comment-"+a+" > .comment-reply"),f=$(".time",c);f.text("");c.insertAfter(e).show();$("a",e).hide();$("#comment-editor",c).val(b.data.raw).focus();b.data.name&&$('[name="name"]',c).val(b.data.name);
b.data.email&&$('[name="email"]',c).val(b.data.email);var g=b.data.time;window.timer=setInterval(function(){0<g?(--g,f.text(Tickets.utils.timer(g))):(clearInterval(window.timer),f.text(""))},1E3)}else Tickets.Message.error(b.message)},"json");return!1}},utils:{timer:function(a){days=Math.floor(a/86400);hours=Math.floor(a/3600);mins=Math.floor(a/60);secs=Math.floor(a);dd=days;hh=hours-24*days;mm=mins-60*hours;ss=secs-60*mins;a=[];0<hh&&a.push(hh?this.addzero(hh):"00");a.push(mm?this.addzero(mm):"00");
a.push(ss?this.addzero(ss):"00");return a.join(":")},addzero:function(a){return 10>a?"0"+a:a},"goto":function(a){$("html, body").animate({scrollTop:$("#"+a).offset().top},1E3)}},Message:{success:function(a){a&&jQuery(".reviews_main .success_message").text(a).fadeIn()},error:function(a){},info:function(a){a&&jQuery(".reviews_main .success_message").text(a).fadeIn()},close:function(){jQuery(".reviews_main .success_message").text().hide()}},Vote:{comment:{options:{active:"active",inactive:"inactive",
voted:"voted",vote:"vote",rating:"rating",positive:"positive",negative:"negative"},vote:function(a,b,c){a=$(a);var d=a.parent(),e=this.options,f=d.find("."+e.rating);if(d.hasClass(e.inactive))return!1;$.post(TicketsConfig.actionUrl,{action:"comment/vote",id:b,value:c},function(b){b.success?(a.addClass(e.voted),d.removeClass(e.active).addClass(e.inactive),d.find("."+e.vote),f.text(b.data.rating).attr("title",b.data.title),f.removeClass(e.positive+" "+e.negative),1==b.data.status?f.addClass(e.positive):
-1==b.data.status&&f.addClass(e.negative)):Tickets.Message.error(b.message)},"json");return!0}},ticket:{options:{active:"active",inactive:"inactive",voted:"voted",vote:"vote",rating:"rating",positive:"positive",negative:"negative"},vote:function(a,b,c){a=$(a);var d=a.parent(),e=this.options,f=d.find("."+e.rating);if(d.hasClass(e.inactive))return!1;$.post(TicketsConfig.actionUrl,{action:"ticket/vote",id:b,value:c},function(b){b.success?(a.addClass(e.voted),d.removeClass(e.active).addClass(e.inactive),
d.find("."+e.vote),f.text(b.data.rating).attr("title",b.data.title).removeClass(e.vote),f.removeClass(e.positive+" "+e.negative),1==b.data.status?f.addClass(e.positive):-1==b.data.status&&f.addClass(e.negative)):Tickets.Message.error(b.message)},"json");return!0}}},Star:{comment:{options:{stared:"stared",unstared:"unstared"},star:function(a,b,c){a=$(a);var d=this.options;a.parent();$.post(TicketsConfig.actionUrl,{action:"comment/star",id:b},function(b){b.success?a.toggleClass(d.stared).toggleClass(d.unstared):
Tickets.Message.error(b.message)},"json");return!0}},ticket:{options:{stared:"stared",unstared:"unstared",count:"ticket-star-count"},star:function(a,b,c){a=$(a);var d=this.options,e=a.parent().find("."+this.options.count);$.post(TicketsConfig.actionUrl,{action:"ticket/star",id:b},function(b){b.success?(a.toggleClass(d.stared).toggleClass(d.unstared),e.text(b.data.stars)):Tickets.Message.error(b.message)},"json");return!0}}}};
Tickets.tpanel={wrapper:$("#comments-tpanel"),refresh:$("#tpanel-refresh"),new_comments:$("#tpanel-new"),class_new:"ticket-comment-new",initialize:function(){TicketsConfig.tpanel&&(this.wrapper.show(),this.stop());this.refresh.on("click",function(){$("."+Tickets.tpanel.class_new).removeClass(Tickets.tpanel.class_new);Tickets.comment.getlist()});this.new_comments.on("click",function(){var a=$("."+Tickets.tpanel.class_new+":first");$("html, body").animate({scrollTop:a.offset().top},1E3,"linear",function(){a.removeClass(Tickets.tpanel.class_new)});
var b=parseInt(Tickets.tpanel.new_comments.text());1<b?Tickets.tpanel.new_comments.text(b-1):Tickets.tpanel.new_comments.text("").hide()})},start:function(){this.refresh.addClass("loading")},stop:function(){var a=$("."+this.class_new).length;0<a?this.new_comments.text(a).show():this.new_comments.hide();this.refresh.removeClass("loading")}};"undefined"!=typeof TicketsConfig&&(Tickets.initialize(),Tickets.tpanel.initialize());"undefined"==typeof pdoPage&&(pdoPage={callbacks:{},keys:{},configs:{}});
pdoPage.Reached=!1;
pdoPage.initialize=function(a){if(void 0==pdoPage.keys[a.pageVarKey]){var b=a.pageVarKey,c=pdoPage.Hash.get();pdoPage.keys[b]=Number(void 0==c[b]?1:c[b]);pdoPage.configs[b]=a}var d=this;switch(a.mode){case "default":$(document).on("click",a.link,function(b){b.preventDefault();b=$(this).prop("href");var c=a.pageVarKey,e=b.match(new RegExp(c+"=(\\d+)"));e=e?e[1]:1;pdoPage.keys[c]!=e&&(a.history&&pdoPage.Hash.add(c,e),d.loadPage(b,a))});a.history&&($(window).on("popstate",function(b){b.originalEvent.state&&b.originalEvent.state.pdoPage&&
d.loadPage(b.originalEvent.state.pdoPage,a)}),history.replaceState({pdoPage:window.location.href},""));break;case "scroll":case "button":if(a.history){if("undefined"==typeof jQuery().sticky)return void $.getScript(a.assetsUrl+"js/lib/jquery.sticky.min.js",function(){pdoPage.initialize(a)});pdoPage.stickyPagination(a)}else $(a.pagination).hide();var e=a.pageVarKey;if("button"==a.mode){$(a.rows).after(a.moreTpl);var f=!1;$(a.link).each(function(){var a=$(this).prop("href").match(new RegExp(e+"=(\\d+)"));
if((a?a[1]:1)>pdoPage.keys[e])return f=!0,!1});f||$(a.more).hide();$(document).on("click",a.more,function(b){b.preventDefault();pdoPage.addPage(a)})}else{var g=$(a.wrapper),h=$(window);h.on("scroll",function(){!pdoPage.Reached&&h.scrollTop()>g.height()-h.height()&&(pdoPage.Reached=!0,pdoPage.addPage(a))})}}};
pdoPage.addPage=function(a){var b=a.pageVarKey,c=pdoPage.keys[b]||1;$(a.link).each(function(){var d=$(this).prop("href"),e=d.match(new RegExp(b+"=(\\d+)"));e=e?Number(e[1]):1;if(e>c)return a.history&&pdoPage.Hash.add(b,e),pdoPage.loadPage(d,a,"append"),!1})};
pdoPage.loadPage=function(a,b,c){var d=$(b.wrapper),e=$(b.rows),f=$(b.pagination),g=b.pageVarKey;a=(a=a.match(new RegExp(g+"=(\\d+)")))?Number(a[1]):1;if(c||(c="replace"),pdoPage.keys[g]!=a){pdoPage.callbacks.before&&"function"==typeof pdoPage.callbacks.before?pdoPage.callbacks.before.apply(this,[b]):("scroll"!=b.mode&&d.css({opacity:.3}),d.addClass("loading"));var h=pdoPage.Hash.get(),k;for(k in h)h.hasOwnProperty(k)&&pdoPage.keys[k]&&k!=g&&delete h[k];h[g]=pdoPage.keys[g]=a;h.pageId=b.pageId;h.hash=
b.hash;$.post(b.connectorUrl,h,function(a){a&&a.total&&(d.find(f).html(a.pagination),"append"==c?(d.find(e).append(a.output),"button"==b.mode?a.pages==a.page?$(b.more).hide():$(b.more).show():"scroll"==b.mode&&(pdoPage.Reached=!1)):d.find(e).html(a.output),pdoPage.callbacks.after&&"function"==typeof pdoPage.callbacks.after?pdoPage.callbacks.after.apply(this,[b,a]):(d.removeClass("loading"),"scroll"!=b.mode&&(d.css({opacity:1}),"default"==b.mode&&$("html, body").animate({scrollTop:d.position().top-
50||0},0))),pdoPage.updateTitle(b,a),$(document).trigger("pdopage_load",[b,a]))},"json")}};pdoPage.stickyPagination=function(a){var b=$(a.pagination);b.is(":visible")&&(b.sticky({wrapperClassName:"sticky-pagination",getWidthFrom:a.wrapper,responsiveWidth:!0,topSpacing:2}),$(a.wrapper).trigger("scroll"))};
pdoPage.updateTitle=function(a,b){if("undefined"!=typeof pdoTitle){for(var c=$("title"),d=pdoTitle.separator||" / ",e=pdoTitle.tpl,f=[],g=c.text().split(d),h=new RegExp("^"+e.split(" ")[0]+" "),k=0;k<g.length;k++)1===k&&b.page&&1<b.page&&f.push(e.replace("{page}",b.page).replace("{pageCount}",b.pages)),g[k].match(h)||f.push(g[k]);c.text(f.join(d))}};
pdoPage.Hash={get:function(){var a,b={};if(this.oldbrowser()){var c=decodeURIComponent(window.location.hash.substr(1)).replace("+"," ");var d="/"}else d=window.location.href.indexOf("?"),c=-1!=d?decodeURIComponent(window.location.href.substr(d+1)).replace("+"," "):"",d="&";if(0==c.length)return b;c=c.split(d);var e,f,g;for(g in c)c.hasOwnProperty(g)&&(a=c[g].split("="),"undefined"==typeof a[1]?b.anchor=a[0]:(e=a[0].match(/\[(.*?|)\]$/),e?(f=a[0].replace(e[0],""),b.hasOwnProperty(f)||(""==e[1]?b[f]=
[]:b[f]={}),b[f]instanceof Array?b[f].push(a[1]):b[f][e[1]]=a[1]):b[a[0]]=a[1]));return b},set:function(a){var b="",c;for(c in a)if(a.hasOwnProperty(c))if("object"==typeof a[c])for(var d in a[c])a[c].hasOwnProperty(d)&&(b+=a[c]instanceof Array?"&"+c+"[]="+a[c][d]:"&"+c+"["+d+"]="+a[c][d]);else b+="&"+c+"="+a[c];this.oldbrowser()?window.location.hash=b.substr(1):(0!=b.length&&(b="?"+b.substr(1)),window.history.pushState({pdoPage:document.location.pathname+b},"",document.location.pathname+b))},add:function(a,
b){var c=this.get();c[a]=b;this.set(c)},remove:function(a){var b=this.get();delete b[a];this.set(b)},clear:function(){this.set({})},oldbrowser:function(){return!(window.history&&history.pushState)}};"undefined"==typeof jQuery&&console.log("You must load jQuery for using ajax mode in pdoPage.");