var tmFilters={config:{filters_cont:"#filters",sortby:"pagetitle",sortdir:"asc",numeric:["price","weight"],multitags:["tags"],guard_key:"#",products_cont:"#products",filter_slider:"div.range-slider",filter_slider_cont:"div.filter_slider",pages_cont1:"#pages",pages_cont2:"#pages2",active_page_selector:".current",filters_type:"default",filter_delay:700,price_field:"price",multi_currency:!0,base_url:"/",ajax_url:"assets/components/tag_manager2/connector_fe.php",ajax_loader:"assets/components/tag_manager2/img/ajax-loader2.gif"},
result_ids:[],filtersActive:!1,filtered:!1,sorted:!1,keyCtrl:!1,timer:null,init:function(a){$.extend(this.config,a);this.slidersInit();this.ajaxPagesInit();this.filterSelected();$("input,select",this.config.filters_cont).on("change",function(a){tmFilters.filtersPreSubmit(a);clearTimeout(tmFilters.timer);tmFilters.timer=setTimeout(function(){tmFilters.filtersSubmit()},tmFilters.config.filter_delay)});a=tmFilters.getFilters();tmFilters.countAllFIlters(a)},slidersInit:function(){0<$(tmFilters.config.filter_slider,
tmFilters.config.filters_cont).length&&$(tmFilters.config.filter_slider,tmFilters.config.filters_cont).each(function(a){var b=$(this);a=b.parent();var d=tmFilters.getFilterName($("input:text:eq(0)",a).attr("name")),c=$("input:text:eq(0)",a),e=$("input:text:eq(1)",a),f=parseFloat(tmFilters.getNumber(c.val())),g=parseFloat(tmFilters.getNumber(e.val()));tmFilters.config.multi_currency&&d==tmFilters.config.price_field&&(f=tmFilters.currRate(d,f,"min"),g=tmFilters.currRate(d,g,"max"),c.val(f.toString()),
e.val(g.toString()));b.slider({min:f,max:g,step:100>g-f?.1:1,values:[f,g],range:!0,start:function(a,b){var c=$(b.handle).prevAll(".ui-slider-handle").length;c=$(a.target).slider("values",c);$(b.handle).data("value",c)},stop:function(a,d){c.val(b.slider("values",0));e.val(b.slider("values",1));tmFilters.filtersPreSubmit(a);clearTimeout(tmFilters.timer);tmFilters.timer=setTimeout(function(){tmFilters.filtersSubmit()},tmFilters.config.filter_delay)},slide:function(a,d){c.val(b.slider("values",0));e.val(b.slider("values",
1))}});$("input:text",a).on("keyup",function(a){clearTimeout(tmFilters.timer2);tmFilters.timer2=setTimeout(function(){var a=parseFloat(tmFilters.getNumber(c.val())),d=parseFloat(tmFilters.getNumber(e.val()));a<f&&(a=f);a>g&&(a=g);d>g&&(d=g);d<f&&(d=f);a>d&&(a<g?d=a:d>f&&(a=d));b.slider("values",0,a);b.slider("values",1,d);b.slider("option","stop").call(b)},tmFilters.config.filter_delay)})})},filtersPreSubmit:function(a){var b=tmFilters.getFilters(),d="undefined"!=typeof a&&$(a.target).is("select");
tmFilters.filtered=!$.isEmptyObject(b);if("undefined"!=typeof window.flt_data){tmFilters.result_ids=[];for(var c in window.flt_data.products)tmFilters.result_ids.push(parseInt(window.flt_data.products[c].id));tmFilters.search(b);c=$.extend([],tmFilters.result_ids);tmFilters.countAllFIlters(b)}else tmFilters.config.filters_type="none",c=[];d||"none"==tmFilters.config.filters_type||0!=c.length||"undefined"!=typeof a&&$(a.target).is(tmFilters.config.filter_slider)&&tmFilters.setbackSlider(a)},filtersSubmit:function(){tmFilters.switchPage(1,
!1);tmFilters.pushState()},pushState:function(){$('input[name="page_id"]',tmFilters.config.filters_cont).prop("disabled",!1);var a=$("form",tmFilters.config.filters_cont).serializeArray(),b=[],d="";if(tmFilters.filtered||tmFilters.sorted)if(tmFilters.sorted&&!tmFilters.filtered)for(c in a)a.hasOwnProperty(c)&&(-1<$.inArray(a[c].name,["page","sortby","sortdir","limit"])&&("page"!=a[c].name||1!=a[c].value)&&(d+="&"+a[c].name+"="+a[c].value,b.push(a[c])),-1<$.inArray(a[c].name,["page_id"])&&b.push(a[c]));
else for(c in a)a.hasOwnProperty(c)&&(-1!=$.inArray(a[c].name,["page_id"])||"page"==a[c].name&&1==a[c].value||(d+="&"+a[c].name+"="+a[c].value,b.push(a[c])),-1<$.inArray(a[c].name,["page_id"])&&b.push(a[c]));else for(var c in a)a.hasOwnProperty(c)&&(-1<$.inArray(a[c].name,["page"])&&("page"!=a[c].name||1!=a[c].value)&&(d+="&"+a[c].name+"="+a[c].value,b.push(a[c])),-1<$.inArray(a[c].name,["page_id"])&&b.push(a[c]));d&&(d="?"+d.substring(1));tmFilters.filtersActive=!0;a=window.location.pathname;window.History.pushState(b,
$("title").text(),a+d)},reload:function(){tmFilters.filtersActive=!0;this.pushState();return!0},getFilters:function(){var a={};$("input:checkbox,select",tmFilters.config.filters_cont).each(function(){if("f_"==$(this).attr("name").substr(0,2)&&($(this).is(":checked")||$(this).is("select")&&$(this).val())){var b=tmFilters.getFilterName($(this).attr("name")),d=$(this).val();a[b]?a[b].push(d):a[b]=[d]}});$(tmFilters.config.filter_slider).each(function(b){b=$(this).attr("id").replace("range_","");var d=
$(this).slider("values"),c=[$(this).slider("option","min"),$(this).slider("option","max")];if(d[0]!==c[0]||d[1]!==c[1])a[b]=d});return a},currRate:function(a,b,d){"undefined"==typeof d&&(d="min");if(a==this.config.price_field&&"undefined"!=typeof tmFiltersOptions&&tmFiltersOptions.currency_rate){a=tmFiltersOptions.currency_default?parseInt(tmFiltersOptions.currency_default):1;var c=tmFiltersOptions.currency_rate||[],e=-1<document.cookie.indexOf("shk_currency=")?document.cookie.indexOf("shk_currency=")+
(new String("shk_currency=")).length:-1;e=-1<e?parseInt(document.cookie.substring(e,e+1)):1;if(e!==a){e=c[e-1];var f=e.value&&!isNaN(e.value)?parseFloat(e.value.replace(",",".")):1;e=c[a-1];a=(e.value&&!isNaN(e.value)?parseFloat(e.value.replace(",",".")):1)/f;b*=a;1>a&&(b="min"==d?b-1:b+1);b=parseFloat(b.toFixed(2))}}return b},getFilterName:function(a){if(!a)return"";a=a.substr(2);-1<a.indexOf("[")&&(a=a.substr(0,a.indexOf("[")));return a},search:function(a){for(key in a){var b=-1<$.inArray(key,tmFilters.config.numeric)?
"between":-1<$.inArray(key,tmFilters.config.multitags)?"like":"eq";tmFilters.filter(key+":"+b,a[key])}},filter:function(a,b){var d=a.split(":"),c;for(c in window.flt_data.products)if(-1!=$.inArray(parseInt(window.flt_data.products[c].id),tmFilters.result_ids)){var e=!0;if(window.flt_data.products[c][d[0]])switch(d[1]){case "between":var f=parseFloat(window.flt_data.products[c][d[0]].replace(",","."));tmFilters.config.multi_currency&&(f=tmFilters.currRate(d[0],f));f>=b[0]&&f<=b[1]&&(e=!1);break;case "like":for(var g in b)if(-1<
window.flt_data.products[c][d[0]].indexOf(tmFilters.config.guard_key+b[g]+tmFilters.config.guard_key)){e=!1;break}break;case "eq":-1<$.inArray(window.flt_data.products[c][d[0]],b)&&(e=!1)}e&&(e=$.inArray(parseInt(window.flt_data.products[c].id),tmFilters.result_ids),tmFilters.result_ids.splice(e,1))}},countAllFIlters:function(a){if("undefined"!=typeof window.flt_data){var b=[],d;for(d in window.flt_data.products)b.push(parseInt(window.flt_data.products[d].id));$("input:checkbox",tmFilters.config.filters_cont).each(function(){if("f_"==
$(this).attr("name").substr(0,2)){tmFilters.result_ids=$.extend([],b);var d=$(this),e=d.attr("name").substr(2);e=e.substr(0,e.indexOf("["));var f=d.val(),g=$.extend(!0,{},a);if($(this).is("input:checked")){var h=$.inArray(f,g[e]);g[e].splice(h,1);0==g[e].length&&delete g[e]}g[e]=[f];tmFilters.search(g);tmFilters.updateMarkerCount(d,tmFilters.result_ids.length)}})}},updateMarkerCount:function(a,b){var d=a.parent();"only_block"!=tmFilters.config.filters_type&&(a.is("input:checked")?$("label",d).next("sup").remove():
0==$("label",d).next("sup").length?$("label",d).after("<sup>"+b+"</sup>"):$("label",d).next("sup").text(b));0==b?(d.addClass("unactive"),"only_block"!=tmFilters.config.filters_type&&$("label",d).next("sup").remove(),$("input:checkbox,select",d).prop("disabled","disabled")):(d.removeClass("unactive"),$("input:checkbox,select",d).prop("disabled",!1))},setbackSlider:function(a){var b=$(a.target),d=$(a.currentTarget.activeElement),c=d.prevAll(".ui-slider-handle").length;tmFilters.getFilters();var e=b.attr("id").replace("range_",
"");b.slider("option","min");b.slider("option","max");d=d.data("value");"undefined"!=typeof d&&(b.slider("values",c,d),$("#"+e+(0==c?"Min":"Max")).val(d),tmFilters.filtersPreSubmit(a))},filterSelected:function(){var a=this.getUrlVars();if(!this.isEmpty(a)){var b=0,d=0;$("input:checkbox",tmFilters.config.filters_cont).prop("checked",!1);for(var c in a)if(0!=a[c].length){var e="f_"==c.substr(0,2)?c.substr(2):c;if(!(-1<$.inArray(e,["page"])))if(-1<$.inArray(e,["sortby","sortdir"])){d++;var f=$("select.f_sortby"),
g=$("select.f_sortdir");"sortby"==e&&0<f.length?(f.val(a[c]),f.data("selectBoxSelectBoxIt")&&f.data("selectBoxSelectBoxIt").refresh()):"sortdir"==e&&0<g.length&&(g.val(a[c]),f.data("selectBoxSelectBoxIt")&&g.data("selectBoxSelectBoxIt").refresh())}else"limit"!=e||isNaN(a[c])?-1<$.inArray(e,tmFilters.config.numeric)?a[c].from&&a[c].to&&($("#"+e+"Min").val(a[c].from),$("#range_"+e).slider("values",0,a[c].from),$("#"+e+"Max").val(a[c].to),$("#range_"+e).slider("values",1,a[c].to)):(b++,0<$("input:checkbox",
tmFilters.config.filters_cont).length?(e=-1<$.inArray(e,tmFilters.config.multitags)?"f_"+e+"[like][]":"f_"+e+"[]",e=$('input[name="'+e+'"]:checkbox',tmFilters.config.filters_cont),0<e.length&&e.each(function(){-1<$.inArray($(this).val(),a[c])&&($(this).prop("checked","checked"),$(this).parent().addClass("active"))})):(e=$('select[name="f_'+e+'"]',tmFilters.config.filters_cont),e.val(a[c]),e.data("selectBoxSelectBoxIt")&&e.data("selectBoxSelectBoxIt").refresh())):(e=$("select.f_limit"),0<e.length&&
(e.val(a[c]),e.data("selectBoxSelectBoxIt")&&e.data("selectBoxSelectBoxIt").refresh()))}0<b&&(tmFilters.filtered=!0);0<d&&(tmFilters.sorted=!0)}},getUrlVars:function(){var a={};var b=3<=document.location.search.length?document.location.search.substr(1):window.location.hash.substr(1);b=decodeURIComponent(b.replace(/\+/g," "));-1<b.indexOf("?")&&(b=b.substr(b.indexOf("?")+1));if(0==b.length)return a;for(var d=b.split("&"),c=0;c<d.length;c++)if(b=d[c].split("="),-1<b[0].indexOf("[from]")||-1<b[0].indexOf("[to]")){var e=
b[0].replace(/\[.*\]/,"");"undefined"==typeof a[e]&&(a[e]={});-1<b[0].indexOf("[from]")?a[e].from=parseFloat(b[1]):a[e].to=parseFloat(b[1])}else-1<b[0].indexOf("[")?(e=b[0].substr(0,b[0].indexOf("[")),"undefined"==typeof a[e]&&(a[e]=[]),a[e].push(b[1])):a[b[0]]=b[1];return a},isEmpty:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},ajaxRequest:function(a){"undefined"==typeof a&&($('input[name="page_id"]',tmFilters.config.filters_cont).prop("disabled",!1),a=$("form",tmFilters.config.filters_cont).serializeArray());
tmFilters.ajaxPreload($(tmFilters.config.products_cont),!0);"function"==typeof tm_onFilterBefore&&tm_onFilterBefore(a);jQuery.ajax({url:tmFilters.config.base_url+tmFilters.config.ajax_url,type:"GET",cache:!1,data:a,dataType:"json",success:function(a){"undefined"!=typeof a.prod_list&&($(tmFilters.config.products_cont).html(a.prod_list),$("html,body").animate({scrollTop:Math.round($(tmFilters.config.products_cont).position().top)}));"undefined"!=typeof a.pages&&($(tmFilters.config.pages_cont1).html(a.pages),
0<tmFilters.config.pages_cont2.length&&$(tmFilters.config.pages_cont2).html(a.pages));tmFilters.ajaxPreload($(tmFilters.config.products_cont),!1);"function"==typeof tm_onFilterAfter&&tm_onFilterAfter(a.total,a.pageCount,a.onPageLimit)},error:function(a,d,c){"undefined"!=typeof console&&console.log(a,d,c)}})},resetFilters:function(){$("input:checkbox",tmFilters.config.filters_cont).prop("checked",!1);$("select",tmFilters.config.filters_cont).each(function(){0==$(this).attr("name").indexOf("f_")&&$(this).val("")});
0<tmFilters.config.filter_slider.length&&$(tmFilters.config.filter_slider).each(function(){var a=$(this),b=$(this).next(tmFilters.config.filter_slider_cont),d=$("input[type='text']:eq(0)",b);b=$("input[type='text']:eq(1)",b);d.val(a.slider("option","min"));a.slider("values",0,a.slider("option","min"));b.val(a.slider("option","max"));a.slider("values",1,a.slider("option","max"))});tmFilters.filtersPreSubmit();tmFilters.switchPage(1,!1);tmFilters.filtersSubmit()},ajaxPreload:function(a,b){1==b?($("#ajax_loader").remove(),
a.css({position:"relative",opacity:.4}).prepend('<div id="ajax_loader"></div>'),$("#ajax_loader").css({width:a.width()+"px",height:a.height()+"px",background:"url('"+tmFilters.config.base_url+tmFilters.config.ajax_loader+"') center center no-repeat transparent"})):(a.css({opacity:1}),$("#ajax_loader").remove())},ajaxPagesInit:function(){$(document).keydown(function(a){17==a.which&&(tmFilters.keyCtrl=!0)}).keyup(function(a){17==a.which&&(tmFilters.keyCtrl=!1);if(!(0<$("#ajax_loader").length)){if(tmFilters.keyCtrl&&
37==a.which){var b=$(tmFilters.config.active_page_selector,tmFilters.config.pages_cont1).prev("a");0==b.length&&(b=$(tmFilters.config.active_page_selector,tmFilters.config.pages_cont1).parent().prev().children("a"));b=0<b.length?parseInt(b.text()):0}tmFilters.keyCtrl&&39==a.which&&(b=$(tmFilters.config.active_page_selector,tmFilters.config.pages_cont1).next("a"),0==b.length&&(b=$(tmFilters.config.active_page_selector,tmFilters.config.pages_cont1).parent().next().children("a")),b=0<b.length?parseInt(b.text()):
0);b&&0<b&&tmFilters.switchPage(b)}});var a=tmFilters.config.pages_cont1+" a";0<tmFilters.config.pages_cont2.length&&(a+=","+tmFilters.config.pages_cont2+" a");$(document).on("click",a,function(){if(!$(this).is(tmFilters.config.active_page_selector)){var a=$(this).attr("href").split("page=");a=2<=a.length?parseInt(a[1]):1;tmFilters.switchPage(a)}return!1})},switchPage:function(a,b){"undefined"==typeof b&&(b=!0);a&&!isNaN(a)&&(tmFilters.setFormValue("page",a),b&&tmFilters.pushState())},changeOrder:function(a){var b=
$(a).attr("name");a=$(a).val();-1<$.inArray(b,["sortby","sortdir","limit"])&&(this.setFormValue(b,a),this.sorted=!0,this.switchPage(1,!1),this.pushState())},setFormValue:function(a,b){0==$('input[name="'+a+'"],select[name="'+a+'"]',tmFilters.config.filters_cont).length&&$("form",tmFilters.config.filters_cont).append('<input type="hidden" name="'+a+'" />');$('input[name="'+a+'"],select[name="'+a+'"]',tmFilters.config.filters_cont).first().val(b);return!0},getNumber:function(a){a=a.replace(/,/g,".");
(a=a.replace(/[^\d\.]/g,""))||(a="0");if(-1<a.indexOf(".")&&a.indexOf(".")!=a.lastIndexOf(".")){var b=a.split(".");a=b.shift()+".";a+=b.join("")}return parseFloat(a).toFixed(2)}};History.Adapter.bind(window,"statechange",function(){var a=window.History.getState();tmFilters.filtersActive?(tmFilters.filtersActive=!1,tmFilters.ajaxRequest(a.data)):($.isArray(a.data)||(a.data=[{name:"page_id",value:$('input[name="page_id"]',tmFilters.config.filters_cont).val()}]),tmFilters.ajaxRequest(a.data),tmFilters.filterSelected())});